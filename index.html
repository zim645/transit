<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Binga Marketplace - Administrator Control Panel</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #1a5276;
            --secondary: #d4ac0d;
            --accent: #27ae60;
            --danger: #e74c3c;
            --warning: #f39c12;
            --light: #f8f9fa;
            --dark: #333333;
            --border: #e0e0e0;
            --tourist: #8e44ad;
            --admin-red: #c0392b;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        /* Header */
        .site-header {
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .header-top {
            background: var(--admin-red);
            color: white;
            padding: 8px 0;
            font-size: 14px;
            font-weight: bold;
        }
        
        .header-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-top .header-container {
            justify-content: space-between;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
            color: var(--admin-red);
        }
        
        .logo-icon {
            font-size: 32px;
            color: var(--secondary);
        }
        
        .logo-text h1 {
            font-size: 24px;
            font-weight: 700;
        }
        
        .logo-text span {
            font-size: 12px;
            color: #666;
        }
        
        .logo-text .admin-badge {
            background: var(--admin-red);
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: bold;
            margin-left: 5px;
        }
        
        /* Auth in top-right corner */
        .auth-container {
            position: relative;
        }
        
        .auth-buttons {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .auth-type-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            border-bottom: 2px solid var(--border);
            padding-bottom: 10px;
        }
        
        .auth-type-btn {
            flex: 1;
            padding: 10px;
            text-align: center;
            background: #f0f0f0;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .auth-type-btn.active {
            background: var(--admin-red);
            color: white;
        }
        
        .auth-btn {
            padding: 8px 20px;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            font-size: 14px;
        }
        
        .auth-btn.login {
            background: transparent;
            color: var(--admin-red);
            border: 1px solid var(--admin-red);
        }
        
        .auth-btn.register {
            background: var(--admin-red);
            color: white;
        }
        
        .auth-btn.logout {
            background: var(--danger);
            color: white;
        }
        
        .admin-btn {
            background: var(--admin-red);
            color: white;
            padding: 8px 20px;
            border-radius: 4px;
            text-decoration: none;
            font-weight: 600;
            border: none;
            cursor: pointer;
            margin-left: 10px;
        }
        
        .user-menu {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--admin-red);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            border: 2px solid var(--secondary);
        }
        
        .user-name {
            font-weight: 600;
            color: var(--dark);
        }
        
        .user-name .role-badge {
            background: var(--admin-red);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: bold;
            margin-left: 5px;
        }
        
        /* Auth Modal */
        .auth-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            overflow-y: auto;
            padding: 20px 10px;
        }
        
        .auth-modal-content {
            background: white;
            border-radius: 8px;
            width: 400px;
            max-width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .auth-tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
        }
        
        .auth-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
        }
        
        .auth-tab.active {
            border-bottom: 3px solid var(--admin-red);
            color: var(--admin-red);
        }
        
        .auth-form {
            padding: 25px;
        }
        
        .auth-form h3 {
            margin-bottom: 20px;
            color: var(--dark);
            font-size: 20px;
        }
        
        .form-group {
            margin-bottom: 18px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #555;
            font-size: 14px;
        }
        
        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 16px;
        }
        
        .form-control:focus {
            border-color: var(--admin-red);
            outline: none;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
            font-size: 16px;
        }
        
        .btn-primary {
            background: var(--admin-red);
            color: white;
            width: 100%;
        }
        
        .btn-primary:hover {
            background: #a93226;
        }
        
        /* Navigation */
        .main-nav {
            background: white;
            border-top: 1px solid var(--border);
            border-bottom: 1px solid var(--border);
        }
        
        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            align-items: center;
        }
        
        .nav-links {
            display: flex;
            list-style: none;
        }
        
        .nav-link {
            padding: 15px 20px;
            text-decoration: none;
            color: var(--dark);
            font-weight: 600;
            border-bottom: 3px solid transparent;
        }
        
        .nav-link:hover, .nav-link.active {
            color: var(--admin-red);
            border-bottom-color: var(--admin-red);
        }
        
        .nav-link.tourist {
            color: var(--tourist);
        }
        
        .nav-link.tourist:hover, .nav-link.tourist.active {
            color: var(--tourist);
            border-bottom-color: var(--tourist);
        }
        
        .post-ad-btn {
            margin-left: auto;
            background: var(--accent);
            color: white;
            padding: 10px 20px;
            border-radius: 4px;
            text-decoration: none;
            font-weight: 600;
        }
        
        /* Main Content */
        .main-container {
            max-width: 1400px;
            margin: 30px auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 30px;
        }
        
        /* Sidebar */
        .sidebar {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .sidebar-section {
            margin-bottom: 30px;
        }
        
        .sidebar-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 15px;
            color: var(--dark);
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }
        
        .category-list, .location-list {
            list-style: none;
        }
        
        .category-item, .location-item {
            padding: 8px 0;
            border-bottom: 1px solid #f5f5f5;
        }
        
        .category-item a, .location-item a {
            text-decoration: none;
            color: #555;
            display: flex;
            justify-content: space-between;
        }
        
        .category-item a:hover, .location-item a:hover {
            color: var(--admin-red);
        }
        
        .category-count, .location-count {
            background: #f0f0f0;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
        }
        
        /* Products Grid */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }
        
        .product-card {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        .product-image {
            height: 200px;
            background: linear-gradient(45deg, #f0f0f0, #e0e0e0);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            position: relative;
            overflow: hidden;
        }
        
        .product-image img, .product-image video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .product-price {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: bold;
        }
        
        .product-details {
            padding: 15px;
        }
        
        .product-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--dark);
            font-size: 16px;
            line-height: 1.4;
        }
        
        .product-meta {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }
        
        .product-location {
            font-size: 12px;
            color: #999;
            margin-top: 10px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .whatsapp-btn {
            background: #25D366;
            color: white;
            padding: 8px 15px;
            border-radius: 4px;
            text-decoration: none;
            display: inline-block;
            font-size: 14px;
            font-weight: 600;
            margin-top: 10px;
        }
        
        /* Tourist Attraction Cards */
        .attraction-card {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: transform 0.3s, box-shadow 0.3s;
            border-top: 4px solid var(--tourist);
        }
        
        .attraction-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        .attraction-image {
            height: 220px;
            background: linear-gradient(45deg, #e0d0f0, #d0c0e0);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            position: relative;
            overflow: hidden;
        }
        
        .attraction-image img, .attraction-image video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .attraction-type {
            position: absolute;
            top: 10px;
            left: 10px;
            background: var(--tourist);
            color: white;
            padding: 3px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        
        /* Search Bar */
        .search-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .search-box {
            display: flex;
            gap: 10px;
        }
        
        .search-input {
            flex: 1;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 16px;
        }
        
        .search-btn {
            background: var(--admin-red);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 0 30px;
            cursor: pointer;
            font-weight: 600;
        }
        
        /* Footer */
        .site-footer {
            background: var(--dark);
            color: white;
            margin-top: 50px;
            padding: 40px 0;
        }
        
        .footer-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
        }
        
        .footer-section h3 {
            font-size: 18px;
            margin-bottom: 20px;
            color: white;
        }
        
        .footer-links {
            list-style: none;
        }
        
        .footer-links li {
            margin-bottom: 10px;
        }
        
        .footer-links a {
            color: #bbb;
            text-decoration: none;
        }
        
        .footer-links a:hover {
            color: white;
        }
        
        /* Dashboard */
        .dashboard-container {
            max-width: 1400px;
            margin: 30px auto;
            padding: 0 20px;
        }
        
        .dashboard-header {
            background: white;
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border-left: 5px solid var(--admin-red);
        }
        
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .stat-number {
            font-size: 32px;
            font-weight: bold;
            color: var(--admin-red);
            margin-bottom: 10px;
        }
        
        /* Admin Panel */
        .admin-panel {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border: 2px solid var(--admin-red);
        }
        
        .admin-tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
            margin-bottom: 20px;
            flex-wrap: wrap;
            background: #f8f9fa;
            border-radius: 8px 8px 0 0;
            padding: 10px;
        }
        
        .admin-tab {
            padding: 15px 30px;
            cursor: pointer;
            font-weight: 600;
            white-space: nowrap;
            border-radius: 4px;
        }
        
        .admin-tab.active {
            background: var(--admin-red);
            color: white;
        }
        
        /* Image Upload Preview */
        .image-upload-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .image-preview {
            width: 140px;
            height: 140px;
            border: 2px dashed #ccc;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
        }
        
        .image-preview img, .image-preview video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .remove-image {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(0,0,0,0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }
        
        /* Status badges */
        .status-badge {
            padding: 3px 10px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: bold;
            display: inline-block;
        }
        
        .status-pending {
            background: var(--warning);
            color: white;
        }
        
        .status-active {
            background: var(--accent);
            color: white;
        }
        
        .status-rejected {
            background: var(--danger);
            color: white;
        }
        
        .status-admin {
            background: var(--admin-red);
            color: white;
        }
        
        /* Action buttons */
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .action-btn {
            padding: 5px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
        }
        
        .action-btn.approve {
            background: var(--accent);
            color: white;
        }
        
        .action-btn.reject {
            background: var(--danger);
            color: white;
        }
        
        .action-btn.edit {
            background: var(--admin-red);
            color: white;
        }
        
        .action-btn.delete {
            background: var(--danger);
            color: white;
        }
        
        .action-btn.view {
            background: var(--primary);
            color: white;
        }
        
        /* Image upload button */
        .image-upload-btn {
            display: inline-block;
            padding: 10px 20px;
            background: var(--admin-red);
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            text-align: center;
            margin-top: 10px;
        }
        
        .image-upload-btn:hover {
            background: #a93226;
        }
        
        /* Upload progress */
        .upload-progress {
            width: 100%;
            background: #f0f0f0;
            border-radius: 10px;
            margin-top: 10px;
            display: none;
        }
        
        .upload-progress-bar {
            height: 10px;
            background: var(--accent);
            border-radius: 10px;
            width: 0%;
            transition: width 0.3s;
        }
        
        /* Camera button */
        .camera-btn {
            display: inline-block;
            padding: 10px 20px;
            background: var(--secondary);
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            text-align: center;
            margin-top: 10px;
            margin-left: 10px;
        }
        
        /* File type indicator */
        .file-type-badge {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: bold;
        }
        
        /* Media gallery modal */
        .media-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 3000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .media-modal-content {
            width: 90%;
            max-width: 1000px;
            max-height: 90vh;
            background: transparent;
            position: relative;
        }
        
        .media-slider {
            width: 100%;
            height: 70vh;
            position: relative;
            overflow: hidden;
        }
        
        .media-slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.5s;
        }
        
        .media-slide.active {
            opacity: 1;
        }
        
        .media-slide img, .media-slide video {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        .close-media {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 24px;
            cursor: pointer;
            z-index: 10;
        }
        
        .prev-media, .next-media {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0,0,0,0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 24px;
            cursor: pointer;
            z-index: 10;
        }
        
        .prev-media { left: 20px; }
        .next-media { right: 20px; }
        
        .media-thumbnails {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            overflow-x: auto;
            padding: 10px 0;
        }
        
        .media-thumb {
            width: 80px;
            height: 80px;
            border: 2px solid transparent;
            border-radius: 4px;
            overflow: hidden;
            cursor: pointer;
            flex-shrink: 0;
        }
        
        .media-thumb.active {
            border-color: var(--accent);
        }
        
        .media-thumb img, .media-thumb video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        /* Media counter */
        .media-counter {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
        }
        
        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        .page-btn {
            padding: 8px 15px;
            border: 1px solid var(--border);
            background: white;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .page-btn.active {
            background: var(--admin-red);
            color: white;
            border-color: var(--admin-red);
        }
        
        .page-btn:hover:not(.active) {
            background: #f8f9fa;
        }
        
        /* Storage stats */
        .storage-stats {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 14px;
        }
        
        .storage-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            margin-top: 5px;
            overflow: hidden;
        }
        
        .storage-used {
            height: 100%;
            background: var(--admin-red);
            transition: width 0.3s;
        }
        
        /* Video player controls */
        .video-controls {
            position: absolute;
            bottom: 10px;
            left: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .video-play-btn {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
        }
        
        .video-progress {
            flex: 1;
            height: 5px;
            background: rgba(255,255,255,0.3);
            border-radius: 3px;
            position: relative;
            cursor: pointer;
        }
        
        .video-progress-filled {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: var(--accent);
            border-radius: 3px;
        }
        
        /* Batch upload */
        .batch-upload-btn {
            display: inline-block;
            padding: 10px 20px;
            background: var(--tourist);
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            text-align: center;
            margin-top: 10px;
            margin-left: 10px;
        }
        
        /* Admin Control Panel */
        .admin-controls {
            background: #fff3cd;
            border: 2px solid var(--warning);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .admin-controls h3 {
            color: var(--warning);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .admin-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .admin-button {
            padding: 10px 20px;
            background: var(--admin-red);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .admin-button.secondary {
            background: var(--primary);
        }
        
        .admin-button.danger {
            background: var(--danger);
        }
        
        /* Database Management */
        .database-management {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
        }
        
        .database-actions {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        /* System Info */
        .system-info {
            background: #e8f4fd;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 14px;
        }
        
        .system-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }
        
        .system-info-item {
            background: white;
            padding: 10px;
            border-radius: 4px;
            border-left: 3px solid var(--admin-red);
        }
        
        /* Responsive */
        @media (max-width: 1200px) {
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
        }
        
        @media (max-width: 992px) {
            .main-container {
                grid-template-columns: 1fr;
            }
            
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            }
        }
        
        @media (max-width: 768px) {
            .nav-container {
                flex-direction: column;
                padding: 10px;
            }
            
            .nav-links {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .post-ad-btn {
                margin: 10px 0 0 0;
            }
            
            .header-container {
                flex-direction: column;
                gap: 15px;
                padding: 15px 20px;
            }
            
            .auth-buttons {
                width: 100%;
                justify-content: center;
            }
            
            .search-box {
                flex-direction: column;
            }
            
            .search-box select {
                max-width: 100% !important;
            }
            
            .dashboard-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .admin-tabs {
                flex-direction: column;
            }
            
            .admin-tab {
                padding: 12px 20px;
                border-bottom: 1px solid var(--border);
            }
            
            .media-slider {
                height: 50vh;
            }
            
            .prev-media, .next-media {
                width: 40px;
                height: 40px;
                font-size: 20px;
            }
            
            .admin-buttons {
                flex-direction: column;
            }
            
            .admin-button {
                width: 100%;
                justify-content: center;
            }
        }
        
        @media (max-width: 576px) {
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            }
            
            .image-upload-container {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }
            
            .image-preview {
                width: 100px;
                height: 100px;
            }
            
            .media-slider {
                height: 40vh;
            }
            
            .media-thumb {
                width: 60px;
                height: 60px;
            }
        }
        
        @media (max-width: 480px) {
            .auth-modal-content {
                width: 95%;
                max-height: 85vh;
                margin: 10px;
            }
            
            .auth-form {
                padding: 20px 15px;
            }
            
            .auth-tabs {
                flex-wrap: wrap;
            }
            
            .auth-tab {
                padding: 12px 10px;
                font-size: 14px;
            }
            
            .auth-type-selector {
                flex-direction: column;
                gap: 8px;
            }
            
            .auth-type-btn {
                padding: 10px;
                font-size: 14px;
            }
            
            .form-group {
                margin-bottom: 15px;
            }
            
            .form-control {
                padding: 10px;
                font-size: 16px;
            }
            
            .btn-primary {
                padding: 12px;
            }
            
            .auth-form h3 {
                font-size: 18px;
                margin-bottom: 15px;
            }
        }
        
        /* Verification badge */
        .verified-badge {
            background: var(--accent);
            color: white;
            padding: 3px 10px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: bold;
            display: inline-block;
            margin-left: 10px;
        }
        
        .admin-badge-small {
            background: var(--admin-red);
            color: white;
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 10px;
            font-weight: bold;
        }
        
        /* No products message */
        .no-products {
            text-align: center;
            padding: 60px 20px;
            background: white;
            border-radius: 8px;
            grid-column: 1 / -1;
        }
        
        /* Featured Products */
        .featured-products {
            margin-bottom: 40px;
        }
        
        .section-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title.tourist {
            color: var(--tourist);
        }
        
        .section-title.admin {
            color: var(--admin-red);
        }
        
        /* Alert */
        .alert {
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            position: relative;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .alert-admin {
            background: #fde8e8;
            color: var(--admin-red);
            border: 2px solid var(--admin-red);
            font-weight: bold;
        }
        
        /* Welcome Message */
        .welcome-message {
            background: linear-gradient(135deg, var(--admin-red), var(--secondary));
            color: white;
            padding: 40px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 40px;
        }
        
        .welcome-message h2 {
            font-size: 32px;
            margin-bottom: 15px;
        }
        
        .welcome-message p {
            font-size: 18px;
            max-width: 800px;
            margin: 0 auto 25px;
        }
        
        .cta-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        .cta-button {
            padding: 15px 30px;
            background: white;
            color: var(--admin-red);
            border-radius: 8px;
            text-decoration: none;
            font-weight: bold;
            font-size: 16px;
        }
        
        .cta-button.secondary {
            background: transparent;
            color: white;
            border: 2px solid white;
        }
        
        /* How it works */
        .how-it-works {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin: 40px 0;
        }
        
        .step-card {
            background: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .step-number {
            width: 50px;
            height: 50px;
            background: var(--admin-red);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            margin: 0 auto 20px;
        }
        
        .step-card h3 {
            margin-bottom: 15px;
            color: var(--dark);
        }
        
        /* Tourist attractions at bottom */
        .tourist-attractions-bottom {
            margin-top: 60px;
            padding-top: 40px;
            border-top: 2px solid var(--border);
        }
        
        /* Data Tables */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .data-table th {
            background: #f8f9fa;
            padding: 12px;
            text-align: left;
            border-bottom: 2px solid var(--border);
            font-weight: 600;
            color: var(--dark);
        }
        
        .data-table td {
            padding: 12px;
            border-bottom: 1px solid var(--border);
            vertical-align: top;
        }
        
        .data-table tr:hover {
            background: #f8f9fa;
        }
        
        /* Quick Stats */
        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .quick-stat {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            border-top: 3px solid var(--admin-red);
        }
        
        .quick-stat-number {
            font-size: 24px;
            font-weight: bold;
            color: var(--admin-red);
            margin-bottom: 5px;
        }
        
        /* Export Controls */
        .export-controls {
            background: #e8f4fd;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .export-buttons {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .export-btn {
            padding: 10px 20px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* Backup Controls */
        .backup-controls {
            background: #f0f7f0;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        /* System Logs */
        .system-logs {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .log-entry {
            padding: 10px;
            border-bottom: 1px solid #e0e0e0;
            font-family: monospace;
            font-size: 12px;
        }
        
        .log-entry.error {
            color: var(--danger);
            background: #fde8e8;
        }
        
        .log-entry.warning {
            color: var(--warning);
            background: #fff3cd;
        }
        
        .log-entry.info {
            color: var(--primary);
            background: #e8f4fd;
        }
        
        .log-entry.success {
            color: var(--accent);
            background: #f0f7f0;
        }
    </style>
</head>
<body>
    <!-- Top Bar -->
    <div class="header-top">
        <div class="header-container">
            <div>
                <i class="fas fa-user-shield"></i> ADMINISTRATOR CONTROL PANEL | 
                <i class="fas fa-phone-alt"></i> +263 77 286 3815
            </div>
            <div>
                <i class="fas fa-crown"></i> Super Admin Mode: Full System Access
            </div>
        </div>
    </div>
    
    <!-- Main Header -->
    <header class="site-header">
        <div class="header-container">
            <!-- Logo -->
            <a href="#" class="logo">
                <div class="logo-icon">ðŸ‘‘</div>
                <div class="logo-text">
                    <h1>Binga Marketplace <span class="admin-badge">ADMIN</span></h1>
                    <span>Full Administrator Control Panel</span>
                </div>
            </a>
            
            <!-- Auth Section in top-right corner ONLY -->
            <div class="auth-container">
                <div class="auth-buttons" id="authButtons">
                    <!-- Will be populated by JavaScript -->
                </div>
                
                <!-- User Menu -->
                <div class="user-menu" id="userMenu" style="display: none;">
                    <div class="user-avatar" id="userAvatar">AD</div>
                    <div>
                        <div class="user-name" id="userName">Administrator <span class="role-badge">SUPER ADMIN</span></div>
                        <div style="display: flex; gap: 10px; margin-top: 5px;">
                            <button class="auth-btn logout" onclick="logout()">Logout</button>
                            <button class="admin-btn" onclick="showSection('admin')">
                                <i class="fas fa-crown"></i> Admin Panel
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>
    
    <!-- Navigation -->
    <nav class="main-nav">
        <div class="nav-container">
            <ul class="nav-links">
                <li><a href="#" class="nav-link active" onclick="showSection('home')">Dashboard</a></li>
                <li><a href="#" class="nav-link" onclick="showSection('manage')">Manage Everything</a></li>
                <li><a href="#" class="nav-link" onclick="showSection('users')">All Users</a></li>
                <li><a href="#" class="nav-link" onclick="showSection('products')">All Products</a></li>
                <li><a href="#" class="nav-link tourist" onclick="showSection('attractions')">Attractions</a></li>
                <li><a href="#" class="nav-link" onclick="showSection('database')">Database</a></li>
                <li><a href="#" class="nav-link" onclick="showSection('system')">System</a></li>
                <li><a href="#" class="nav-link" onclick="showSection('logs')">Logs</a></li>
            </ul>
            
            <button class="admin-btn" onclick="showSection('quickActions')">
                <i class="fas fa-bolt"></i> Quick Actions
            </button>
        </div>
    </nav>
    
    <!-- Main Content -->
    <div id="mainContent">
        <!-- Admin Dashboard Section -->
        <div id="dashboardSection" class="dashboard-container">
            <div class="dashboard-header">
                <h2><i class="fas fa-crown"></i> Administrator Control Panel</h2>
                <p>Complete system control and management</p>
            </div>
            
            <!-- Admin Quick Controls -->
            <div class="admin-controls">
                <h3><i class="fas fa-user-shield"></i> SUPER ADMIN PRIVILEGES</h3>
                <div class="admin-buttons">
                    <button class="admin-button" onclick="showSection('manage')">
                        <i class="fas fa-cogs"></i> Manage Everything
                    </button>
                    <button class="admin-button secondary" onclick="showSection('users')">
                        <i class="fas fa-users"></i> Manage All Users
                    </button>
                    <button class="admin-button" onclick="showSection('products')">
                        <i class="fas fa-boxes"></i> Manage All Products
                    </button>
                    <button class="admin-button secondary" onclick="showSection('database')">
                        <i class="fas fa-database"></i> Database Control
                    </button>
                    <button class="admin-button danger" onclick="resetSystem()">
                        <i class="fas fa-redo"></i> Reset System
                    </button>
                </div>
            </div>
            
            <!-- Quick Stats -->
            <div class="quick-stats" id="quickStats">
                <!-- Stats will be loaded here -->
            </div>
            
            <!-- Recent Activity -->
            <div class="admin-panel">
                <h3 class="section-title admin">
                    <i class="fas fa-history"></i> Recent Activity
                </h3>
                <div id="recentActivity">
                    <!-- Activity will be loaded here -->
                </div>
            </div>
            
            <!-- System Overview -->
            <div class="system-info">
                <h4><i class="fas fa-info-circle"></i> System Information</h4>
                <div class="system-info-grid" id="systemInfo">
                    <!-- System info will be loaded here -->
                </div>
            </div>
        </div>
        
        <!-- Manage Everything Section -->
        <div id="manageSection" class="dashboard-container" style="display: none;">
            <div class="dashboard-header">
                <h2><i class="fas fa-cogs"></i> Manage Everything</h2>
                <p>Full control over all system components</p>
            </div>
            
            <div class="admin-panel">
                <div class="admin-tabs">
                    <div class="admin-tab active" onclick="showManageTab('pending')">Pending Approvals</div>
                    <div class="admin-tab" onclick="showManageTab('products')">All Products</div>
                    <div class="admin-tab" onclick="showManageTab('users')">All Users</div>
                    <div class="admin-tab" onclick="showManageTab('attractions')">Attractions</div>
                    <div class="admin-tab" onclick="showManageTab('media')">All Media</div>
                    <div class="admin-tab" onclick="showManageTab('categories')">Categories</div>
                    <div class="admin-tab" onclick="showManageTab('locations')">Locations</div>
                </div>
                
                <div id="manageContent">
                    <!-- Content will be loaded here -->
                </div>
            </div>
        </div>
        
        <!-- Users Management Section -->
        <div id="usersSection" class="dashboard-container" style="display: none;">
            <div class="dashboard-header">
                <h2><i class="fas fa-users"></i> Manage All Users</h2>
                <p>Create, edit, delete, and manage all user accounts</p>
            </div>
            
            <div class="admin-panel">
                <div id="usersContent">
                    <!-- Users content will be loaded here -->
                </div>
            </div>
        </div>
        
        <!-- Products Management Section -->
        <div id="productsSection" class="dashboard-container" style="display: none;">
            <div class="dashboard-header">
                <h2><i class="fas fa-boxes"></i> Manage All Products</h2>
                <p>View, edit, delete, and manage all marketplace products</p>
            </div>
            
            <div class="admin-panel">
                <div id="productsContent">
                    <!-- Products content will be loaded here -->
                </div>
            </div>
        </div>
        
        <!-- Attractions Management Section -->
        <div id="attractionsSection" class="dashboard-container" style="display: none;">
            <div class="dashboard-header">
                <h2><i class="fas fa-camera"></i> Manage Tourist Attractions</h2>
                <p>Full control over all tourist attractions</p>
            </div>
            
            <div class="admin-panel">
                <div id="attractionsContent">
                    <!-- Attractions content will be loaded here -->
                </div>
            </div>
        </div>
        
        <!-- Database Control Section -->
        <div id="databaseSection" class="dashboard-container" style="display: none;">
            <div class="dashboard-header">
                <h2><i class="fas fa-database"></i> Database Management</h2>
                <p>Complete database control including backup, restore, and reset</p>
            </div>
            
            <div class="admin-panel">
                <div id="databaseContent">
                    <!-- Database content will be loaded here -->
                </div>
            </div>
        </div>
        
        <!-- System Control Section -->
        <div id="systemSection" class="dashboard-container" style="display: none;">
            <div class="dashboard-header">
                <h2><i class="fas fa-sliders-h"></i> System Configuration</h2>
                <p>System settings and configuration</p>
            </div>
            
            <div class="admin-panel">
                <div id="systemContent">
                    <!-- System content will be loaded here -->
                </div>
            </div>
        </div>
        
        <!-- System Logs Section -->
        <div id="logsSection" class="dashboard-container" style="display: none;">
            <div class="dashboard-header">
                <h2><i class="fas fa-clipboard-list"></i> System Logs</h2>
                <p>View all system activities and logs</p>
            </div>
            
            <div class="admin-panel">
                <div id="logsContent">
                    <!-- Logs content will be loaded here -->
                </div>
            </div>
        </div>
        
        <!-- Quick Actions Section -->
        <div id="quickActionsSection" class="dashboard-container" style="display: none;">
            <div class="dashboard-header">
                <h2><i class="fas fa-bolt"></i> Quick Actions</h2>
                <p>Common administrative actions</p>
            </div>
            
            <div class="admin-panel">
                <div id="quickActionsContent">
                    <!-- Quick actions content will be loaded here -->
                </div>
            </div>
        </div>
        
        <!-- Add/Edit User Form -->
        <div id="userFormSection" class="dashboard-container" style="display: none;">
            <div class="dashboard-header">
                <h2 id="userFormTitle"></h2>
                <p id="userFormSubtitle"></p>
            </div>
            
            <div class="admin-panel">
                <div id="userFormContent">
                    <!-- User form will be loaded here -->
                </div>
            </div>
        </div>
        
        <!-- Add/Edit Product Form -->
        <div id="productFormSection" class="dashboard-container" style="display: none;">
            <div class="dashboard-header">
                <h2 id="productFormTitle"></h2>
                <p id="productFormSubtitle"></p>
            </div>
            
            <div class="admin-panel">
                <div id="productFormContent">
                    <!-- Product form will be loaded here -->
                </div>
            </div>
        </div>
        
        <!-- Add/Edit Attraction Form -->
        <div id="attractionFormSection" class="dashboard-container" style="display: none;">
            <div class="dashboard-header">
                <h2 id="attractionFormTitle"></h2>
                <p id="attractionFormSubtitle"></p>
            </div>
            
            <div class="admin-panel">
                <div id="attractionFormContent">
                    <!-- Attraction form will be loaded here -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Media Gallery Modal -->
    <div class="media-modal" id="mediaModal">
        <button class="close-media" onclick="closeMediaModal()">Ã—</button>
        <div class="media-modal-content">
            <div class="media-slider" id="mediaSlider">
                <!-- Media slides will be loaded here -->
            </div>
            <button class="prev-media" onclick="prevMedia()">â€¹</button>
            <button class="next-media" onclick="nextMedia()">â€º</button>
            <div class="media-counter" id="mediaCounter">1 / 1</div>
            <div class="media-thumbnails" id="mediaThumbnails">
                <!-- Media thumbnails will be loaded here -->
            </div>
        </div>
    </div>
    
    <!-- Auth Modal -->
    <div class="auth-modal" id="authModal">
        <div class="auth-modal-content">
            <div class="auth-tabs">
                <div class="auth-tab active" onclick="showAuthForm('login')">Admin Login</div>
                <div class="auth-tab" onclick="showAuthForm('create')">Create New Admin</div>
            </div>
            
            <div class="auth-form">
                <div id="loginForm">
                    <h3>Administrator Login</h3>
                    <div class="form-group">
                        <label class="form-label">Admin Username</label>
                        <input type="text" class="form-control" id="loginEmail" placeholder="Enter admin username">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-control" id="loginPassword" placeholder="Enter admin password">
                    </div>
                    <button class="btn btn-primary" onclick="login()">Login as Administrator</button>
                    <div class="password-reset">
                        <p style="color: #666; font-size: 14px; margin-top: 15px;">
                            Default Admin Credentials:<br>
                            Username: <strong>Munkuli#1996</strong><br>
                            Password: <strong>Wiseman</strong>
                        </p>
                    </div>
                </div>
                
                <div id="createForm" style="display: none;">
                    <h3>Create New Administrator</h3>
                    <div class="form-group">
                        <label class="form-label">Full Name*</label>
                        <input type="text" class="form-control" id="createName" placeholder="Administrator Name">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Username*</label>
                        <input type="text" class="form-control" id="createUsername" placeholder="Choose admin username">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Password*</label>
                        <input type="password" class="form-control" id="createPassword" placeholder="Create strong password">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Confirm Password*</label>
                        <input type="password" class="form-control" id="createConfirmPassword" placeholder="Confirm password">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Admin Role*</label>
                        <select class="form-control" id="createRole">
                            <option value="superadmin">Super Administrator (Full Access)</option>
                            <option value="admin">Administrator (Limited Access)</option>
                            <option value="moderator">Moderator (Content Management Only)</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" onclick="createAdmin()">Create Administrator Account</button>
                    <p style="text-align: center; margin-top: 15px; color: #666; font-size: 14px;">
                        <i class="fas fa-shield-alt"></i> Only existing administrators can create new admin accounts
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Enhanced IndexedDB Database Configuration with Admin Controls
        const DB_NAME = 'binga_marketplace_admin';
        const DB_VERSION = 10; // Incremented to add admin features
        
        // Database schema with admin controls
        const DB_SCHEMA = {
            users: {
                key: 'id',
                indexes: ['username', 'phone', 'type', 'approved', 'location', 'role', 'status']
            },
            products: {
                key: 'id',
                indexes: ['sellerId', 'category', 'location', 'status', 'approved', 'createdAt', 'adminApproved']
            },
            attractions: {
                key: 'id',
                indexes: ['type', 'location', 'status', 'addedBy', 'adminApproved']
            },
            media: {
                key: 'id',
                indexes: ['entityId', 'entityType', 'mediaType', 'uploadedAt', 'uploadedBy']
            },
            categories: {
                key: 'id'
            },
            locations: {
                key: 'id'
            },
            attractionTypes: {
                key: 'id'
            },
            systemLogs: {
                key: 'id',
                indexes: ['type', 'userId', 'timestamp', 'action']
            },
            adminSettings: {
                key: 'id'
            },
            backups: {
                key: 'id',
                indexes: ['timestamp', 'type']
            }
        };
        
        // Database instance
        let db = null;
        let currentUser = null;
        let uploadedMedia = [];
        let currentMediaIndex = 0;
        let currentMediaItems = [];
        let systemLogs = [];
        
        // Initialize IndexedDB with enhanced admin features
        async function initDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, DB_VERSION);
                
                request.onerror = (event) => {
                    console.error('IndexedDB error:', event.target.error);
                    reject(event.target.error);
                };
                
                request.onsuccess = (event) => {
                    db = event.target.result;
                    console.log('IndexedDB initialized successfully');
                    loadSystemLogs();
                    resolve(db);
                };
                
                request.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    const oldVersion = event.oldVersion;
                    
                    // Create all object stores if they don't exist
                    Object.keys(DB_SCHEMA).forEach(storeName => {
                        if (!db.objectStoreNames.contains(storeName)) {
                            const store = db.createObjectStore(storeName, { keyPath: 'id' });
                            // Create indexes
                            if (DB_SCHEMA[storeName].indexes) {
                                DB_SCHEMA[storeName].indexes.forEach(index => {
                                    store.createIndex(index, index, { unique: false });
                                });
                            }
                        }
                    });
                    
                    // Add sample data if new database
                    if (oldVersion < 1) {
                        addSampleData(db);
                    }
                };
            });
        }
        
        // Load system logs
        async function loadSystemLogs() {
            try {
                const logs = await BINGA_MARKETPLACE_DB.systemLogs.getAll();
                systemLogs = logs;
            } catch (error) {
                console.error('Error loading system logs:', error);
            }
        }
        
        // Add system log
        async function addSystemLog(type, action, details, userId = null) {
            const log = {
                id: Date.now() + Math.random(),
                type: type,
                action: action,
                details: details,
                userId: userId || (currentUser ? currentUser.id : null),
                timestamp: new Date().toISOString(),
                ip: '127.0.0.1', // In real app, get from request
                userAgent: navigator.userAgent
            };
            
            systemLogs.unshift(log);
            if (systemLogs.length > 1000) {
                systemLogs.pop();
            }
            
            try {
                await BINGA_MARKETPLACE_DB.systemLogs.add(log);
            } catch (error) {
                console.error('Error adding system log:', error);
            }
        }
        
        // Add sample data to the database
        async function addSampleData(db) {
            const transaction = db.transaction(Object.keys(DB_SCHEMA), 'readwrite');
            
            // Default SUPER ADMIN - UPDATED CREDENTIALS
            const adminUser = {
                id: 1,
                username: 'Munkuli#1996',
                password: 'Wiseman',
                name: 'Super Administrator',
                phone: '263772863815',
                email: 'admin@bingamarket.co.zw',
                location: 'Binga Centre',
                type: 'admin',
                role: 'superadmin',
                permissions: ['all'],
                registered: new Date().toISOString(),
                lastLogin: new Date().toISOString(),
                products: [],
                rating: 5.0,
                approved: true,
                status: 'active',
                isSuperAdmin: true,
                createdBy: 'system'
            };
            
            // Sample users
            const users = [
                adminUser,
                {
                    id: 2,
                    username: 'johnfish',
                    password: 'john123',
                    name: 'John Fishing',
                    phone: '263773456789',
                    email: 'john@email.com',
                    location: 'Siachilaba',
                    type: 'seller',
                    role: 'seller',
                    registered: new Date().toISOString(),
                    products: [],
                    rating: 4.5,
                    approved: true,
                    status: 'active'
                },
                {
                    id: 3,
                    username: 'marygoat',
                    password: 'mary123',
                    name: 'Mary Livestock',
                    phone: '263774567890',
                    email: 'mary@email.com',
                    location: 'Kariyangwe',
                    type: 'seller',
                    role: 'seller',
                    registered: new Date().toISOString(),
                    products: [],
                    rating: 4.8,
                    approved: true,
                    status: 'active'
                }
            ];
            
            // Sample categories
            const categories = [
                {id: 'fish', name: 'Fish & Seafood', icon: 'ðŸŸ'},
                {id: 'goat', name: 'Goats', icon: 'ðŸ'},
                {id: 'cow', name: 'Cattle', icon: 'ðŸ„'},
                {id: 'poultry', name: 'Poultry', icon: 'ðŸ“'},
                {id: 'agriculture', name: 'Agriculture', icon: 'ðŸŒ¾'},
                {id: 'tourism', name: 'Tourism Services', icon: 'ðŸžï¸'},
                {id: 'services', name: 'Services', icon: 'ðŸ”§'},
                {id: 'property', name: 'Property', icon: 'ðŸ '},
                {id: 'vehicles', name: 'Vehicles', icon: 'ðŸš—'}
            ];
            
            // Sample locations
            const locations = [
                {id: 'Siachilaba', name: 'Siachilaba'},
                {id: 'Kariyangwe', name: 'Kariyangwe'},
                {id: 'Binga Centre', name: 'Binga Centre'},
                {id: 'Chete Island', name: 'Chete Island'},
                {id: 'Lake Kariba', name: 'Lake Kariba'},
                {id: 'Other', name: 'Other Areas'}
            ];
            
            // Sample attraction types
            const attractionTypes = [
                {id: 'beach', name: 'Beach'},
                {id: 'hotspring', name: 'Hot Spring'},
                {id: 'lake', name: 'Lake View'},
                {id: 'cultural', name: 'Cultural Site'},
                {id: 'wildlife', name: 'Wildlife'},
                {id: 'accommodation', name: 'Accommodation'},
                {id: 'tour', name: 'Tour Service'}
            ];
            
            // Sample tourist attractions
            const attractions = [
                {
                    id: 1,
                    name: 'Lake Kariba Shore',
                    description: 'Beautiful lakeside views and fishing spots with stunning sunsets',
                    type: 'lake',
                    typeName: 'Lake View',
                    location: 'Lake Kariba',
                    whatsappLink: 'https://wa.me/263772863815?text=Hi! I want to visit Lake Kariba',
                    status: 'active',
                    addedBy: 1,
                    adminApproved: true,
                    createdAt: new Date().toISOString()
                },
                {
                    id: 2,
                    name: 'Binga Hot Springs',
                    description: 'Natural hot springs with therapeutic properties',
                    type: 'hotspring',
                    typeName: 'Hot Spring',
                    location: 'Binga Centre',
                    whatsappLink: 'https://wa.me/263772863815?text=Hi! I want to visit Binga Hot Springs',
                    status: 'active',
                    addedBy: 1,
                    adminApproved: true,
                    createdAt: new Date().toISOString()
                }
            ];
            
            // Sample products
            const products = [
                {
                    id: 1,
                    title: 'Fresh Kapenta - 20kg',
                    description: 'Freshly caught kapenta from Lake Kariba. Good for business or family consumption.',
                    category: 'fish',
                    price: 80,
                    location: 'Siachilaba',
                    sellerId: 2,
                    sellerName: 'John Fishing',
                    sellerPhone: '263773456789',
                    whatsappLink: 'https://wa.me/263773456789?text=Hi! I saw your Fresh Kapenta - 20kg on Binga Marketplace',
                    status: 'active',
                    approved: true,
                    adminApproved: true,
                    featured: true,
                    views: 45,
                    createdAt: new Date().toISOString()
                },
                {
                    id: 2,
                    title: 'Local Goats - 3 Available',
                    description: 'Healthy local goats, 6-8 months old. Perfect for ceremonies or breeding.',
                    category: 'goat',
                    price: 60,
                    location: 'Kariyangwe',
                    sellerId: 3,
                    sellerName: 'Mary Livestock',
                    sellerPhone: '263774567890',
                    whatsappLink: 'https://wa.me/263774567890?text=Hi! I saw your Local Goats - 3 Available on Binga Marketplace',
                    status: 'active',
                    approved: true,
                    adminApproved: true,
                    featured: true,
                    views: 32,
                    createdAt: new Date().toISOString()
                }
            ];
            
            // Sample system logs
            const systemLogs = [
                {
                    id: 1,
                    type: 'system',
                    action: 'database_initialized',
                    details: 'Database initialized with sample data',
                    userId: 1,
                    timestamp: new Date().toISOString(),
                    ip: '127.0.0.1',
                    userAgent: navigator.userAgent
                }
            ];
            
            // Admin settings
            const adminSettings = [
                {
                    id: 'general',
                    siteName: 'Binga Marketplace',
                    adminEmail: 'admin@bingamarket.co.zw',
                    adminPhone: '263772863815',
                    autoApproveProducts: false,
                    maxMediaPerItem: 20,
                    maxFileSizeMB: 10,
                    maintenanceMode: false,
                    updatedAt: new Date().toISOString()
                }
            ];
            
            // Add all data to respective stores
            users.forEach(user => transaction.objectStore('users').add(user));
            categories.forEach(cat => transaction.objectStore('categories').add(cat));
            locations.forEach(loc => transaction.objectStore('locations').add(loc));
            attractionTypes.forEach(type => transaction.objectStore('attractionTypes').add(type));
            attractions.forEach(att => transaction.objectStore('attractions').add(att));
            products.forEach(product => transaction.objectStore('products').add(product));
            systemLogs.forEach(log => transaction.objectStore('systemLogs').add(log));
            adminSettings.forEach(setting => transaction.objectStore('adminSettings').add(setting));
            
            transaction.oncomplete = () => {
                console.log('Sample data added to IndexedDB');
            };
        }
        
        // Enhanced Database operations with admin features
        const BINGA_MARKETPLACE_DB = {
            // User operations
            users: {
                async getAll() {
                    const transaction = db.transaction(['users'], 'readonly');
                    const store = transaction.objectStore('users');
                    return new Promise((resolve, reject) => {
                        const request = store.getAll();
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async get(id) {
                    const transaction = db.transaction(['users'], 'readonly');
                    const store = transaction.objectStore('users');
                    return new Promise((resolve, reject) => {
                        const request = store.get(id);
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async add(user) {
                    const transaction = db.transaction(['users'], 'readwrite');
                    const store = transaction.objectStore('users');
                    return new Promise((resolve, reject) => {
                        const request = store.add(user);
                        request.onsuccess = () => resolve(user);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async update(id, updates) {
                    const user = await this.get(id);
                    if (user) {
                        const updatedUser = {...user, ...updates};
                        const transaction = db.transaction(['users'], 'readwrite');
                        const store = transaction.objectStore('users');
                        return new Promise((resolve, reject) => {
                            const request = store.put(updatedUser);
                            request.onsuccess = () => resolve(updatedUser);
                            request.onerror = () => reject(request.error);
                        });
                    }
                    return null;
                },
                
                async delete(id) {
                    const transaction = db.transaction(['users'], 'readwrite');
                    const store = transaction.objectStore('users');
                    return new Promise((resolve, reject) => {
                        const request = store.delete(id);
                        request.onsuccess = () => resolve(true);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async findByUsername(username) {
                    const transaction = db.transaction(['users'], 'readonly');
                    const store = transaction.objectStore('users');
                    const index = store.index('username');
                    return new Promise((resolve, reject) => {
                        const request = index.get(username);
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async getSellers() {
                    const users = await this.getAll();
                    return users.filter(u => u.type === 'seller');
                },
                
                async getAdmins() {
                    const users = await this.getAll();
                    return users.filter(u => u.type === 'admin');
                },
                
                async getSuperAdmins() {
                    const users = await this.getAll();
                    return users.filter(u => u.role === 'superadmin');
                }
            },
            
            // Product operations with admin features
            products: {
                async getAll() {
                    const transaction = db.transaction(['products'], 'readonly');
                    const store = transaction.objectStore('products');
                    return new Promise((resolve, reject) => {
                        const request = store.getAll();
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async get(id) {
                    const transaction = db.transaction(['products'], 'readonly');
                    const store = transaction.objectStore('products');
                    return new Promise((resolve, reject) => {
                        const request = store.get(id);
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async add(product) {
                    const transaction = db.transaction(['products'], 'readwrite');
                    const store = transaction.objectStore('products');
                    return new Promise((resolve, reject) => {
                        const request = store.add(product);
                        request.onsuccess = () => resolve(product);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async update(id, updates) {
                    const product = await this.get(id);
                    if (product) {
                        const updatedProduct = {...product, ...updates};
                        const transaction = db.transaction(['products'], 'readwrite');
                        const store = transaction.objectStore('products');
                        return new Promise((resolve, reject) => {
                            const request = store.put(updatedProduct);
                            request.onsuccess = () => resolve(updatedProduct);
                            request.onerror = () => reject(request.error);
                        });
                    }
                    return null;
                },
                
                async delete(id) {
                    // Delete associated media
                    await BINGA_MARKETPLACE_DB.media.deleteByEntity(id, 'product');
                    
                    // Delete the product
                    const transaction = db.transaction(['products'], 'readwrite');
                    const store = transaction.objectStore('products');
                    return new Promise((resolve, reject) => {
                        const request = store.delete(id);
                        request.onsuccess = () => resolve(true);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async getActive(limit = null, offset = 0) {
                    const products = await this.getAll();
                    const activeProducts = products.filter(p => p.status === 'active' && p.approved && p.adminApproved);
                    
                    if (limit) {
                        return activeProducts.slice(offset, offset + limit);
                    }
                    return activeProducts;
                },
                
                async getPending() {
                    const products = await this.getAll();
                    return products.filter(p => !p.adminApproved || p.status === 'pending');
                },
                
                async getByCategory(category, limit = null, offset = 0) {
                    const products = await this.getAll();
                    const filtered = products.filter(p => p.category === category && p.status === 'active' && p.approved && p.adminApproved);
                    
                    if (limit) {
                        return filtered.slice(offset, offset + limit);
                    }
                    return filtered;
                },
                
                async getBySeller(sellerId) {
                    const products = await this.getAll();
                    return products.filter(p => p.sellerId === sellerId);
                },
                
                async count() {
                    const products = await this.getAll();
                    return products.length;
                },
                
                async countActive() {
                    const products = await this.getAll();
                    return products.filter(p => p.status === 'active' && p.approved && p.adminApproved).length;
                },
                
                async search(query, category = null, location = null, limit = 20, offset = 0) {
                    const products = await this.getAll();
                    let filtered = products.filter(p => p.status === 'active' && p.approved && p.adminApproved);
                    
                    if (query) {
                        const q = query.toLowerCase();
                        filtered = filtered.filter(p => 
                            p.title.toLowerCase().includes(q) || 
                            p.description.toLowerCase().includes(q)
                        );
                    }
                    
                    if (category) {
                        filtered = filtered.filter(p => p.category === category);
                    }
                    
                    if (location) {
                        filtered = filtered.filter(p => p.location === location);
                    }
                    
                    return filtered.slice(offset, offset + limit);
                }
            },
            
            // Tourist Attraction operations
            attractions: {
                async getAll() {
                    const transaction = db.transaction(['attractions'], 'readonly');
                    const store = transaction.objectStore('attractions');
                    return new Promise((resolve, reject) => {
                        const request = store.getAll();
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async get(id) {
                    const transaction = db.transaction(['attractions'], 'readonly');
                    const store = transaction.objectStore('attractions');
                    return new Promise((resolve, reject) => {
                        const request = store.get(id);
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async add(attraction) {
                    const transaction = db.transaction(['attractions'], 'readwrite');
                    const store = transaction.objectStore('attractions');
                    return new Promise((resolve, reject) => {
                        const request = store.add(attraction);
                        request.onsuccess = () => resolve(attraction);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async update(id, updates) {
                    const attraction = await this.get(id);
                    if (attraction) {
                        const updatedAttraction = {...attraction, ...updates};
                        const transaction = db.transaction(['attractions'], 'readwrite');
                        const store = transaction.objectStore('attractions');
                        return new Promise((resolve, reject) => {
                            const request = store.put(updatedAttraction);
                            request.onsuccess = () => resolve(updatedAttraction);
                            request.onerror = () => reject(request.error);
                        });
                    }
                    return null;
                },
                
                async delete(id) {
                    // Delete associated media
                    await BINGA_MARKETPLACE_DB.media.deleteByEntity(id, 'attraction');
                    
                    // Delete attraction
                    const transaction = db.transaction(['attractions'], 'readwrite');
                    const store = transaction.objectStore('attractions');
                    return new Promise((resolve, reject) => {
                        const request = store.delete(id);
                        request.onsuccess = () => resolve(true);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async getActive(limit = null, offset = 0) {
                    const attractions = await this.getAll();
                    const active = attractions.filter(a => a.status === 'active' && a.adminApproved);
                    
                    if (limit) {
                        return active.slice(offset, offset + limit);
                    }
                    return active;
                },
                
                async getPending() {
                    const attractions = await this.getAll();
                    return attractions.filter(a => !a.adminApproved);
                },
                
                async count() {
                    const attractions = await this.getAll();
                    return attractions.length;
                }
            },
            
            // Media operations
            media: {
                async getAll() {
                    const transaction = db.transaction(['media'], 'readonly');
                    const store = transaction.objectStore('media');
                    return new Promise((resolve, reject) => {
                        const request = store.getAll();
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async get(id) {
                    const transaction = db.transaction(['media'], 'readonly');
                    const store = transaction.objectStore('media');
                    return new Promise((resolve, reject) => {
                        const request = store.get(id);
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async add(mediaItem) {
                    const transaction = db.transaction(['media'], 'readwrite');
                    const store = transaction.objectStore('media');
                    return new Promise((resolve, reject) => {
                        const request = store.add(mediaItem);
                        request.onsuccess = () => resolve(mediaItem);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async update(id, updates) {
                    const mediaItem = await this.get(id);
                    if (mediaItem) {
                        const updatedMedia = {...mediaItem, ...updates};
                        const transaction = db.transaction(['media'], 'readwrite');
                        const store = transaction.objectStore('media');
                        return new Promise((resolve, reject) => {
                            const request = store.put(updatedMedia);
                            request.onsuccess = () => resolve(updatedMedia);
                            request.onerror = () => reject(request.error);
                        });
                    }
                    return null;
                },
                
                async delete(id) {
                    const transaction = db.transaction(['media'], 'readwrite');
                    const store = transaction.objectStore('media');
                    return new Promise((resolve, reject) => {
                        const request = store.delete(id);
                        request.onsuccess = () => resolve(true);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async getByEntity(entityId, entityType, limit = null, offset = 0) {
                    const transaction = db.transaction(['media'], 'readonly');
                    const store = transaction.objectStore('media');
                    const index = store.index('entityId');
                    
                    return new Promise((resolve, reject) => {
                        const request = index.getAll(entityId);
                        request.onsuccess = () => {
                            let media = request.result.filter(m => m.entityType === entityType);
                            media.sort((a, b) => new Date(b.uploadedAt) - new Date(a.uploadedAt));
                            
                            if (limit) {
                                media = media.slice(offset, offset + limit);
                            }
                            resolve(media);
                        };
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async deleteByEntity(entityId, entityType) {
                    const mediaItems = await this.getByEntity(entityId, entityType);
                    const transaction = db.transaction(['media'], 'readwrite');
                    const store = transaction.objectStore('media');
                    
                    return Promise.all(
                        mediaItems.map(item => 
                            new Promise((resolve, reject) => {
                                const request = store.delete(item.id);
                                request.onsuccess = () => resolve(true);
                                request.onerror = () => reject(request.error);
                            })
                        )
                    );
                },
                
                async count() {
                    const media = await this.getAll();
                    return media.length;
                },
                
                async countByEntity(entityId, entityType) {
                    const media = await this.getByEntity(entityId, entityType);
                    return media.length;
                },
                
                async getStorageStats() {
                    const media = await this.getAll();
                    let totalSize = 0;
                    
                    media.forEach(item => {
                        totalSize += item.size || 0;
                    });
                    
                    return {
                        count: media.length,
                        totalSize: totalSize,
                        formattedSize: formatBytes(totalSize)
                    };
                }
            },
            
            // Categories operations
            categories: {
                async getAll() {
                    const transaction = db.transaction(['categories'], 'readonly');
                    const store = transaction.objectStore('categories');
                    return new Promise((resolve, reject) => {
                        const request = store.getAll();
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async add(category) {
                    const transaction = db.transaction(['categories'], 'readwrite');
                    const store = transaction.objectStore('categories');
                    return new Promise((resolve, reject) => {
                        const request = store.add(category);
                        request.onsuccess = () => resolve(category);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async update(id, updates) {
                    const category = await this.get(id);
                    if (category) {
                        const updatedCategory = {...category, ...updates};
                        const transaction = db.transaction(['categories'], 'readwrite');
                        const store = transaction.objectStore('categories');
                        return new Promise((resolve, reject) => {
                            const request = store.put(updatedCategory);
                            request.onsuccess = () => resolve(updatedCategory);
                            request.onerror = () => reject(request.error);
                        });
                    }
                    return null;
                },
                
                async delete(id) {
                    const transaction = db.transaction(['categories'], 'readwrite');
                    const store = transaction.objectStore('categories');
                    return new Promise((resolve, reject) => {
                        const request = store.delete(id);
                        request.onsuccess = () => resolve(true);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async get(id) {
                    const transaction = db.transaction(['categories'], 'readonly');
                    const store = transaction.objectStore('categories');
                    return new Promise((resolve, reject) => {
                        const request = store.get(id);
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                }
            },
            
            // Locations operations
            locations: {
                async getAll() {
                    const transaction = db.transaction(['locations'], 'readonly');
                    const store = transaction.objectStore('locations');
                    return new Promise((resolve, reject) => {
                        const request = store.getAll();
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async add(location) {
                    const transaction = db.transaction(['locations'], 'readwrite');
                    const store = transaction.objectStore('locations');
                    return new Promise((resolve, reject) => {
                        const request = store.add(location);
                        request.onsuccess = () => resolve(location);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async update(id, updates) {
                    const location = await this.get(id);
                    if (location) {
                        const updatedLocation = {...location, ...updates};
                        const transaction = db.transaction(['locations'], 'readwrite');
                        const store = transaction.objectStore('locations');
                        return new Promise((resolve, reject) => {
                            const request = store.put(updatedLocation);
                            request.onsuccess = () => resolve(updatedLocation);
                            request.onerror = () => reject(request.error);
                        });
                    }
                    return null;
                },
                
                async delete(id) {
                    const transaction = db.transaction(['locations'], 'readwrite');
                    const store = transaction.objectStore('locations');
                    return new Promise((resolve, reject) => {
                        const request = store.delete(id);
                        request.onsuccess = () => resolve(true);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async get(id) {
                    const transaction = db.transaction(['locations'], 'readonly');
                    const store = transaction.objectStore('locations');
                    return new Promise((resolve, reject) => {
                        const request = store.get(id);
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                }
            },
            
            // Attraction Types operations
            attractionTypes: {
                async getAll() {
                    const transaction = db.transaction(['attractionTypes'], 'readonly');
                    const store = transaction.objectStore('attractionTypes');
                    return new Promise((resolve, reject) => {
                        const request = store.getAll();
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                }
            },
            
            // System Logs operations
            systemLogs: {
                async getAll() {
                    const transaction = db.transaction(['systemLogs'], 'readonly');
                    const store = transaction.objectStore('systemLogs');
                    return new Promise((resolve, reject) => {
                        const request = store.getAll();
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async add(log) {
                    const transaction = db.transaction(['systemLogs'], 'readwrite');
                    const store = transaction.objectStore('systemLogs');
                    return new Promise((resolve, reject) => {
                        const request = store.add(log);
                        request.onsuccess = () => resolve(log);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async clearAll() {
                    const transaction = db.transaction(['systemLogs'], 'readwrite');
                    const store = transaction.objectStore('systemLogs');
                    return new Promise((resolve, reject) => {
                        const request = store.clear();
                        request.onsuccess = () => resolve(true);
                        request.onerror = () => reject(request.error);
                    });
                }
            },
            
            // Admin Settings operations
            adminSettings: {
                async get(id) {
                    const transaction = db.transaction(['adminSettings'], 'readonly');
                    const store = transaction.objectStore('adminSettings');
                    return new Promise((resolve, reject) => {
                        const request = store.get(id);
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async update(id, updates) {
                    const setting = await this.get(id);
                    if (setting) {
                        const updatedSetting = {...setting, ...updates, updatedAt: new Date().toISOString()};
                        const transaction = db.transaction(['adminSettings'], 'readwrite');
                        const store = transaction.objectStore('adminSettings');
                        return new Promise((resolve, reject) => {
                            const request = store.put(updatedSetting);
                            request.onsuccess = () => resolve(updatedSetting);
                            request.onerror = () => reject(request.error);
                        });
                    } else {
                        const newSetting = {id, ...updates, updatedAt: new Date().toISOString()};
                        const transaction = db.transaction(['adminSettings'], 'readwrite');
                        const store = transaction.objectStore('adminSettings');
                        return new Promise((resolve, reject) => {
                            const request = store.add(newSetting);
                            request.onsuccess = () => resolve(newSetting);
                            request.onerror = () => reject(request.error);
                        });
                    }
                }
            },
            
            // Backups operations
            backups: {
                async getAll() {
                    const transaction = db.transaction(['backups'], 'readonly');
                    const store = transaction.objectStore('backups');
                    return new Promise((resolve, reject) => {
                        const request = store.getAll();
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async add(backup) {
                    const transaction = db.transaction(['backups'], 'readwrite');
                    const store = transaction.objectStore('backups');
                    return new Promise((resolve, reject) => {
                        const request = store.add(backup);
                        request.onsuccess = () => resolve(backup);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async delete(id) {
                    const transaction = db.transaction(['backups'], 'readwrite');
                    const store = transaction.objectStore('backups');
                    return new Promise((resolve, reject) => {
                        const request = store.delete(id);
                        request.onsuccess = () => resolve(true);
                        request.onerror = () => reject(request.error);
                    });
                }
            },
            
            // Export all data
            async exportAllData() {
                const allData = {};
                const stores = Object.keys(DB_SCHEMA);
                
                for (const storeName of stores) {
                    try {
                        const transaction = db.transaction([storeName], 'readonly');
                        const store = transaction.objectStore(storeName);
                        allData[storeName] = await new Promise((resolve, reject) => {
                            const request = store.getAll();
                            request.onsuccess = () => resolve(request.result);
                            request.onerror = () => reject(request.error);
                        });
                    } catch (error) {
                        console.error(`Error exporting ${storeName}:`, error);
                        allData[storeName] = [];
                    }
                }
                
                return allData;
            },
            
            // Import all data
            async importAllData(data) {
                const stores = Object.keys(data);
                
                for (const storeName of stores) {
                    try {
                        // Clear existing data
                        const clearTransaction = db.transaction([storeName], 'readwrite');
                        const clearStore = clearTransaction.objectStore(storeName);
                        await new Promise((resolve, reject) => {
                            const request = clearStore.clear();
                            request.onsuccess = () => resolve(true);
                            request.onerror = () => reject(request.error);
                        });
                        
                        // Add new data
                        const items = data[storeName];
                        for (const item of items) {
                            const transaction = db.transaction([storeName], 'readwrite');
                            const store = transaction.objectStore(storeName);
                            await new Promise((resolve, reject) => {
                                const request = store.add(item);
                                request.onsuccess = () => resolve(item);
                                request.onerror = () => reject(request.error);
                            });
                        }
                    } catch (error) {
                        console.error(`Error importing ${storeName}:`, error);
                        throw error;
                    }
                }
            },
            
            // Clear all data (reset)
            async clearAllData() {
                const stores = Object.keys(DB_SCHEMA);
                
                for (const storeName of stores) {
                    try {
                        const transaction = db.transaction([storeName], 'readwrite');
                        const store = transaction.objectStore(storeName);
                        await new Promise((resolve, reject) => {
                            const request = store.clear();
                            request.onsuccess = () => resolve(true);
                            request.onerror = () => reject(request.error);
                        });
                    } catch (error) {
                        console.error(`Error clearing ${storeName}:`, error);
                        throw error;
                    }
                }
                
                // Reinitialize with sample data
                await addSampleData(db);
            }
        };
        
        // Utility function to format bytes
        function formatBytes(bytes, decimals = 2) {
            if (bytes === 0) return '0 Bytes';
            
            const k = 1024;
            const dm = decimals < 0 ? 0 : decimals;
            const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
            
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            
            return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
        }
        
        // Initialize the application
        async function initApp() {
            try {
                // Initialize IndexedDB
                await initDB();
                
                // Check if user is already logged in
                const savedUser = localStorage.getItem('binga_admin_user');
                if (savedUser) {
                    try {
                        currentUser = JSON.parse(savedUser);
                        // Verify user still exists in database
                        const userExists = await BINGA_MARKETPLACE_DB.users.get(currentUser.id);
                        if (userExists && userExists.type === 'admin') {
                            currentUser = userExists;
                            localStorage.setItem('binga_admin_user', JSON.stringify(currentUser));
                            updateAuthUI();
                            loadAdminDashboard();
                        } else {
                            localStorage.removeItem('binga_admin_user');
                            currentUser = null;
                            showAuthButtons();
                        }
                    } catch (e) {
                        localStorage.removeItem('binga_admin_user');
                        currentUser = null;
                        showAuthButtons();
                    }
                } else {
                    showAuthButtons();
                }
                
                // Add system log for initialization
                await addSystemLog('system', 'app_initialized', 'Administrator control panel initialized');
                
                console.log('Admin application initialized successfully');
            } catch (error) {
                console.error('Error initializing admin app:', error);
                showAlert('Error initializing administrator control panel. Please refresh the page.', 'error');
            }
        }
        
        // Show auth buttons (only for admin)
        function showAuthButtons() {
            document.getElementById('authButtons').innerHTML = `
                <button class="auth-btn login" onclick="openAuthModal('login')">
                    <i class="fas fa-user-shield"></i> Admin Login
                </button>
            `;
            document.getElementById('userMenu').style.display = 'none';
            document.getElementById('authButtons').style.display = 'flex';
        }
        
        // Update auth UI after login
        function updateAuthUI() {
            if (currentUser && currentUser.type === 'admin') {
                document.getElementById('authButtons').style.display = 'none';
                document.getElementById('userMenu').style.display = 'flex';
                
                document.getElementById('userName').innerHTML = `${currentUser.name} <span class="role-badge">${currentUser.role.toUpperCase()}</span>`;
                document.getElementById('userAvatar').textContent = 
                    currentUser.name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
                
                loadAdminDashboard();
            } else {
                showAuthButtons();
            }
        }
        
        // Open auth modal
        function openAuthModal(form = 'login') {
            const modal = document.getElementById('authModal');
            modal.style.display = 'flex';
            showAuthForm(form);
        }
        
        // Close auth modal
        function closeAuthModal() {
            document.getElementById('authModal').style.display = 'none';
        }
        
        // Show login or create form
        function showAuthForm(form) {
            const loginForm = document.getElementById('loginForm');
            const createForm = document.getElementById('createForm');
            const tabs = document.querySelectorAll('.auth-tab');
            
            if (form === 'login') {
                loginForm.style.display = 'block';
                createForm.style.display = 'none';
                tabs[0].classList.add('active');
                tabs[1].classList.remove('active');
            } else {
                loginForm.style.display = 'none';
                createForm.style.display = 'block';
                tabs[0].classList.remove('active');
                tabs[1].classList.add('active');
            }
        }
        
        // Login function
        async function login() {
            const username = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            if (!username || !password) {
                alert('Please enter username and password');
                return;
            }
            
            try {
                const users = await BINGA_MARKETPLACE_DB.users.getAll();
                const user = users.find(u => 
                    u.username === username && 
                    u.password === password &&
                    u.type === 'admin'
                );
                
                if (user) {
                    currentUser = user;
                    localStorage.setItem('binga_admin_user', JSON.stringify(user));
                    updateAuthUI();
                    closeAuthModal();
                    
                    document.getElementById('loginEmail').value = '';
                    document.getElementById('loginPassword').value = '';
                    
                    await addSystemLog('auth', 'admin_login', `Admin ${user.name} logged in`, user.id);
                    
                    showAlert(`Welcome back, ${user.name}! You have full administrative control.`, 'success');
                    
                    loadAdminDashboard();
                } else {
                    alert('Invalid admin credentials. Username: Munkuli#1996, Password: Wiseman');
                }
            } catch (error) {
                console.error('Login error:', error);
                alert('Error during login. Please try again.');
            }
        }
        
        // Create admin function
        async function createAdmin() {
            if (!currentUser || currentUser.role !== 'superadmin') {
                alert('Only super administrators can create new admin accounts.');
                return;
            }
            
            const name = document.getElementById('createName').value.trim();
            const username = document.getElementById('createUsername').value.trim();
            const password = document.getElementById('createPassword').value;
            const confirmPassword = document.getElementById('createConfirmPassword').value;
            const role = document.getElementById('createRole').value;
            
            if (!name || !username || !password || !confirmPassword) {
                alert('Please fill all required fields');
                return;
            }
            
            if (password !== confirmPassword) {
                alert('Passwords do not match');
                return;
            }
            
            try {
                const users = await BINGA_MARKETPLACE_DB.users.getAll();
                
                if (users.find(u => u.username === username)) {
                    alert('Username already taken. Please choose another one.');
                    return;
                }
                
                const newAdmin = {
                    id: Date.now(),
                    username: username,
                    password: password,
                    name: name,
                    phone: '',
                    email: '',
                    location: 'Binga Centre',
                    type: 'admin',
                    role: role,
                    permissions: role === 'superadmin' ? ['all'] : ['manage_users', 'manage_products', 'manage_attractions'],
                    registered: new Date().toISOString(),
                    lastLogin: null,
                    products: [],
                    rating: 0,
                    approved: true,
                    status: 'active',
                    isSuperAdmin: role === 'superadmin',
                    createdBy: currentUser.id
                };
                
                await BINGA_MARKETPLACE_DB.users.add(newAdmin);
                
                await addSystemLog('admin', 'admin_created', `Created new ${role} account: ${name}`, currentUser.id);
                
                showAlert(`New ${role} account created successfully!`, 'success');
                
                // Clear form
                document.getElementById('createName').value = '';
                document.getElementById('createUsername').value = '';
                document.getElementById('createPassword').value = '';
                document.getElementById('createConfirmPassword').value = '';
                
                showAuthForm('login');
            } catch (error) {
                console.error('Error creating admin:', error);
                alert('Error creating admin account. Please try again.');
            }
        }
        
        // Logout function
        async function logout() {
            if (confirm('Are you sure you want to logout?')) {
                if (currentUser) {
                    await addSystemLog('auth', 'admin_logout', `Admin ${currentUser.name} logged out`, currentUser.id);
                }
                
                currentUser = null;
                localStorage.removeItem('binga_admin_user');
                showAuthButtons();
                showAlert('Logged out successfully', 'success');
            }
        }
        
        // Show section
        function showSection(section) {
            // Hide all sections
            const sections = [
                'dashboardSection', 'manageSection', 'usersSection', 'productsSection',
                'attractionsSection', 'databaseSection', 'systemSection', 'logsSection',
                'quickActionsSection', 'userFormSection', 'productFormSection', 'attractionFormSection'
            ];
            
            sections.forEach(sec => {
                document.getElementById(sec).style.display = 'none';
            });
            
            // Show selected section
            document.getElementById(section + 'Section').style.display = 'block';
            
            // Load content for the section
            switch(section) {
                case 'dashboard':
                    loadAdminDashboard();
                    break;
                case 'manage':
                    loadManageEverything();
                    break;
                case 'users':
                    loadAllUsers();
                    break;
                case 'products':
                    loadAllProducts();
                    break;
                case 'attractions':
                    loadAllAttractions();
                    break;
                case 'database':
                    loadDatabaseManagement();
                    break;
                case 'system':
                    loadSystemConfiguration();
                    break;
                case 'logs':
                    loadSystemLogsDisplay();
                    break;
                case 'quickActions':
                    loadQuickActions();
                    break;
            }
            
            setActiveNav(section);
        }
        
        // Set active navigation
        function setActiveNav(section) {
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            const navLinks = document.querySelectorAll('.nav-link');
            for (let link of navLinks) {
                if (link.textContent.toLowerCase().includes(section.toLowerCase()) || 
                    (section === 'dashboard' && link.textContent.toLowerCase().includes('dashboard'))) {
                    link.classList.add('active');
                    break;
                }
            }
        }
        
        // Load admin dashboard
        async function loadAdminDashboard() {
            if (!currentUser || currentUser.type !== 'admin') return;
            
            try {
                // Get all statistics
                const users = await BINGA_MARKETPLACE_DB.users.getAll();
                const products = await BINGA_MARKETPLACE_DB.products.getAll();
                const attractions = await BINGA_MARKETPLACE_DB.attractions.getAll();
                const mediaStats = await BINGA_MARKETPLACE_DB.media.getStorageStats();
                
                const totalUsers = users.length;
                const totalAdmins = users.filter(u => u.type === 'admin').length;
                const totalSellers = users.filter(u => u.type === 'seller').length;
                const totalProducts = products.length;
                const activeProducts = products.filter(p => p.status === 'active' && p.approved && p.adminApproved).length;
                const pendingProducts = products.filter(p => !p.adminApproved).length;
                const totalAttractions = attractions.length;
                const activeAttractions = attractions.filter(a => a.status === 'active' && a.adminApproved).length;
                
                // Update quick stats
                document.getElementById('quickStats').innerHTML = `
                    <div class="quick-stat">
                        <div class="quick-stat-number">${totalUsers}</div>
                        <div>Total Users</div>
                    </div>
                    <div class="quick-stat">
                        <div class="quick-stat-number">${totalAdmins}</div>
                        <div>Administrators</div>
                    </div>
                    <div class="quick-stat">
                        <div class="quick-stat-number">${totalSellers}</div>
                        <div>Sellers</div>
                    </div>
                    <div class="quick-stat">
                        <div class="quick-stat-number">${totalProducts}</div>
                        <div>Products</div>
                    </div>
                    <div class="quick-stat">
                        <div class="quick-stat-number">${pendingProducts}</div>
                        <div>Pending Approval</div>
                    </div>
                    <div class="quick-stat">
                        <div class="quick-stat-number">${totalAttractions}</div>
                        <div>Attractions</div>
                    </div>
                `;
                
                // Update recent activity
                const recentLogs = systemLogs.slice(0, 10);
                document.getElementById('recentActivity').innerHTML = `
                    <div class="system-logs">
                        ${recentLogs.length > 0 ? 
                            recentLogs.map(log => `
                                <div class="log-entry ${log.type}">
                                    [${new Date(log.timestamp).toLocaleTimeString()}] ${log.action}: ${log.details}
                                </div>
                            `).join('') :
                            '<p>No recent activity</p>'
                        }
                    </div>
                `;
                
                // Update system info
                document.getElementById('systemInfo').innerHTML = `
                    <div class="system-info-item">
                        <strong>Database Size:</strong><br>
                        ${mediaStats.formattedSize}
                    </div>
                    <div class="system-info-item">
                        <strong>Media Files:</strong><br>
                        ${mediaStats.count} files
                    </div>
                    <div class="system-info-item">
                        <strong>Your Role:</strong><br>
                        ${currentUser.role}
                    </div>
                    <div class="system-info-item">
                        <strong>Last Login:</strong><br>
                        ${currentUser.lastLogin ? new Date(currentUser.lastLogin).toLocaleString() : 'Never'}
                    </div>
                `;
                
            } catch (error) {
                console.error('Error loading admin dashboard:', error);
            }
        }
        
        // Load manage everything
        async function loadManageEverything() {
            if (!currentUser || currentUser.type !== 'admin') return;
            
            const container = document.getElementById('manageContent');
            container.innerHTML = `
                <div class="admin-controls">
                    <h3><i class="fas fa-user-shield"></i> SUPER ADMIN CONTROL PANEL</h3>
                    <div class="admin-buttons">
                        <button class="admin-button" onclick="showManageTab('pending')">
                            <i class="fas fa-clock"></i> Pending Approvals
                        </button>
                        <button class="admin-button secondary" onclick="showManageTab('products')">
                            <i class="fas fa-boxes"></i> All Products
                        </button>
                        <button class="admin-button" onclick="showManageTab('users')">
                            <i class="fas fa-users"></i> All Users
                        </button>
                        <button class="admin-button secondary" onclick="showManageTab('attractions')">
                            <i class="fas fa-camera"></i> Attractions
                        </button>
                        <button class="admin-button" onclick="showManageTab('media')">
                            <i class="fas fa-images"></i> All Media
                        </button>
                        <button class="admin-button danger" onclick="showManageTab('system')">
                            <i class="fas fa-cog"></i> System Settings
                        </button>
                    </div>
                </div>
                <div id="manageTabContent">
                    <!-- Tab content will be loaded here -->
                </div>
            `;
            
            // Load default tab
            showManageTab('pending');
        }
        
        // Show manage tab
        async function showManageTab(tab) {
            const container = document.getElementById('manageTabContent');
            
            switch(tab) {
                case 'pending':
                    await loadPendingApprovals();
                    break;
                case 'products':
                    await loadAllProductsForManage();
                    break;
                case 'users':
                    await loadAllUsersForManage();
                    break;
                case 'attractions':
                    await loadAllAttractionsForManage();
                    break;
                case 'media':
                    await loadAllMedia();
                    break;
                case 'categories':
                    await loadCategoriesForManage();
                    break;
                case 'locations':
                    await loadLocationsForManage();
                    break;
                case 'system':
                    await loadSystemSettings();
                    break;
            }
            
            // Update active tab
            document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`.admin-tab[onclick="showManageTab('${tab}')"]`).classList.add('active');
        }
        
        // Load pending approvals
        async function loadPendingApprovals() {
            try {
                const products = await BINGA_MARKETPLACE_DB.products.getPending();
                const attractions = await BINGA_MARKETPLACE_DB.attractions.getPending();
                
                const container = document.getElementById('manageTabContent');
                container.innerHTML = `
                    <h3>Pending Approvals</h3>
                    
                    <h4 style="margin-top: 30px; color: var(--admin-red);">
                        <i class="fas fa-clock"></i> Products Awaiting Approval (${products.length})
                    </h4>
                    ${products.length > 0 ? 
                        `<div class="products-grid" style="margin-top: 20px;">
                            ${await Promise.all(products.map(async p => {
                                const media = await BINGA_MARKETPLACE_DB.media.getByEntity(p.id, 'product', 1, 0);
                                const icon = p.category === 'fish' ? 'ðŸŸ' : p.category === 'goat' ? 'ðŸ' : 'ðŸ“¦';
                                
                                let mediaElement = `<div style="font-size: 48px;">${icon}</div>`;
                                
                                if (media.length > 0) {
                                    const firstMedia = media[0];
                                    if (firstMedia.mediaType === 'image') {
                                        mediaElement = `<img src="${firstMedia.dataUrl}" alt="${p.title}">`;
                                    }
                                }
                                
                                return `
                                    <div class="product-card">
                                        <div class="product-image">
                                            ${mediaElement}
                                            <div class="product-price">$${p.price}</div>
                                        </div>
                                        <div class="product-details">
                                            <h3 class="product-title">${p.title}</h3>
                                            <p class="product-meta">${p.description.substring(0, 60)}...</p>
                                            <p class="product-meta">Seller: ${p.sellerName} (${p.sellerPhone})</p>
                                            <div class="product-location">
                                                <i class="fas fa-map-marker-alt"></i> ${p.location}
                                            </div>
                                            <div class="action-buttons">
                                                <button class="action-btn approve" onclick="approveProduct(${p.id})">
                                                    <i class="fas fa-check"></i> Approve
                                                </button>
                                                <button class="action-btn reject" onclick="rejectProduct(${p.id})">
                                                    <i class="fas fa-times"></i> Reject
                                                </button>
                                                <button class="action-btn view" onclick="viewProductDetails(${p.id})">
                                                    <i class="fas fa-eye"></i> View
                                                </button>
                                                <button class="action-btn delete" onclick="deleteProduct(${p.id})">
                                                    <i class="fas fa-trash"></i> Delete
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                `;
                            })).join('')}
                        </div>` :
                        `<p>No products pending approval</p>`
                    }
                    
                    <h4 style="margin-top: 40px; color: var(--tourist);">
                        <i class="fas fa-clock"></i> Attractions Awaiting Approval (${attractions.length})
                    </h4>
                    ${attractions.length > 0 ? 
                        `<div class="products-grid" style="margin-top: 20px;">
                            ${await Promise.all(attractions.map(async a => {
                                const media = await BINGA_MARKETPLACE_DB.media.getByEntity(a.id, 'attraction', 1, 0);
                                const icon = a.type === 'lake' ? 'ðŸŒŠ' : a.type === 'hotspring' ? 'â™¨ï¸' : 'ðŸžï¸';
                                
                                let mediaElement = `<div style="font-size: 48px;">${icon}</div>`;
                                
                                if (media.length > 0) {
                                    const firstMedia = media[0];
                                    if (firstMedia.mediaType === 'image') {
                                        mediaElement = `<img src="${firstMedia.dataUrl}" alt="${a.name}">`;
                                    }
                                }
                                
                                return `
                                    <div class="attraction-card">
                                        <div class="attraction-image">
                                            ${mediaElement}
                                            <div class="attraction-type">${a.typeName || a.type}</div>
                                        </div>
                                        <div class="product-details">
                                            <h3 class="product-title">${a.name}</h3>
                                            <p class="product-meta">${a.description.substring(0, 60)}...</p>
                                            <div class="product-location">
                                                <i class="fas fa-map-marker-alt"></i> ${a.location}
                                            </div>
                                            <div class="action-buttons">
                                                <button class="action-btn approve" onclick="approveAttraction(${a.id})">
                                                    <i class="fas fa-check"></i> Approve
                                                </button>
                                                <button class="action-btn reject" onclick="rejectAttraction(${a.id})">
                                                    <i class="fas fa-times"></i> Reject
                                                </button>
                                                <button class="action-btn edit" onclick="editAttraction(${a.id})">
                                                    <i class="fas fa-edit"></i> Edit
                                                </button>
                                                <button class="action-btn delete" onclick="deleteAttraction(${a.id})">
                                                    <i class="fas fa-trash"></i> Delete
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                `;
                            })).join('')}
                        </div>` :
                        `<p>No attractions pending approval</p>`
                    }
                `;
            } catch (error) {
                console.error('Error loading pending approvals:', error);
            }
        }
        
        // Approve product
        async function approveProduct(productId) {
            if (confirm('Approve this product?')) {
                try {
                    await BINGA_MARKETPLACE_DB.products.update(productId, {
                        adminApproved: true,
                        status: 'active'
                    });
                    
                    await addSystemLog('admin', 'product_approved', `Approved product ID: ${productId}`, currentUser.id);
                    
                    showAlert('Product approved successfully!', 'success');
                    loadPendingApprovals();
                } catch (error) {
                    console.error('Error approving product:', error);
                    alert('Error approving product');
                }
            }
        }
        
        // Reject product
        async function rejectProduct(productId) {
            const reason = prompt('Enter rejection reason:');
            if (reason) {
                try {
                    await BINGA_MARKETPLACE_DB.products.update(productId, {
                        adminApproved: false,
                        status: 'rejected',
                        rejectionReason: reason
                    });
                    
                    await addSystemLog('admin', 'product_rejected', `Rejected product ID: ${productId}. Reason: ${reason}`, currentUser.id);
                    
                    showAlert('Product rejected successfully!', 'success');
                    loadPendingApprovals();
                } catch (error) {
                    console.error('Error rejecting product:', error);
                    alert('Error rejecting product');
                }
            }
        }
        
        // Delete product
        async function deleteProduct(productId) {
            if (confirm('Permanently delete this product?')) {
                try {
                    await BINGA_MARKETPLACE_DB.products.delete(productId);
                    
                    await addSystemLog('admin', 'product_deleted', `Deleted product ID: ${productId}`, currentUser.id);
                    
                    showAlert('Product deleted successfully!', 'success');
                    loadPendingApprovals();
                } catch (error) {
                    console.error('Error deleting product:', error);
                    alert('Error deleting product');
                }
            }
        }
        
        // Approve attraction
        async function approveAttraction(attractionId) {
            if (confirm('Approve this attraction?')) {
                try {
                    await BINGA_MARKETPLACE_DB.attractions.update(attractionId, {
                        adminApproved: true,
                        status: 'active'
                    });
                    
                    await addSystemLog('admin', 'attraction_approved', `Approved attraction ID: ${attractionId}`, currentUser.id);
                    
                    showAlert('Attraction approved successfully!', 'success');
                    loadPendingApprovals();
                } catch (error) {
                    console.error('Error approving attraction:', error);
                    alert('Error approving attraction');
                }
            }
        }
        
        // Reject attraction
        async function rejectAttraction(attractionId) {
            const reason = prompt('Enter rejection reason:');
            if (reason) {
                try {
                    await BINGA_MARKETPLACE_DB.attractions.update(attractionId, {
                        adminApproved: false,
                        status: 'rejected',
                        rejectionReason: reason
                    });
                    
                    await addSystemLog('admin', 'attraction_rejected', `Rejected attraction ID: ${attractionId}. Reason: ${reason}`, currentUser.id);
                    
                    showAlert('Attraction rejected successfully!', 'success');
                    loadPendingApprovals();
                } catch (error) {
                    console.error('Error rejecting attraction:', error);
                    alert('Error rejecting attraction');
                }
            }
        }
        
        // Load all products for manage
        async function loadAllProductsForManage() {
            try {
                const products = await BINGA_MARKETPLACE_DB.products.getAll();
                const container = document.getElementById('manageTabContent');
                
                container.innerHTML = `
                    <h3>All Products (${products.length})</h3>
                    <div style="margin-bottom: 20px;">
                        <button class="admin-button" onclick="exportProducts()">
                            <i class="fas fa-download"></i> Export Products
                        </button>
                        <button class="admin-button secondary" onclick="importProducts()">
                            <i class="fas fa-upload"></i> Import Products
                        </button>
                        <button class="admin-button danger" onclick="deleteAllProducts()">
                            <i class="fas fa-trash"></i> Delete All Products
                        </button>
                    </div>
                    <div class="system-logs" style="max-height: 500px;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Title</th>
                                    <th>Category</th>
                                    <th>Price</th>
                                    <th>Seller</th>
                                    <th>Status</th>
                                    <th>Created</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${products.map(p => `
                                    <tr>
                                        <td>${p.id}</td>
                                        <td>${p.title}</td>
                                        <td>${p.category}</td>
                                        <td>$${p.price}</td>
                                        <td>${p.sellerName}</td>
                                        <td>
                                            <span class="status-badge ${p.adminApproved ? 'status-active' : 'status-pending'}">
                                                ${p.adminApproved ? 'Approved' : 'Pending'}
                                            </span>
                                        </td>
                                        <td>${new Date(p.createdAt).toLocaleDateString()}</td>
                                        <td>
                                            <button class="action-btn view" onclick="viewProductDetails(${p.id})" style="padding: 3px 8px; font-size: 12px;">
                                                View
                                            </button>
                                            <button class="action-btn edit" onclick="editProduct(${p.id})" style="padding: 3px 8px; font-size: 12px;">
                                                Edit
                                            </button>
                                            <button class="action-btn delete" onclick="deleteProduct(${p.id})" style="padding: 3px 8px; font-size: 12px;">
                                                Delete
                                            </button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            } catch (error) {
                console.error('Error loading all products:', error);
            }
        }
        
        // Load all users for manage
        async function loadAllUsersForManage() {
            try {
                const users = await BINGA_MARKETPLACE_DB.users.getAll();
                const container = document.getElementById('manageTabContent');
                
                container.innerHTML = `
                    <h3>All Users (${users.length})</h3>
                    <div style="margin-bottom: 20px;">
                        <button class="admin-button" onclick="createNewUser()">
                            <i class="fas fa-user-plus"></i> Create New User
                        </button>
                        <button class="admin-button secondary" onclick="createNewAdmin()">
                            <i class="fas fa-user-shield"></i> Create New Admin
                        </button>
                        <button class="admin-button danger" onclick="deleteAllUsers()">
                            <i class="fas fa-trash"></i> Delete All Users
                        </button>
                    </div>
                    <div class="system-logs" style="max-height: 500px;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Username</th>
                                    <th>Type</th>
                                    <th>Role</th>
                                    <th>Phone</th>
                                    <th>Location</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${users.map(u => `
                                    <tr>
                                        <td>${u.id}</td>
                                        <td>${u.name}</td>
                                        <td>${u.username}</td>
                                        <td>
                                            <span class="status-badge ${u.type === 'admin' ? 'status-admin' : 'status-active'}">
                                                ${u.type}
                                            </span>
                                        </td>
                                        <td>${u.role || 'N/A'}</td>
                                        <td>${u.phone}</td>
                                        <td>${u.location}</td>
                                        <td>
                                            <span class="status-badge ${u.approved ? 'status-active' : 'status-pending'}">
                                                ${u.approved ? 'Active' : 'Pending'}
                                            </span>
                                        </td>
                                        <td>
                                            <button class="action-btn edit" onclick="editUser(${u.id})" style="padding: 3px 8px; font-size: 12px;">
                                                Edit
                                            </button>
                                            ${u.id !== currentUser.id ? 
                                                `<button class="action-btn delete" onclick="deleteUser(${u.id})" style="padding: 3px 8px; font-size: 12px;">
                                                    Delete
                                                </button>` : 
                                                '<span style="color: #999;">Current</span>'
                                            }
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            } catch (error) {
                console.error('Error loading all users:', error);
            }
        }
        
        // Create new user
        async function createNewUser() {
            document.getElementById('manageSection').style.display = 'none';
            document.getElementById('userFormSection').style.display = 'block';
            
            document.getElementById('userFormTitle').textContent = 'Create New User';
            document.getElementById('userFormSubtitle').textContent = 'Create a new seller or admin account';
            
            document.getElementById('userFormContent').innerHTML = `
                <form id="newUserForm">
                    <div class="form-group">
                        <label class="form-label">Full Name*</label>
                        <input type="text" class="form-control" id="newUserName" placeholder="User's full name">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Username*</label>
                        <input type="text" class="form-control" id="newUserUsername" placeholder="Choose username">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Password*</label>
                        <input type="password" class="form-control" id="newUserPassword" placeholder="Create password">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Phone Number</label>
                        <input type="tel" class="form-control" id="newUserPhone" placeholder="263771234567">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-control" id="newUserEmail" placeholder="user@email.com">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Location</label>
                        <input type="text" class="form-control" id="newUserLocation" placeholder="Binga Centre">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Account Type*</label>
                        <select class="form-control" id="newUserType" onchange="toggleUserRole()">
                            <option value="seller">Seller</option>
                            <option value="admin">Administrator</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="roleField" style="display: none;">
                        <label class="form-label">Admin Role*</label>
                        <select class="form-control" id="newUserRole">
                            <option value="admin">Administrator</option>
                            <option value="superadmin">Super Administrator</option>
                            <option value="moderator">Moderator</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Account Status*</label>
                        <select class="form-control" id="newUserStatus">
                            <option value="active">Active</option>
                            <option value="pending">Pending Approval</option>
                            <option value="suspended">Suspended</option>
                        </select>
                    </div>
                    
                    <button type="button" class="btn btn-primary" onclick="saveNewUser()" style="margin-top: 20px;">
                        <i class="fas fa-save"></i> Create User
                    </button>
                    
                    <button type="button" class="btn" onclick="showSection('manage')" style="margin-top: 20px; margin-left: 10px; background: #f0f0f0;">
                        Cancel
                    </button>
                </form>
            `;
        }
        
        // Toggle user role field
        function toggleUserRole() {
            const userType = document.getElementById('newUserType').value;
            const roleField = document.getElementById('roleField');
            roleField.style.display = userType === 'admin' ? 'block' : 'none';
        }
        
        // Save new user
        async function saveNewUser() {
            const name = document.getElementById('newUserName').value.trim();
            const username = document.getElementById('newUserUsername').value.trim();
            const password = document.getElementById('newUserPassword').value;
            const phone = document.getElementById('newUserPhone').value;
            const email = document.getElementById('newUserEmail').value;
            const location = document.getElementById('newUserLocation').value;
            const type = document.getElementById('newUserType').value;
            const role = type === 'admin' ? document.getElementById('newUserRole').value : 'seller';
            const status = document.getElementById('newUserStatus').value;
            
            if (!name || !username || !password) {
                alert('Please fill all required fields');
                return;
            }
            
            try {
                const users = await BINGA_MARKETPLACE_DB.users.getAll();
                
                if (users.find(u => u.username === username)) {
                    alert('Username already taken. Please choose another one.');
                    return;
                }
                
                const newUser = {
                    id: Date.now(),
                    username: username,
                    password: password,
                    name: name,
                    phone: phone || '',
                    email: email || '',
                    location: location || 'Binga Centre',
                    type: type,
                    role: role,
                    permissions: type === 'admin' ? (role === 'superadmin' ? ['all'] : ['manage_products', 'manage_users']) : [],
                    registered: new Date().toISOString(),
                    lastLogin: null,
                    products: [],
                    rating: 0,
                    approved: status === 'active',
                    status: status,
                    isSuperAdmin: role === 'superadmin',
                    createdBy: currentUser.id
                };
                
                await BINGA_MARKETPLACE_DB.users.add(newUser);
                
                await addSystemLog('admin', 'user_created', `Created new ${type} account: ${name}`, currentUser.id);
                
                showAlert(`New ${type} account created successfully!`, 'success');
                
                showSection('manage');
                loadAllUsersForManage();
            } catch (error) {
                console.error('Error creating user:', error);
                alert('Error creating user account. Please try again.');
            }
        }
        
        // Edit user
        async function editUser(userId) {
            try {
                const user = await BINGA_MARKETPLACE_DB.users.get(userId);
                if (!user) {
                    alert('User not found');
                    return;
                }
                
                document.getElementById('manageSection').style.display = 'none';
                document.getElementById('userFormSection').style.display = 'block';
                
                document.getElementById('userFormTitle').textContent = 'Edit User';
                document.getElementById('userFormSubtitle').textContent = `Editing: ${user.name}`;
                
                document.getElementById('userFormContent').innerHTML = `
                    <form id="editUserForm">
                        <input type="hidden" id="editUserId" value="${user.id}">
                        
                        <div class="form-group">
                            <label class="form-label">Full Name*</label>
                            <input type="text" class="form-control" id="editUserName" value="${user.name}">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Username*</label>
                            <input type="text" class="form-control" id="editUserUsername" value="${user.username}">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Password (leave blank to keep current)</label>
                            <input type="password" class="form-control" id="editUserPassword" placeholder="New password">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Phone Number</label>
                            <input type="tel" class="form-control" id="editUserPhone" value="${user.phone || ''}">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" id="editUserEmail" value="${user.email || ''}">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Location</label>
                            <input type="text" class="form-control" id="editUserLocation" value="${user.location || ''}">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Account Type*</label>
                            <select class="form-control" id="editUserType" onchange="toggleEditUserRole()">
                                <option value="seller" ${user.type === 'seller' ? 'selected' : ''}>Seller</option>
                                <option value="admin" ${user.type === 'admin' ? 'selected' : ''}>Administrator</option>
                            </select>
                        </div>
                        
                        <div class="form-group" id="editRoleField" style="${user.type === 'admin' ? 'block' : 'none'}">
                            <label class="form-label">Admin Role*</label>
                            <select class="form-control" id="editUserRole">
                                <option value="admin" ${user.role === 'admin' ? 'selected' : ''}>Administrator</option>
                                <option value="superadmin" ${user.role === 'superadmin' ? 'selected' : ''}>Super Administrator</option>
                                <option value="moderator" ${user.role === 'moderator' ? 'selected' : ''}>Moderator</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Account Status*</label>
                            <select class="form-control" id="editUserStatus">
                                <option value="active" ${user.status === 'active' ? 'selected' : ''}>Active</option>
                                <option value="pending" ${user.status === 'pending' ? 'selected' : ''}>Pending Approval</option>
                                <option value="suspended" ${user.status === 'suspended' ? 'selected' : ''}>Suspended</option>
                            </select>
                        </div>
                        
                        <button type="button" class="btn btn-primary" onclick="saveEditedUser()" style="margin-top: 20px;">
                            <i class="fas fa-save"></i> Save Changes
                        </button>
                        
                        <button type="button" class="btn" onclick="showSection('manage')" style="margin-top: 20px; margin-left: 10px; background: #f0f0f0;">
                            Cancel
                        </button>
                    </form>
                `;
            } catch (error) {
                console.error('Error loading user for edit:', error);
                alert('Error loading user details');
            }
        }
        
        // Toggle edit user role field
        function toggleEditUserRole() {
            const userType = document.getElementById('editUserType').value;
            const roleField = document.getElementById('editRoleField');
            roleField.style.display = userType === 'admin' ? 'block' : 'none';
        }
        
        // Save edited user
        async function saveEditedUser() {
            const userId = parseInt(document.getElementById('editUserId').value);
            const name = document.getElementById('editUserName').value.trim();
            const username = document.getElementById('editUserUsername').value.trim();
            const password = document.getElementById('editUserPassword').value;
            const phone = document.getElementById('editUserPhone').value;
            const email = document.getElementById('editUserEmail').value;
            const location = document.getElementById('editUserLocation').value;
            const type = document.getElementById('editUserType').value;
            const role = type === 'admin' ? document.getElementById('editUserRole').value : 'seller';
            const status = document.getElementById('editUserStatus').value;
            
            if (!name || !username) {
                alert('Please fill all required fields');
                return;
            }
            
            try {
                const user = await BINGA_MARKETPLACE_DB.users.get(userId);
                if (!user) {
                    alert('User not found');
                    return;
                }
                
                // Check if username is already taken by another user
                const users = await BINGA_MARKETPLACE_DB.users.getAll();
                const existingUser = users.find(u => u.username === username && u.id !== userId);
                if (existingUser) {
                    alert('Username already taken. Please choose another one.');
                    return;
                }
                
                const updates = {
                    name: name,
                    username: username,
                    phone: phone || '',
                    email: email || '',
                    location: location || 'Binga Centre',
                    type: type,
                    role: role,
                    permissions: type === 'admin' ? (role === 'superadmin' ? ['all'] : ['manage_products', 'manage_users']) : [],
                    approved: status === 'active',
                    status: status,
                    isSuperAdmin: role === 'superadmin'
                };
                
                // Only update password if provided
                if (password) {
                    updates.password = password;
                }
                
                await BINGA_MARKETPLACE_DB.users.update(userId, updates);
                
                await addSystemLog('admin', 'user_updated', `Updated user account: ${name}`, currentUser.id);
                
                showAlert('User updated successfully!', 'success');
                
                showSection('manage');
                loadAllUsersForManage();
            } catch (error) {
                console.error('Error updating user:', error);
                alert('Error updating user account. Please try again.');
            }
        }
        
        // Delete user
        async function deleteUser(userId) {
            if (userId === currentUser.id) {
                alert('You cannot delete your own account!');
                return;
            }
            
            if (confirm('Permanently delete this user and all their data?')) {
                try {
                    // If user is a seller, delete their products
                    const user = await BINGA_MARKETPLACE_DB.users.get(userId);
                    if (user.type === 'seller') {
                        const userProducts = await BINGA_MARKETPLACE_DB.products.getBySeller(userId);
                        for (const product of userProducts) {
                            await BINGA_MARKETPLACE_DB.products.delete(product.id);
                        }
                    }
                    
                    // Delete the user
                    await BINGA_MARKETPLACE_DB.users.delete(userId);
                    
                    await addSystemLog('admin', 'user_deleted', `Deleted user account: ${user.name}`, currentUser.id);
                    
                    showAlert('User deleted successfully!', 'success');
                    loadAllUsersForManage();
                } catch (error) {
                    console.error('Error deleting user:', error);
                    alert('Error deleting user');
                }
            }
        }
        
        // Delete all users
        async function deleteAllUsers() {
            if (confirm('WARNING: This will delete ALL users except your current account. This action cannot be undone!')) {
                try {
                    const users = await BINGA_MARKETPLACE_DB.users.getAll();
                    
                    for (const user of users) {
                        if (user.id !== currentUser.id) {
                            await BINGA_MARKETPLACE_DB.users.delete(user.id);
                        }
                    }
                    
                    await addSystemLog('admin', 'all_users_deleted', 'Deleted all users except current admin', currentUser.id);
                    
                    showAlert('All users deleted successfully!', 'success');
                    loadAllUsersForManage();
                } catch (error) {
                    console.error('Error deleting all users:', error);
                    alert('Error deleting all users');
                }
            }
        }
        
        // Load all attractions for manage
        async function loadAllAttractionsForManage() {
            try {
                const attractions = await BINGA_MARKETPLACE_DB.attractions.getAll();
                const container = document.getElementById('manageTabContent');
                
                container.innerHTML = `
                    <h3>All Tourist Attractions (${attractions.length})</h3>
                    <div style="margin-bottom: 20px;">
                        <button class="admin-button" onclick="createNewAttraction()">
                            <i class="fas fa-plus"></i> Add New Attraction
                        </button>
                        <button class="admin-button danger" onclick="deleteAllAttractions()">
                            <i class="fas fa-trash"></i> Delete All Attractions
                        </button>
                    </div>
                    <div class="system-logs" style="max-height: 500px;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Type</th>
                                    <th>Location</th>
                                    <th>Status</th>
                                    <th>Added By</th>
                                    <th>Created</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${attractions.map(a => `
                                    <tr>
                                        <td>${a.id}</td>
                                        <td>${a.name}</td>
                                        <td>${a.typeName || a.type}</td>
                                        <td>${a.location}</td>
                                        <td>
                                            <span class="status-badge ${a.adminApproved ? 'status-active' : 'status-pending'}">
                                                ${a.adminApproved ? 'Approved' : 'Pending'}
                                            </span>
                                        </td>
                                        <td>${a.addedBy}</td>
                                        <td>${new Date(a.createdAt).toLocaleDateString()}</td>
                                        <td>
                                            <button class="action-btn edit" onclick="editAttraction(${a.id})" style="padding: 3px 8px; font-size: 12px;">
                                                Edit
                                            </button>
                                            <button class="action-btn delete" onclick="deleteAttraction(${a.id})" style="padding: 3px 8px; font-size: 12px;">
                                                Delete
                                            </button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            } catch (error) {
                console.error('Error loading all attractions:', error);
            }
        }
        
        // Create new attraction
        async function createNewAttraction() {
            document.getElementById('manageSection').style.display = 'none';
            document.getElementById('attractionFormSection').style.display = 'block';
            
            document.getElementById('attractionFormTitle').textContent = 'Add New Tourist Attraction';
            document.getElementById('attractionFormSubtitle').textContent = 'Create a new tourist attraction';
            
            document.getElementById('attractionFormContent').innerHTML = `
                <form id="newAttractionForm">
                    <div class="form-group">
                        <label class="form-label">Attraction Name*</label>
                        <input type="text" class="form-control" id="newAttractionName" placeholder="e.g., Lake Kariba Shore">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Type*</label>
                        <select class="form-control" id="newAttractionType">
                            <option value="">Select Type</option>
                            <option value="beach">Beach</option>
                            <option value="hotspring">Hot Spring</option>
                            <option value="lake">Lake View</option>
                            <option value="cultural">Cultural Site</option>
                            <option value="wildlife">Wildlife</option>
                            <option value="accommodation">Accommodation</option>
                            <option value="tour">Tour Service</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Location*</label>
                        <select class="form-control" id="newAttractionLocation">
                            <option value="">Select Location</option>
                            <option>Siachilaba</option>
                            <option>Kariyangwe</option>
                            <option>Binga Centre</option>
                            <option>Chete Island</option>
                            <option>Lake Kariba</option>
                            <option>Other</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Description*</label>
                        <textarea class="form-control" id="newAttractionDescription" rows="4" placeholder="Describe this attraction..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">WhatsApp Contact Link</label>
                        <input type="text" class="form-control" id="newAttractionWhatsApp" value="https://wa.me/263772863815?text=Hi! I want to visit ">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Status*</label>
                        <select class="form-control" id="newAttractionStatus">
                            <option value="active">Active</option>
                            <option value="pending">Pending</option>
                            <option value="inactive">Inactive</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Auto Approve</label>
                        <select class="form-control" id="newAttractionAutoApprove">
                            <option value="true">Yes</option>
                            <option value="false">No (Requires Admin Approval)</option>
                        </select>
                    </div>
                    
                    <button type="button" class="btn btn-primary" onclick="saveNewAttraction()" style="margin-top: 20px;">
                        <i class="fas fa-save"></i> Create Attraction
                    </button>
                    
                    <button type="button" class="btn" onclick="showSection('manage')" style="margin-top: 20px; margin-left: 10px; background: #f0f0f0;">
                        Cancel
                    </button>
                </form>
            `;
        }
        
        // Save new attraction
        async function saveNewAttraction() {
            const name = document.getElementById('newAttractionName').value.trim();
            const type = document.getElementById('newAttractionType').value;
            const location = document.getElementById('newAttractionLocation').value;
            const description = document.getElementById('newAttractionDescription').value.trim();
            const whatsapp = document.getElementById('newAttractionWhatsApp').value.trim();
            const status = document.getElementById('newAttractionStatus').value;
            const autoApprove = document.getElementById('newAttractionAutoApprove').value === 'true';
            
            if (!name || !type || !location || !description) {
                alert('Please fill all required fields');
                return;
            }
            
            const typeNames = {
                'beach': 'Beach',
                'hotspring': 'Hot Spring',
                'lake': 'Lake View',
                'cultural': 'Cultural Site',
                'wildlife': 'Wildlife',
                'accommodation': 'Accommodation',
                'tour': 'Tour Service'
            };
            
            const attraction = {
                id: Date.now(),
                name: name,
                description: description,
                type: type,
                typeName: typeNames[type] || type,
                location: location,
                whatsappLink: whatsapp,
                status: status,
                adminApproved: autoApprove,
                addedBy: currentUser.id,
                createdAt: new Date().toISOString()
            };
            
            try {
                await BINGA_MARKETPLACE_DB.attractions.add(attraction);
                
                await addSystemLog('admin', 'attraction_created', `Created new attraction: ${name}`, currentUser.id);
                
                showAlert('Tourist attraction created successfully!', 'success');
                
                showSection('manage');
                loadAllAttractionsForManage();
            } catch (error) {
                console.error('Error creating attraction:', error);
                alert('Error creating attraction');
            }
        }
        
        // Edit attraction
        async function editAttraction(attractionId) {
            try {
                const attraction = await BINGA_MARKETPLACE_DB.attractions.get(attractionId);
                if (!attraction) {
                    alert('Attraction not found');
                    return;
                }
                
                document.getElementById('manageSection').style.display = 'none';
                document.getElementById('attractionFormSection').style.display = 'block';
                
                document.getElementById('attractionFormTitle').textContent = 'Edit Tourist Attraction';
                document.getElementById('attractionFormSubtitle').textContent = `Editing: ${attraction.name}`;
                
                document.getElementById('attractionFormContent').innerHTML = `
                    <form id="editAttractionForm">
                        <input type="hidden" id="editAttractionId" value="${attraction.id}">
                        
                        <div class="form-group">
                            <label class="form-label">Attraction Name*</label>
                            <input type="text" class="form-control" id="editAttractionName" value="${attraction.name}">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Type*</label>
                            <select class="form-control" id="editAttractionType">
                                <option value="beach" ${attraction.type === 'beach' ? 'selected' : ''}>Beach</option>
                                <option value="hotspring" ${attraction.type === 'hotspring' ? 'selected' : ''}>Hot Spring</option>
                                <option value="lake" ${attraction.type === 'lake' ? 'selected' : ''}>Lake View</option>
                                <option value="cultural" ${attraction.type === 'cultural' ? 'selected' : ''}>Cultural Site</option>
                                <option value="wildlife" ${attraction.type === 'wildlife' ? 'selected' : ''}>Wildlife</option>
                                <option value="accommodation" ${attraction.type === 'accommodation' ? 'selected' : ''}>Accommodation</option>
                                <option value="tour" ${attraction.type === 'tour' ? 'selected' : ''}>Tour Service</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Location*</label>
                            <select class="form-control" id="editAttractionLocation">
                                <option>Siachilaba</option>
                                <option>Kariyangwe</option>
                                <option ${attraction.location === 'Binga Centre' ? 'selected' : ''}>Binga Centre</option>
                                <option ${attraction.location === 'Chete Island' ? 'selected' : ''}>Chete Island</option>
                                <option ${attraction.location === 'Lake Kariba' ? 'selected' : ''}>Lake Kariba</option>
                                <option ${attraction.location === 'Other' ? 'selected' : ''}>Other</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Description*</label>
                            <textarea class="form-control" id="editAttractionDescription" rows="4">${attraction.description}</textarea>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">WhatsApp Contact Link</label>
                            <input type="text" class="form-control" id="editAttractionWhatsApp" value="${attraction.whatsappLink}">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Status*</label>
                            <select class="form-control" id="editAttractionStatus">
                                <option value="active" ${attraction.status === 'active' ? 'selected' : ''}>Active</option>
                                <option value="pending" ${attraction.status === 'pending' ? 'selected' : ''}>Pending</option>
                                <option value="inactive" ${attraction.status === 'inactive' ? 'selected' : ''}>Inactive</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Admin Approved</label>
                            <select class="form-control" id="editAttractionApproved">
                                <option value="true" ${attraction.adminApproved ? 'selected' : ''}>Yes</option>
                                <option value="false" ${!attraction.adminApproved ? 'selected' : ''}>No</option>
                            </select>
                        </div>
                        
                        <button type="button" class="btn btn-primary" onclick="saveEditedAttraction()" style="margin-top: 20px;">
                            <i class="fas fa-save"></i> Save Changes
                        </button>
                        
                        <button type="button" class="btn" onclick="showSection('manage')" style="margin-top: 20px; margin-left: 10px; background: #f0f0f0;">
                            Cancel
                        </button>
                    </form>
                `;
                
                // Set current value for location
                document.getElementById('editAttractionLocation').value = attraction.location;
            } catch (error) {
                console.error('Error loading attraction for edit:', error);
                alert('Error loading attraction details');
            }
        }
        
        // Save edited attraction
        async function saveEditedAttraction() {
            const attractionId = parseInt(document.getElementById('editAttractionId').value);
            const name = document.getElementById('editAttractionName').value.trim();
            const type = document.getElementById('editAttractionType').value;
            const location = document.getElementById('editAttractionLocation').value;
            const description = document.getElementById('editAttractionDescription').value.trim();
            const whatsapp = document.getElementById('editAttractionWhatsApp').value.trim();
            const status = document.getElementById('editAttractionStatus').value;
            const approved = document.getElementById('editAttractionApproved').value === 'true';
            
            if (!name || !type || !location || !description) {
                alert('Please fill all required fields');
                return;
            }
            
            const typeNames = {
                'beach': 'Beach',
                'hotspring': 'Hot Spring',
                'lake': 'Lake View',
                'cultural': 'Cultural Site',
                'wildlife': 'Wildlife',
                'accommodation': 'Accommodation',
                'tour': 'Tour Service'
            };
            
            const updates = {
                name: name,
                description: description,
                type: type,
                typeName: typeNames[type] || type,
                location: location,
                whatsappLink: whatsapp,
                status: status,
                adminApproved: approved
            };
            
            try {
                await BINGA_MARKETPLACE_DB.attractions.update(attractionId, updates);
                
                await addSystemLog('admin', 'attraction_updated', `Updated attraction: ${name}`, currentUser.id);
                
                showAlert('Tourist attraction updated successfully!', 'success');
                
                showSection('manage');
                loadAllAttractionsForManage();
            } catch (error) {
                console.error('Error updating attraction:', error);
                alert('Error updating attraction');
            }
        }
        
        // Delete attraction
        async function deleteAttraction(attractionId) {
            if (confirm('Permanently delete this attraction?')) {
                try {
                    await BINGA_MARKETPLACE_DB.attractions.delete(attractionId);
                    
                    await addSystemLog('admin', 'attraction_deleted', `Deleted attraction ID: ${attractionId}`, currentUser.id);
                    
                    showAlert('Attraction deleted successfully!', 'success');
                    loadAllAttractionsForManage();
                } catch (error) {
                    console.error('Error deleting attraction:', error);
                    alert('Error deleting attraction');
                }
            }
        }
        
        // Delete all attractions
        async function deleteAllAttractions() {
            if (confirm('WARNING: This will delete ALL tourist attractions. This action cannot be undone!')) {
                try {
                    const attractions = await BINGA_MARKETPLACE_DB.attractions.getAll();
                    
                    for (const attraction of attractions) {
                        await BINGA_MARKETPLACE_DB.attractions.delete(attraction.id);
                    }
                    
                    await addSystemLog('admin', 'all_attractions_deleted', 'Deleted all tourist attractions', currentUser.id);
                    
                    showAlert('All attractions deleted successfully!', 'success');
                    loadAllAttractionsForManage();
                } catch (error) {
                    console.error('Error deleting all attractions:', error);
                    alert('Error deleting all attractions');
                }
            }
        }
        
        // Load all media
        async function loadAllMedia() {
            try {
                const media = await BINGA_MARKETPLACE_DB.media.getAll();
                const container = document.getElementById('manageTabContent');
                
                container.innerHTML = `
                    <h3>All Media Files (${media.length})</h3>
                    <div style="margin-bottom: 20px;">
                        <button class="admin-button danger" onclick="deleteAllMedia()">
                            <i class="fas fa-trash"></i> Delete All Media
                        </button>
                    </div>
                    <div class="image-upload-container">
                        ${media.map(m => `
                            <div class="image-preview">
                                ${m.mediaType === 'image' ? 
                                    `<img src="${m.dataUrl}" alt="${m.filename}">` : 
                                    `<video>
                                        <source src="${m.dataUrl}" type="${m.mimeType}">
                                    </video>
                                    <div style="position: absolute; bottom: 5px; left: 5px; background: rgba(0,0,0,0.7); color: white; padding: 2px 5px; border-radius: 3px; font-size: 10px;">
                                        <i class="fas fa-play"></i> Video
                                    </div>`
                                }
                                <button class="remove-image" onclick="deleteMedia(${m.id})">Ã—</button>
                                <div style="position: absolute; bottom: 5px; right: 5px; background: rgba(0,0,0,0.7); color: white; padding: 2px 5px; border-radius: 3px; font-size: 8px;">
                                    ${formatBytes(m.size || 0)}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            } catch (error) {
                console.error('Error loading all media:', error);
            }
        }
        
        // Delete media
        async function deleteMedia(mediaId) {
            if (confirm('Delete this media file?')) {
                try {
                    await BINGA_MARKETPLACE_DB.media.delete(mediaId);
                    
                    await addSystemLog('admin', 'media_deleted', `Deleted media file ID: ${mediaId}`, currentUser.id);
                    
                    showAlert('Media file deleted successfully!', 'success');
                    loadAllMedia();
                } catch (error) {
                    console.error('Error deleting media:', error);
                    alert('Error deleting media file');
                }
            }
        }
        
        // Delete all media
        async function deleteAllMedia() {
            if (confirm('WARNING: This will delete ALL media files. This action cannot be undone!')) {
                try {
                    const media = await BINGA_MARKETPLACE_DB.media.getAll();
                    
                    for (const item of media) {
                        await BINGA_MARKETPLACE_DB.media.delete(item.id);
                    }
                    
                    await addSystemLog('admin', 'all_media_deleted', 'Deleted all media files', currentUser.id);
                    
                    showAlert('All media files deleted successfully!', 'success');
                    loadAllMedia();
                } catch (error) {
                    console.error('Error deleting all media:', error);
                    alert('Error deleting all media');
                }
            }
        }
        
        // Load categories for manage
        async function loadCategoriesForManage() {
            try {
                const categories = await BINGA_MARKETPLACE_DB.categories.getAll();
                const container = document.getElementById('manageTabContent');
                
                container.innerHTML = `
                    <h3>Product Categories (${categories.length})</h3>
                    <div style="margin-bottom: 20px;">
                        <button class="admin-button" onclick="addNewCategory()">
                            <i class="fas fa-plus"></i> Add New Category
                        </button>
                    </div>
                    <div class="system-logs" style="max-height: 500px;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Icon</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${categories.map(c => `
                                    <tr>
                                        <td>${c.id}</td>
                                        <td>${c.name}</td>
                                        <td>${c.icon}</td>
                                        <td>
                                            <button class="action-btn edit" onclick="editCategory('${c.id}')" style="padding: 3px 8px; font-size: 12px;">
                                                Edit
                                            </button>
                                            <button class="action-btn delete" onclick="deleteCategory('${c.id}')" style="padding: 3px 8px; font-size: 12px;">
                                                Delete
                                            </button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            } catch (error) {
                console.error('Error loading categories:', error);
            }
        }
        
        // Add new category
        async function addNewCategory() {
            const id = prompt('Enter category ID (e.g., electronics):');
            if (!id) return;
            
            const name = prompt('Enter category name:');
            if (!name) return;
            
            const icon = prompt('Enter category icon (emoji):', 'ðŸ“¦');
            
            try {
                await BINGA_MARKETPLACE_DB.categories.add({
                    id: id,
                    name: name,
                    icon: icon || 'ðŸ“¦'
                });
                
                await addSystemLog('admin', 'category_created', `Created new category: ${name}`, currentUser.id);
                
                showAlert('Category created successfully!', 'success');
                loadCategoriesForManage();
            } catch (error) {
                console.error('Error creating category:', error);
                alert('Error creating category');
            }
        }
        
        // Edit category
        async function editCategory(categoryId) {
            try {
                const category = await BINGA_MARKETPLACE_DB.categories.get(categoryId);
                if (!category) {
                    alert('Category not found');
                    return;
                }
                
                const name = prompt('Enter new category name:', category.name);
                if (!name) return;
                
                const icon = prompt('Enter new category icon (emoji):', category.icon);
                
                await BINGA_MARKETPLACE_DB.categories.update(categoryId, {
                    name: name,
                    icon: icon || 'ðŸ“¦'
                });
                
                await addSystemLog('admin', 'category_updated', `Updated category: ${name}`, currentUser.id);
                
                showAlert('Category updated successfully!', 'success');
                loadCategoriesForManage();
            } catch (error) {
                console.error('Error updating category:', error);
                alert('Error updating category');
            }
        }
        
        // Delete category
        async function deleteCategory(categoryId) {
            if (confirm('Delete this category? Products in this category will remain but may not display properly.')) {
                try {
                    await BINGA_MARKETPLACE_DB.categories.delete(categoryId);
                    
                    await addSystemLog('admin', 'category_deleted', `Deleted category: ${categoryId}`, currentUser.id);
                    
                    showAlert('Category deleted successfully!', 'success');
                    loadCategoriesForManage();
                } catch (error) {
                    console.error('Error deleting category:', error);
                    alert('Error deleting category');
                }
            }
        }
        
        // Load locations for manage
        async function loadLocationsForManage() {
            try {
                const locations = await BINGA_MARKETPLACE_DB.locations.getAll();
                const container = document.getElementById('manageTabContent');
                
                container.innerHTML = `
                    <h3>Locations (${locations.length})</h3>
                    <div style="margin-bottom: 20px;">
                        <button class="admin-button" onclick="addNewLocation()">
                            <i class="fas fa-plus"></i> Add New Location
                        </button>
                    </div>
                    <div class="system-logs" style="max-height: 500px;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${locations.map(l => `
                                    <tr>
                                        <td>${l.id}</td>
                                        <td>${l.name}</td>
                                        <td>
                                            <button class="action-btn edit" onclick="editLocation('${l.id}')" style="padding: 3px 8px; font-size: 12px;">
                                                Edit
                                            </button>
                                            <button class="action-btn delete" onclick="deleteLocation('${l.id}')" style="padding: 3px 8px; font-size: 12px;">
                                                Delete
                                            </button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            } catch (error) {
                console.error('Error loading locations:', error);
            }
        }
        
        // Add new location
        async function addNewLocation() {
            const id = prompt('Enter location ID:');
            if (!id) return;
            
            const name = prompt('Enter location name:');
            if (!name) return;
            
            try {
                await BINGA_MARKETPLACE_DB.locations.add({
                    id: id,
                    name: name
                });
                
                await addSystemLog('admin', 'location_created', `Created new location: ${name}`, currentUser.id);
                
                showAlert('Location created successfully!', 'success');
                loadLocationsForManage();
            } catch (error) {
                console.error('Error creating location:', error);
                alert('Error creating location');
            }
        }
        
        // Edit location
        async function editLocation(locationId) {
            try {
                const location = await BINGA_MARKETPLACE_DB.locations.get(locationId);
                if (!location) {
                    alert('Location not found');
                    return;
                }
                
                const name = prompt('Enter new location name:', location.name);
                if (!name) return;
                
                await BINGA_MARKETPLACE_DB.locations.update(locationId, {
                    name: name
                });
                
                await addSystemLog('admin', 'location_updated', `Updated location: ${name}`, currentUser.id);
                
                showAlert('Location updated successfully!', 'success');
                loadLocationsForManage();
            } catch (error) {
                console.error('Error updating location:', error);
                alert('Error updating location');
            }
        }
        
        // Delete location
        async function deleteLocation(locationId) {
            if (confirm('Delete this location? Products in this location will remain but may not display properly.')) {
                try {
                    await BINGA_MARKETPLACE_DB.locations.delete(locationId);
                    
                    await addSystemLog('admin', 'location_deleted', `Deleted location: ${locationId}`, currentUser.id);
                    
                    showAlert('Location deleted successfully!', 'success');
                    loadLocationsForManage();
                } catch (error) {
                    console.error('Error deleting location:', error);
                    alert('Error deleting location');
                }
            }
        }
        
        // Load system settings
        async function loadSystemSettings() {
            try {
                const settings = await BINGA_MARKETPLACE_DB.adminSettings.get('general') || {};
                const container = document.getElementById('manageTabContent');
                
                container.innerHTML = `
                    <h3>System Settings</h3>
                    <div style="margin-bottom: 20px;">
                        <button class="admin-button" onclick="saveSystemSettings()">
                            <i class="fas fa-save"></i> Save Settings
                        </button>
                        <button class="admin-button secondary" onclick="resetSystemSettings()">
                            <i class="fas fa-redo"></i> Reset to Default
                        </button>
                    </div>
                    
                    <form id="systemSettingsForm">
                        <div class="form-group">
                            <label class="form-label">Site Name</label>
                            <input type="text" class="form-control" id="siteName" value="${settings.siteName || 'Binga Marketplace'}">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Admin Email</label>
                            <input type="email" class="form-control" id="adminEmail" value="${settings.adminEmail || 'admin@bingamarket.co.zw'}">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Admin Phone</label>
                            <input type="tel" class="form-control" id="adminPhone" value="${settings.adminPhone || '263772863815'}">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Auto Approve Products</label>
                            <select class="form-control" id="autoApproveProducts">
                                <option value="true" ${settings.autoApproveProducts ? 'selected' : ''}>Yes</option>
                                <option value="false" ${!settings.autoApproveProducts ? 'selected' : ''}>No</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Max Media Files Per Item</label>
                            <input type="number" class="form-control" id="maxMediaPerItem" value="${settings.maxMediaPerItem || 20}">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Max File Size (MB)</label>
                            <input type="number" class="form-control" id="maxFileSizeMB" value="${settings.maxFileSizeMB || 10}">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Maintenance Mode</label>
                            <select class="form-control" id="maintenanceMode">
                                <option value="true" ${settings.maintenanceMode ? 'selected' : ''}>Yes</option>
                                <option value="false" ${!settings.maintenanceMode ? 'selected' : ''}>No</option>
                            </select>
                        </div>
                    </form>
                    
                    <div style="margin-top: 40px; background: #f8f9fa; padding: 20px; border-radius: 8px;">
                        <h4><i class="fas fa-exclamation-triangle"></i> Dangerous Settings</h4>
                        <div style="margin-top: 15px;">
                            <button class="admin-button danger" onclick="clearAllData()">
                                <i class="fas fa-database"></i> Clear All Database
                            </button>
                            <button class="admin-button danger" onclick="resetEntireSystem()">
                                <i class="fas fa-bomb"></i> Reset Entire System
                            </button>
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error('Error loading system settings:', error);
            }
        }
        
        // Save system settings
        async function saveSystemSettings() {
            try {
                const settings = {
                    siteName: document.getElementById('siteName').value,
                    adminEmail: document.getElementById('adminEmail').value,
                    adminPhone: document.getElementById('adminPhone').value,
                    autoApproveProducts: document.getElementById('autoApproveProducts').value === 'true',
                    maxMediaPerItem: parseInt(document.getElementById('maxMediaPerItem').value),
                    maxFileSizeMB: parseInt(document.getElementById('maxFileSizeMB').value),
                    maintenanceMode: document.getElementById('maintenanceMode').value === 'true'
                };
                
                await BINGA_MARKETPLACE_DB.adminSettings.update('general', settings);
                
                await addSystemLog('admin', 'settings_updated', 'Updated system settings', currentUser.id);
                
                showAlert('System settings saved successfully!', 'success');
            } catch (error) {
                console.error('Error saving system settings:', error);
                alert('Error saving system settings');
            }
        }
        
        // Reset system settings
        async function resetSystemSettings() {
            if (confirm('Reset all system settings to default?')) {
                try {
                    await BINGA_MARKETPLACE_DB.adminSettings.update('general', {
                        siteName: 'Binga Marketplace',
                        adminEmail: 'admin@bingamarket.co.zw',
                        adminPhone: '263772863815',
                        autoApproveProducts: false,
                        maxMediaPerItem: 20,
                        maxFileSizeMB: 10,
                        maintenanceMode: false
                    });
                    
                    await addSystemLog('admin', 'settings_reset', 'Reset system settings to default', currentUser.id);
                    
                    showAlert('System settings reset to default!', 'success');
                    loadSystemSettings();
                } catch (error) {
                    console.error('Error resetting system settings:', error);
                    alert('Error resetting system settings');
                }
            }
        }
        
        // Clear all data
        async function clearAllData() {
            if (confirm('WARNING: This will delete ALL data in the database including users, products, attractions, and media. This action cannot be undone!')) {
                try {
                    await BINGA_MARKETPLACE_DB.clearAllData();
                    
                    await addSystemLog('admin', 'database_cleared', 'Cleared all database data', currentUser.id);
                    
                    showAlert('All database data cleared successfully! System has been reset with default data.', 'success');
                    
                    // Reload the page to refresh
                    setTimeout(() => {
                        location.reload();
                    }, 2000);
                } catch (error) {
                    console.error('Error clearing all data:', error);
                    alert('Error clearing all data');
                }
            }
        }
        
        // Reset entire system
        async function resetEntireSystem() {
            if (confirm('WARNING: This will completely reset the entire system to factory defaults. ALL data will be lost including your admin account! Type "RESET" to confirm.')) {
                const confirmation = prompt('Type "RESET" to confirm:');
                if (confirmation === 'RESET') {
                    try {
                        // Clear all data
                        await BINGA_MARKETPLACE_DB.clearAllData();
                        
                        // Clear local storage
                        localStorage.clear();
                        
                        // Reload the page
                        location.reload();
                    } catch (error) {
                        console.error('Error resetting system:', error);
                        alert('Error resetting system');
                    }
                }
            }
        }
        
        // Load all users
        async function loadAllUsers() {
            try {
                const users = await BINGA_MARKETPLACE_DB.users.getAll();
                const container = document.getElementById('usersContent');
                
                container.innerHTML = `
                    <h3 class="section-title admin">
                        <i class="fas fa-users"></i> All Users (${users.length})
                    </h3>
                    <div style="margin-bottom: 20px;">
                        <button class="admin-button" onclick="createNewUser()">
                            <i class="fas fa-user-plus"></i> Create New User
                        </button>
                        <button class="admin-button secondary" onclick="exportUsers()">
                            <i class="fas fa-download"></i> Export Users
                        </button>
                    </div>
                    <div class="system-logs" style="max-height: 600px;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Username</th>
                                    <th>Type</th>
                                    <th>Phone</th>
                                    <th>Location</th>
                                    <th>Status</th>
                                    <th>Registered</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${users.map(u => `
                                    <tr>
                                        <td>${u.id}</td>
                                        <td>
                                            ${u.name}
                                            ${u.type === 'admin' ? '<span class="admin-badge-small">ADMIN</span>' : ''}
                                        </td>
                                        <td>${u.username}</td>
                                        <td>
                                            <span class="status-badge ${u.type === 'admin' ? 'status-admin' : 'status-active'}">
                                                ${u.type}
                                            </span>
                                        </td>
                                        <td>${u.phone}</td>
                                        <td>${u.location}</td>
                                        <td>
                                            <span class="status-badge ${u.approved ? 'status-active' : 'status-pending'}">
                                                ${u.approved ? 'Active' : 'Pending'}
                                            </span>
                                        </td>
                                        <td>${new Date(u.registered).toLocaleDateString()}</td>
                                        <td>
                                            <button class="action-btn edit" onclick="editUser(${u.id})" style="padding: 3px 8px; font-size: 12px;">
                                                Edit
                                            </button>
                                            ${u.id !== currentUser.id ? 
                                                `<button class="action-btn delete" onclick="deleteUser(${u.id})" style="padding: 3px 8px; font-size: 12px;">
                                                    Delete
                                                </button>` : 
                                                '<span style="color: #999;">Current</span>'
                                            }
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            } catch (error) {
                console.error('Error loading all users:', error);
            }
        }
        
        // Load all products
        async function loadAllProducts() {
            try {
                const products = await BINGA_MARKETPLACE_DB.products.getAll();
                const container = document.getElementById('productsContent');
                
                container.innerHTML = `
                    <h3 class="section-title admin">
                        <i class="fas fa-boxes"></i> All Products (${products.length})
                    </h3>
                    <div style="margin-bottom: 20px;">
                        <button class="admin-button" onclick="createNewProduct()">
                            <i class="fas fa-plus"></i> Create New Product
                        </button>
                        <button class="admin-button secondary" onclick="exportProducts()">
                            <i class="fas fa-download"></i> Export Products
                        </button>
                        <button class="admin-button danger" onclick="deleteAllProducts()">
                            <i class="fas fa-trash"></i> Delete All Products
                        </button>
                    </div>
                    <div class="system-logs" style="max-height: 600px;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Title</th>
                                    <th>Category</th>
                                    <th>Price</th>
                                    <th>Seller</th>
                                    <th>Location</th>
                                    <th>Status</th>
                                    <th>Created</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${products.map(p => `
                                    <tr>
                                        <td>${p.id}</td>
                                        <td>${p.title}</td>
                                        <td>${p.category}</td>
                                        <td>$${p.price}</td>
                                        <td>${p.sellerName}</td>
                                        <td>${p.location}</td>
                                        <td>
                                            <span class="status-badge ${p.adminApproved ? 'status-active' : 'status-pending'}">
                                                ${p.adminApproved ? 'Approved' : 'Pending'}
                                            </span>
                                        </td>
                                        <td>${new Date(p.createdAt).toLocaleDateString()}</td>
                                        <td>
                                            <button class="action-btn view" onclick="viewProductDetails(${p.id})" style="padding: 3px 8px; font-size: 12px;">
                                                View
                                            </button>
                                            <button class="action-btn edit" onclick="editProduct(${p.id})" style="padding: 3px 8px; font-size: 12px;">
                                                Edit
                                            </button>
                                            <button class="action-btn delete" onclick="deleteProduct(${p.id})" style="padding: 3px 8px; font-size: 12px;">
                                                Delete
                                            </button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            } catch (error) {
                console.error('Error loading all products:', error);
            }
        }
        
        // Create new product
        async function createNewProduct() {
            document.getElementById('productsSection').style.display = 'none';
            document.getElementById('productFormSection').style.display = 'block';
            
            document.getElementById('productFormTitle').textContent = 'Create New Product';
            document.getElementById('productFormSubtitle').textContent = 'Create a new product listing';
            
            const users = await BINGA_MARKETPLACE_DB.users.getAll();
            const sellers = users.filter(u => u.type === 'seller');
            
            document.getElementById('productFormContent').innerHTML = `
                <form id="newProductForm">
                    <div class="form-group">
                        <label class="form-label">Product Title*</label>
                        <input type="text" class="form-control" id="newProductTitle" placeholder="e.g., Fresh Kapenta - 20kg">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Category*</label>
                        <select class="form-control" id="newProductCategory">
                            <option value="">Select Category</option>
                            <option value="fish">Fish & Seafood</option>
                            <option value="goat">Goats</option>
                            <option value="cow">Cattle</option>
                            <option value="poultry">Poultry</option>
                            <option value="agriculture">Agriculture</option>
                            <option value="services">Services</option>
                            <option value="property">Property</option>
                            <option value="vehicles">Vehicles</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Price (USD)*</label>
                        <input type="number" class="form-control" id="newProductPrice" placeholder="e.g., 80">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Location*</label>
                        <select class="form-control" id="newProductLocation">
                            <option value="">Select Location</option>
                            <option>Siachilaba</option>
                            <option>Kariyangwe</option>
                            <option>Binga Centre</option>
                            <option>Chete Island</option>
                            <option>Lake Kariba</option>
                            <option>Other</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Seller*</label>
                        <select class="form-control" id="newProductSeller">
                            <option value="">Select Seller</option>
                            ${sellers.map(s => `<option value="${s.id}">${s.name} (${s.phone})</option>`).join('')}
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Description*</label>
                        <textarea class="form-control" id="newProductDescription" rows="4" placeholder="Describe the product..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">WhatsApp Link</label>
                        <input type="text" class="form-control" id="newProductWhatsApp" placeholder="https://wa.me/263771234567?text=Hi! I saw your product">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Status*</label>
                        <select class="form-control" id="newProductStatus">
                            <option value="active">Active</option>
                            <option value="pending">Pending</option>
                            <option value="inactive">Inactive</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Auto Approve</label>
                        <select class="form-control" id="newProductAutoApprove">
                            <option value="true">Yes</option>
                            <option value="false">No (Requires Admin Approval)</option>
                        </select>
                    </div>
                    
                    <button type="button" class="btn btn-primary" onclick="saveNewProduct()" style="margin-top: 20px;">
                        <i class="fas fa-save"></i> Create Product
                    </button>
                    
                    <button type="button" class="btn" onclick="showSection('products')" style="margin-top: 20px; margin-left: 10px; background: #f0f0f0;">
                        Cancel
                    </button>
                </form>
            `;
        }
        
        // Save new product
        async function saveNewProduct() {
            const title = document.getElementById('newProductTitle').value.trim();
            const category = document.getElementById('newProductCategory').value;
            const price = document.getElementById('newProductPrice').value;
            const location = document.getElementById('newProductLocation').value;
            const sellerId = parseInt(document.getElementById('newProductSeller').value);
            const description = document.getElementById('newProductDescription').value.trim();
            const whatsapp = document.getElementById('newProductWhatsApp').value.trim();
            const status = document.getElementById('newProductStatus').value;
            const autoApprove = document.getElementById('newProductAutoApprove').value === 'true';
            
            if (!title || !category || !price || !location || !sellerId || !description) {
                alert('Please fill all required fields');
                return;
            }
            
            try {
                const seller = await BINGA_MARKETPLACE_DB.users.get(sellerId);
                if (!seller) {
                    alert('Seller not found');
                    return;
                }
                
                const product = {
                    id: Date.now(),
                    title: title,
                    description: description,
                    category: category,
                    price: parseFloat(price),
                    location: location,
                    sellerId: sellerId,
                    sellerName: seller.name,
                    sellerPhone: seller.phone,
                    whatsappLink: whatsapp || `https://wa.me/${seller.phone}?text=Hi! I saw your ${encodeURIComponent(title)} on Binga Marketplace`,
                    status: status,
                    approved: true,
                    adminApproved: autoApprove,
                    featured: false,
                    views: 0,
                    createdAt: new Date().toISOString()
                };
                
                await BINGA_MARKETPLACE_DB.products.add(product);
                
                await addSystemLog('admin', 'product_created', `Created new product: ${title}`, currentUser.id);
                
                showAlert('Product created successfully!', 'success');
                
                showSection('products');
                loadAllProducts();
            } catch (error) {
                console.error('Error creating product:', error);
                alert('Error creating product');
            }
        }
        
        // Edit product
        async function editProduct(productId) {
            try {
                const product = await BINGA_MARKETPLACE_DB.products.get(productId);
                if (!product) {
                    alert('Product not found');
                    return;
                }
                
                const users = await BINGA_MARKETPLACE_DB.users.getAll();
                const sellers = users.filter(u => u.type === 'seller');
                
                document.getElementById('productsSection').style.display = 'none';
                document.getElementById('productFormSection').style.display = 'block';
                
                document.getElementById('productFormTitle').textContent = 'Edit Product';
                document.getElementById('productFormSubtitle').textContent = `Editing: ${product.title}`;
                
                document.getElementById('productFormContent').innerHTML = `
                    <form id="editProductForm">
                        <input type="hidden" id="editProductId" value="${product.id}">
                        
                        <div class="form-group">
                            <label class="form-label">Product Title*</label>
                            <input type="text" class="form-control" id="editProductTitle" value="${product.title}">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Category*</label>
                            <select class="form-control" id="editProductCategory">
                                <option value="fish" ${product.category === 'fish' ? 'selected' : ''}>Fish & Seafood</option>
                                <option value="goat" ${product.category === 'goat' ? 'selected' : ''}>Goats</option>
                                <option value="cow" ${product.category === 'cow' ? 'selected' : ''}>Cattle</option>
                                <option value="poultry" ${product.category === 'poultry' ? 'selected' : ''}>Poultry</option>
                                <option value="agriculture" ${product.category === 'agriculture' ? 'selected' : ''}>Agriculture</option>
                                <option value="services" ${product.category === 'services' ? 'selected' : ''}>Services</option>
                                <option value="property" ${product.category === 'property' ? 'selected' : ''}>Property</option>
                                <option value="vehicles" ${product.category === 'vehicles' ? 'selected' : ''}>Vehicles</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Price (USD)*</label>
                            <input type="number" class="form-control" id="editProductPrice" value="${product.price}">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Location*</label>
                            <select class="form-control" id="editProductLocation">
                                <option>Siachilaba</option>
                                <option>Kariyangwe</option>
                                <option ${product.location === 'Binga Centre' ? 'selected' : ''}>Binga Centre</option>
                                <option ${product.location === 'Chete Island' ? 'selected' : ''}>Chete Island</option>
                                <option ${product.location === 'Lake Kariba' ? 'selected' : ''}>Lake Kariba</option>
                                <option ${product.location === 'Other' ? 'selected' : ''}>Other</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Seller*</label>
                            <select class="form-control" id="editProductSeller">
                                ${sellers.map(s => `<option value="${s.id}" ${product.sellerId === s.id ? 'selected' : ''}>${s.name} (${s.phone})</option>`).join('')}
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Description*</label>
                            <textarea class="form-control" id="editProductDescription" rows="4">${product.description}</textarea>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">WhatsApp Link</label>
                            <input type="text" class="form-control" id="editProductWhatsApp" value="${product.whatsappLink}">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Status*</label>
                            <select class="form-control" id="editProductStatus">
                                <option value="active" ${product.status === 'active' ? 'selected' : ''}>Active</option>
                                <option value="pending" ${product.status === 'pending' ? 'selected' : ''}>Pending</option>
                                <option value="inactive" ${product.status === 'inactive' ? 'selected' : ''}>Inactive</option>
                                <option value="rejected" ${product.status === 'rejected' ? 'selected' : ''}>Rejected</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Admin Approved</label>
                            <select class="form-control" id="editProductApproved">
                                <option value="true" ${product.adminApproved ? 'selected' : ''}>Yes</option>
                                <option value="false" ${!product.adminApproved ? 'selected' : ''}>No</option>
                            </select>
                        </div>
                        
                        <button type="button" class="btn btn-primary" onclick="saveEditedProduct()" style="margin-top: 20px;">
                            <i class="fas fa-save"></i> Save Changes
                        </button>
                        
                        <button type="button" class="btn" onclick="showSection('products')" style="margin-top: 20px; margin-left: 10px; background: #f0f0f0;">
                            Cancel
                        </button>
                    </form>
                `;
                
                // Set current value for location
                document.getElementById('editProductLocation').value = product.location;
            } catch (error) {
                console.error('Error loading product for edit:', error);
                alert('Error loading product details');
            }
        }
        
        // Save edited product
        async function saveEditedProduct() {
            const productId = parseInt(document.getElementById('editProductId').value);
            const title = document.getElementById('editProductTitle').value.trim();
            const category = document.getElementById('editProductCategory').value;
            const price = document.getElementById('editProductPrice').value;
            const location = document.getElementById('editProductLocation').value;
            const sellerId = parseInt(document.getElementById('editProductSeller').value);
            const description = document.getElementById('editProductDescription').value.trim();
            const whatsapp = document.getElementById('editProductWhatsApp').value.trim();
            const status = document.getElementById('editProductStatus').value;
            const approved = document.getElementById('editProductApproved').value === 'true';
            
            if (!title || !category || !price || !location || !sellerId || !description) {
                alert('Please fill all required fields');
                return;
            }
            
            try {
                const seller = await BINGA_MARKETPLACE_DB.users.get(sellerId);
                if (!seller) {
                    alert('Seller not found');
                    return;
                }
                
                const updates = {
                    title: title,
                    description: description,
                    category: category,
                    price: parseFloat(price),
                    location: location,
                    sellerId: sellerId,
                    sellerName: seller.name,
                    sellerPhone: seller.phone,
                    whatsappLink: whatsapp,
                    status: status,
                    adminApproved: approved
                };
                
                await BINGA_MARKETPLACE_DB.products.update(productId, updates);
                
                await addSystemLog('admin', 'product_updated', `Updated product: ${title}`, currentUser.id);
                
                showAlert('Product updated successfully!', 'success');
                
                showSection('products');
                loadAllProducts();
            } catch (error) {
                console.error('Error updating product:', error);
                alert('Error updating product');
            }
        }
        
        // View product details
        async function viewProductDetails(productId) {
            try {
                const product = await BINGA_MARKETPLACE_DB.products.get(productId);
                if (!product) {
                    alert('Product not found');
                    return;
                }
                
                const media = await BINGA_MARKETPLACE_DB.media.getByEntity(productId, 'product');
                
                let details = `
                    <h3>${product.title}</h3>
                    <p><strong>ID:</strong> ${product.id}</p>
                    <p><strong>Description:</strong> ${product.description}</p>
                    <p><strong>Category:</strong> ${product.category}</p>
                    <p><strong>Price:</strong> $${product.price}</p>
                    <p><strong>Location:</strong> ${product.location}</p>
                    <p><strong>Seller:</strong> ${product.sellerName} (${product.sellerPhone})</p>
                    <p><strong>Status:</strong> ${product.status}</p>
                    <p><strong>Admin Approved:</strong> ${product.adminApproved ? 'Yes' : 'No'}</p>
                    <p><strong>Created:</strong> ${new Date(product.createdAt).toLocaleString()}</p>
                    <p><strong>WhatsApp Link:</strong> <a href="${product.whatsappLink}" target="_blank">${product.whatsappLink}</a></p>
                `;
                
                if (media.length > 0) {
                    details += `<p><strong>Media Files:</strong> ${media.length}</p>`;
                }
                
                alert(details);
            } catch (error) {
                console.error('Error viewing product details:', error);
                alert('Error loading product details');
            }
        }
        
        // Delete all products
        async function deleteAllProducts() {
            if (confirm('WARNING: This will delete ALL products. This action cannot be undone!')) {
                try {
                    const products = await BINGA_MARKETPLACE_DB.products.getAll();
                    
                    for (const product of products) {
                        await BINGA_MARKETPLACE_DB.products.delete(product.id);
                    }
                    
                    await addSystemLog('admin', 'all_products_deleted', 'Deleted all products', currentUser.id);
                    
                    showAlert('All products deleted successfully!', 'success');
                    loadAllProducts();
                } catch (error) {
                    console.error('Error deleting all products:', error);
                    alert('Error deleting all products');
                }
            }
        }
        
        // Load all attractions
        async function loadAllAttractions() {
            try {
                const attractions = await BINGA_MARKETPLACE_DB.attractions.getAll();
                const container = document.getElementById('attractionsContent');
                
                container.innerHTML = `
                    <h3 class="section-title admin">
                        <i class="fas fa-camera"></i> All Tourist Attractions (${attractions.length})
                    </h3>
                    <div style="margin-bottom: 20px;">
                        <button class="admin-button" onclick="createNewAttraction()">
                            <i class="fas fa-plus"></i> Add New Attraction
                        </button>
                        <button class="admin-button secondary" onclick="exportAttractions()">
                            <i class="fas fa-download"></i> Export Attractions
                        </button>
                        <button class="admin-button danger" onclick="deleteAllAttractions()">
                            <i class="fas fa-trash"></i> Delete All Attractions
                        </button>
                    </div>
                    <div class="system-logs" style="max-height: 600px;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Type</th>
                                    <th>Location</th>
                                    <th>Status</th>
                                    <th>Added By</th>
                                    <th>Created</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${attractions.map(a => `
                                    <tr>
                                        <td>${a.id}</td>
                                        <td>${a.name}</td>
                                        <td>${a.typeName || a.type}</td>
                                        <td>${a.location}</td>
                                        <td>
                                            <span class="status-badge ${a.adminApproved ? 'status-active' : 'status-pending'}">
                                                ${a.adminApproved ? 'Approved' : 'Pending'}
                                            </span>
                                        </td>
                                        <td>${a.addedBy}</td>
                                        <td>${new Date(a.createdAt).toLocaleDateString()}</td>
                                        <td>
                                            <button class="action-btn edit" onclick="editAttraction(${a.id})" style="padding: 3px 8px; font-size: 12px;">
                                                Edit
                                            </button>
                                            <button class="action-btn delete" onclick="deleteAttraction(${a.id})" style="padding: 3px 8px; font-size: 12px;">
                                                Delete
                                            </button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            } catch (error) {
                console.error('Error loading all attractions:', error);
            }
        }
        
        // Load database management
        async function loadDatabaseManagement() {
            const container = document.getElementById('databaseContent');
            
            const mediaStats = await BINGA_MARKETPLACE_DB.media.getStorageStats();
            const users = await BINGA_MARKETPLACE_DB.users.getAll();
            const products = await BINGA_MARKETPLACE_DB.products.getAll();
            const attractions = await BINGA_MARKETPLACE_DB.attractions.getAll();
            const media = await BINGA_MARKETPLACE_DB.media.getAll();
            const logs = await BINGA_MARKETPLACE_DB.systemLogs.getAll();
            
            container.innerHTML = `
                <h3 class="section-title admin">
                    <i class="fas fa-database"></i> Database Management
                </h3>
                
                <div class="quick-stats">
                    <div class="quick-stat">
                        <div class="quick-stat-number">${users.length}</div>
                        <div>Users</div>
                    </div>
                    <div class="quick-stat">
                        <div class="quick-stat-number">${products.length}</div>
                        <div>Products</div>
                    </div>
                    <div class="quick-stat">
                        <div class="quick-stat-number">${attractions.length}</div>
                        <div>Attractions</div>
                    </div>
                    <div class="quick-stat">
                        <div class="quick-stat-number">${media.length}</div>
                        <div>Media Files</div>
                    </div>
                    <div class="quick-stat">
                        <div class="quick-stat-number">${logs.length}</div>
                        <div>System Logs</div>
                    </div>
                    <div class="quick-stat">
                        <div class="quick-stat-number">${mediaStats.formattedSize}</div>
                        <div>Database Size</div>
                    </div>
                </div>
                
                <div class="export-controls">
                    <h4><i class="fas fa-download"></i> Export Database</h4>
                    <p>Export all database data as a JSON file for backup.</p>
                    <div class="export-buttons">
                        <button class="export-btn" onclick="exportDatabase()">
                            <i class="fas fa-file-export"></i> Export All Data
                        </button>
                        <button class="export-btn" onclick="exportUsers()">
                            <i class="fas fa-users"></i> Export Users Only
                        </button>
                        <button class="export-btn" onclick="exportProducts()">
                            <i class="fas fa-boxes"></i> Export Products Only
                        </button>
                        <button class="export-btn" onclick="exportAttractions()">
                            <i class="fas fa-camera"></i> Export Attractions Only
                        </button>
                    </div>
                </div>
                
                <div class="backup-controls">
                    <h4><i class="fas fa-upload"></i> Import Database</h4>
                    <p>Import database data from a JSON backup file.</p>
                    <div class="export-buttons">
                        <button class="export-btn" onclick="importDatabase()">
                            <i class="fas fa-file-import"></i> Import All Data
                        </button>
                        <button class="export-btn" onclick="importProducts()">
                            <i class="fas fa-boxes"></i> Import Products Only
                        </button>
                        <input type="file" id="databaseImport" accept=".json" style="display: none;">
                    </div>
                </div>
                
                <div class="database-management">
                    <h4><i class="fas fa-cog"></i> Database Maintenance</h4>
                    <div class="database-actions">
                        <button class="admin-button" onclick="optimizeDatabase()">
                            <i class="fas fa-tools"></i> Optimize Database
                        </button>
                        <button class="admin-button secondary" onclick="clearSystemLogs()">
                            <i class="fas fa-trash"></i> Clear System Logs
                        </button>
                        <button class="admin-button danger" onclick="clearAllData()">
                            <i class="fas fa-database"></i> Clear All Data
                        </button>
                    </div>
                </div>
            `;
        }
        
        // Export database
        async function exportDatabase() {
            try {
                const allData = await BINGA_MARKETPLACE_DB.exportAllData();
                const dataStr = JSON.stringify(allData, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = `binga-marketplace-backup-${new Date().toISOString().split('T')[0]}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
                
                await addSystemLog('admin', 'database_exported', 'Exported full database backup', currentUser.id);
                
                showAlert('Database exported successfully!', 'success');
            } catch (error) {
                console.error('Error exporting database:', error);
                alert('Error exporting database');
            }
        }
        
        // Export users
        async function exportUsers() {
            try {
                const users = await BINGA_MARKETPLACE_DB.users.getAll();
                const dataStr = JSON.stringify(users, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = `binga-users-${new Date().toISOString().split('T')[0]}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
                
                await addSystemLog('admin', 'users_exported', 'Exported users data', currentUser.id);
                
                showAlert('Users exported successfully!', 'success');
            } catch (error) {
                console.error('Error exporting users:', error);
                alert('Error exporting users');
            }
        }
        
        // Export products
        async function exportProducts() {
            try {
                const products = await BINGA_MARKETPLACE_DB.products.getAll();
                const dataStr = JSON.stringify(products, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = `binga-products-${new Date().toISOString().split('T')[0]}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
                
                await addSystemLog('admin', 'products_exported', 'Exported products data', currentUser.id);
                
                showAlert('Products exported successfully!', 'success');
            } catch (error) {
                console.error('Error exporting products:', error);
                alert('Error exporting products');
            }
        }
        
        // Export attractions
        async function exportAttractions() {
            try {
                const attractions = await BINGA_MARKETPLACE_DB.attractions.getAll();
                const dataStr = JSON.stringify(attractions, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = `binga-attractions-${new Date().toISOString().split('T')[0]}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
                
                await addSystemLog('admin', 'attractions_exported', 'Exported attractions data', currentUser.id);
                
                showAlert('Attractions exported successfully!', 'success');
            } catch (error) {
                console.error('Error exporting attractions:', error);
                alert('Error exporting attractions');
            }
        }
        
        // Import database
        async function importDatabase() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = async function(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                if (!confirm('WARNING: This will replace ALL current data with the imported data. Continue?')) {
                    return;
                }
                
                try {
                    const text = await file.text();
                    const data = JSON.parse(text);
                    
                    await BINGA_MARKETPLACE_DB.importAllData(data);
                    
                    await addSystemLog('admin', 'database_imported', 'Imported full database backup', currentUser.id);
                    
                    showAlert('Database imported successfully! Page will reload.', 'success');
                    
                    setTimeout(() => {
                        location.reload();
                    }, 2000);
                } catch (error) {
                    console.error('Error importing database:', error);
                    alert('Error importing database. Make sure the file is a valid JSON backup.');
                }
            };
            
            input.click();
        }
        
        // Import products
        async function importProducts() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = async function(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                if (!confirm('WARNING: This will replace ALL current products with the imported products. Continue?')) {
                    return;
                }
                
                try {
                    const text = await file.text();
                    const products = JSON.parse(text);
                    
                    // Clear existing products
                    const transaction = db.transaction(['products'], 'readwrite');
                    const store = transaction.objectStore('products');
                    await new Promise((resolve, reject) => {
                        const request = store.clear();
                        request.onsuccess = () => resolve(true);
                        request.onerror = () => reject(request.error);
                    });
                    
                    // Add new products
                    for (const product of products) {
                        await BINGA_MARKETPLACE_DB.products.add(product);
                    }
                    
                    await addSystemLog('admin', 'products_imported', 'Imported products data', currentUser.id);
                    
                    showAlert('Products imported successfully!', 'success');
                    loadDatabaseManagement();
                    loadAllProducts();
                } catch (error) {
                    console.error('Error importing products:', error);
                    alert('Error importing products. Make sure the file is a valid JSON file with products.');
                }
            };
            
            input.click();
        }
        
        // Optimize database
        async function optimizeDatabase() {
            try {
                // This is a placeholder for database optimization
                // In a real app, you might compress images, remove unused data, etc.
                
                await addSystemLog('admin', 'database_optimized', 'Database optimization completed', currentUser.id);
                
                showAlert('Database optimization completed!', 'success');
            } catch (error) {
                console.error('Error optimizing database:', error);
                alert('Error optimizing database');
            }
        }
        
        // Clear system logs
        async function clearSystemLogs() {
            if (confirm('Clear all system logs?')) {
                try {
                    await BINGA_MARKETPLACE_DB.systemLogs.clearAll();
                    systemLogs = [];
                    
                    await addSystemLog('admin', 'logs_cleared', 'Cleared all system logs', currentUser.id);
                    
                    showAlert('System logs cleared successfully!', 'success');
                    loadDatabaseManagement();
                } catch (error) {
                    console.error('Error clearing system logs:', error);
                    alert('Error clearing system logs');
                }
            }
        }
        
        // Load system configuration
        async function loadSystemConfiguration() {
            await loadSystemSettings(); // Reuse the same function
        }
        
        // Load system logs display
        async function loadSystemLogsDisplay() {
            const container = document.getElementById('logsContent');
            
            container.innerHTML = `
                <h3 class="section-title admin">
                    <i class="fas fa-clipboard-list"></i> System Logs (${systemLogs.length})
                </h3>
                <div style="margin-bottom: 20px;">
                    <button class="admin-button" onclick="loadSystemLogsDisplay()">
                        <i class="fas fa-sync"></i> Refresh
                    </button>
                    <button class="admin-button secondary" onclick="exportSystemLogs()">
                        <i class="fas fa-download"></i> Export Logs
                    </button>
                    <button class="admin-button danger" onclick="clearSystemLogs()">
                        <i class="fas fa-trash"></i> Clear Logs
                    </button>
                </div>
                <div class="system-logs" style="max-height: 600px;">
                    ${systemLogs.length > 0 ? 
                        systemLogs.map(log => `
                            <div class="log-entry ${log.type}">
                                <div style="display: flex; justify-content: space-between;">
                                    <div>
                                        <strong>${log.action}</strong>
                                        <span style="color: #666; margin-left: 10px; font-size: 11px;">
                                            ${new Date(log.timestamp).toLocaleString()}
                                        </span>
                                    </div>
                                    <div style="font-size: 11px; color: #999;">
                                        ${log.userId ? `User: ${log.userId}` : 'System'}
                                    </div>
                                </div>
                                <div style="margin-top: 5px; font-size: 12px;">
                                    ${log.details}
                                </div>
                            </div>
                        `).join('') :
                        '<p>No system logs available</p>'
                    }
                </div>
            `;
        }
        
        // Export system logs
        async function exportSystemLogs() {
            try {
                const dataStr = JSON.stringify(systemLogs, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = `binga-system-logs-${new Date().toISOString().split('T')[0]}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
                
                await addSystemLog('admin', 'logs_exported', 'Exported system logs', currentUser.id);
                
                showAlert('System logs exported successfully!', 'success');
            } catch (error) {
                console.error('Error exporting system logs:', error);
                alert('Error exporting system logs');
            }
        }
        
        // Load quick actions
        async function loadQuickActions() {
            const container = document.getElementById('quickActionsContent');
            
            container.innerHTML = `
                <h3 class="section-title admin">
                    <i class="fas fa-bolt"></i> Quick Administrative Actions
                </h3>
                
                <div class="admin-controls">
                    <div class="admin-buttons">
                        <button class="admin-button" onclick="showSection('manage')">
                            <i class="fas fa-cogs"></i> Manage Everything
                        </button>
                        <button class="admin-button secondary" onclick="loadPendingApprovals()">
                            <i class="fas fa-clock"></i> Pending Approvals
                        </button>
                        <button class="admin-button" onclick="createNewUser()">
                            <i class="fas fa-user-plus"></i> Create User
                        </button>
                        <button class="admin-button secondary" onclick="createNewProduct()">
                            <i class="fas fa-plus"></i> Create Product
                        </button>
                        <button class="admin-button" onclick="createNewAttraction()">
                            <i class="fas fa-camera"></i> Create Attraction
                        </button>
                    </div>
                </div>
                
                <div style="margin-top: 30px; background: #f8f9fa; padding: 20px; border-radius: 8px;">
                    <h4><i class="fas fa-exclamation-triangle"></i> System Actions</h4>
                    <div style="margin-top: 15px;">
                        <button class="admin-button" onclick="exportDatabase()">
                            <i class="fas fa-download"></i> Backup Database
                        </button>
                        <button class="admin-button secondary" onclick="loadDatabaseManagement()">
                            <i class="fas fa-database"></i> Database Tools
                        </button>
                        <button class="admin-button danger" onclick="resetSystem()">
                            <i class="fas fa-redo"></i> System Reset
                        </button>
                    </div>
                </div>
                
                <div style="margin-top: 30px; background: #e8f4fd; padding: 20px; border-radius: 8px;">
                    <h4><i class="fas fa-info-circle"></i> System Status</h4>
                    <div style="margin-top: 15px;">
                        <p><strong>Current User:</strong> ${currentUser.name} (${currentUser.role})</p>
                        <p><strong>Database:</strong> ${systemLogs.length} logs, ${await getTotalRecordCount()} total records</p>
                        <p><strong>Last Backup:</strong> ${localStorage.getItem('last_backup') || 'Never'}</p>
                    </div>
                </div>
            `;
        }
        
        // Get total record count
        async function getTotalRecordCount() {
            try {
                const users = await BINGA_MARKETPLACE_DB.users.getAll();
                const products = await BINGA_MARKETPLACE_DB.products.getAll();
                const attractions = await BINGA_MARKETPLACE_DB.attractions.getAll();
                const media = await BINGA_MARKETPLACE_DB.media.getAll();
                
                return users.length + products.length + attractions.length + media.length;
            } catch (error) {
                return 0;
            }
        }
        
        // Reset system
        async function resetSystem() {
            if (confirm('Reset the system to default settings? This will clear all data except admin accounts.')) {
                try {
                    // Clear all data except admin users
                    const users = await BINGA_MARKETPLACE_DB.users.getAll();
                    const adminUsers = users.filter(u => u.type === 'admin');
                    
                    // Clear all data
                    await BINGA_MARKETPLACE_DB.clearAllData();
                    
                    // Restore admin users
                    for (const admin of adminUsers) {
                        await BINGA_MARKETPLACE_DB.users.add(admin);
                    }
                    
                    await addSystemLog('admin', 'system_reset', 'System reset to defaults (admin accounts preserved)', currentUser.id);
                    
                    showAlert('System reset successfully! Page will reload.', 'success');
                    
                    setTimeout(() => {
                        location.reload();
                    }, 2000);
                } catch (error) {
                    console.error('Error resetting system:', error);
                    alert('Error resetting system');
                }
            }
        }
        
        // Show alert
        function showAlert(message, type) {
            const existingAlerts = document.querySelectorAll('.alert');
            existingAlerts.forEach(alert => alert.remove());
            
            const alertEl = document.createElement('div');
            alertEl.className = `alert alert-${type}`;
            alertEl.innerHTML = `
                ${message}
                <button onclick="this.parentElement.remove()" style="float: right; background: none; border: none; font-size: 20px; cursor: pointer;">Ã—</button>
            `;
            
            const mainContent = document.getElementById('mainContent');
            if (mainContent.firstChild) {
                mainContent.insertBefore(alertEl, mainContent.firstChild);
            } else {
                mainContent.appendChild(alertEl);
            }
            
            setTimeout(() => {
                if (alertEl.parentElement) {
                    alertEl.remove();
                }
            }, 5000);
        }
        
        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('authModal');
            if (event.target === modal) {
                closeAuthModal();
            }
            
            const mediaModal = document.getElementById('mediaModal');
            if (event.target === mediaModal) {
                closeMediaModal();
            }
        };
        
        // Initialize app when page loads
        window.onload = initApp;
    </script>
</body>
</html>
