<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Binga Marketplace - Buy & Sell Fish, Livestock, Goods</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #1a5276;
            --secondary: #d4ac0d;
            --accent: #27ae60;
            --danger: #e74c3c;
            --warning: #f39c12;
            --light: #f8f9fa;
            --dark: #333333;
            --border: #e0e0e0;
            --tourist: #8e44ad;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        /* Header */
        .site-header {
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .header-top {
            background: var(--primary);
            color: white;
            padding: 8px 0;
            font-size: 14px;
        }
        
        .header-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-top .header-container {
            justify-content: space-between;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
            color: var(--primary);
        }
        
        .logo-icon {
            font-size: 32px;
            color: var(--secondary);
        }
        
        .logo-text h1 {
            font-size: 24px;
            font-weight: 700;
        }
        
        .logo-text span {
            font-size: 12px;
            color: #666;
        }
        
        /* Auth in top-right corner */
        .auth-container {
            position: relative;
        }
        
        .auth-buttons {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .auth-type-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            border-bottom: 2px solid var(--border);
            padding-bottom: 10px;
        }
        
        .auth-type-btn {
            flex: 1;
            padding: 10px;
            text-align: center;
            background: #f0f0f0;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .auth-type-btn.active {
            background: var(--primary);
            color: white;
        }
        
        .auth-btn {
            padding: 8px 20px;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            font-size: 14px;
        }
        
        .auth-btn.login {
            background: transparent;
            color: var(--primary);
            border: 1px solid var(--primary);
        }
        
        .auth-btn.register {
            background: var(--primary);
            color: white;
        }
        
        .auth-btn.logout {
            background: var(--danger);
            color: white;
        }
        
        .user-menu {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .user-name {
            font-weight: 600;
            color: var(--dark);
        }
        
        /* Auth Modal */
        .auth-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            overflow-y: auto;
            padding: 20px 10px;
        }
        
        .auth-modal-content {
            background: white;
            border-radius: 8px;
            width: 400px;
            max-width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .auth-tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
        }
        
        .auth-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
        }
        
        .auth-tab.active {
            border-bottom: 3px solid var(--primary);
            color: var(--primary);
        }
        
        .auth-form {
            padding: 25px;
        }
        
        .auth-form h3 {
            margin-bottom: 20px;
            color: var(--dark);
            font-size: 20px;
        }
        
        .form-group {
            margin-bottom: 18px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #555;
            font-size: 14px;
        }
        
        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 16px;
        }
        
        .form-control:focus {
            border-color: var(--primary);
            outline: none;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
            font-size: 16px;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
            width: 100%;
        }
        
        .btn-primary:hover {
            background: #154360;
        }
        
        /* Navigation */
        .main-nav {
            background: white;
            border-top: 1px solid var(--border);
            border-bottom: 1px solid var(--border);
        }
        
        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            align-items: center;
        }
        
        .nav-links {
            display: flex;
            list-style: none;
        }
        
        .nav-link {
            padding: 15px 20px;
            text-decoration: none;
            color: var(--dark);
            font-weight: 600;
            border-bottom: 3px solid transparent;
        }
        
        .nav-link:hover, .nav-link.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }
        
        .nav-link.tourist {
            color: var(--tourist);
        }
        
        .nav-link.tourist:hover, .nav-link.tourist.active {
            color: var(--tourist);
            border-bottom-color: var(--tourist);
        }
        
        .post-ad-btn {
            margin-left: auto;
            background: var(--accent);
            color: white;
            padding: 10px 20px;
            border-radius: 4px;
            text-decoration: none;
            font-weight: 600;
        }
        
        /* Main Content */
        .main-container {
            max-width: 1400px;
            margin: 30px auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 30px;
        }
        
        /* Sidebar */
        .sidebar {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .sidebar-section {
            margin-bottom: 30px;
        }
        
        .sidebar-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 15px;
            color: var(--dark);
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }
        
        .category-list, .location-list {
            list-style: none;
        }
        
        .category-item, .location-item {
            padding: 8px 0;
            border-bottom: 1px solid #f5f5f5;
        }
        
        .category-item a, .location-item a {
            text-decoration: none;
            color: #555;
            display: flex;
            justify-content: space-between;
        }
        
        .category-item a:hover, .location-item a:hover {
            color: var(--primary);
        }
        
        .category-count, .location-count {
            background: #f0f0f0;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
        }
        
        /* Products Grid */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }
        
        .product-card {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        .product-image {
            height: 200px;
            background: linear-gradient(45deg, #f0f0f0, #e0e0e0);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            position: relative;
            overflow: hidden;
        }
        
        .product-image img, .product-image video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .product-price {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: bold;
        }
        
        .product-details {
            padding: 15px;
        }
        
        .product-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--dark);
            font-size: 16px;
            line-height: 1.4;
        }
        
        .product-meta {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }
        
        .product-location {
            font-size: 12px;
            color: #999;
            margin-top: 10px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .whatsapp-btn {
            background: #25D366;
            color: white;
            padding: 8px 15px;
            border-radius: 4px;
            text-decoration: none;
            display: inline-block;
            font-size: 14px;
            font-weight: 600;
            margin-top: 10px;
        }
        
        /* Tourist Attraction Cards */
        .attraction-card {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: transform 0.3s, box-shadow 0.3s;
            border-top: 4px solid var(--tourist);
        }
        
        .attraction-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        .attraction-image {
            height: 220px;
            background: linear-gradient(45deg, #e0d0f0, #d0c0e0);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            position: relative;
            overflow: hidden;
        }
        
        .attraction-image img, .attraction-image video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .attraction-type {
            position: absolute;
            top: 10px;
            left: 10px;
            background: var(--tourist);
            color: white;
            padding: 3px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        
        /* Search Bar */
        .search-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .search-box {
            display: flex;
            gap: 10px;
        }
        
        .search-input {
            flex: 1;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 16px;
        }
        
        .search-btn {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 0 30px;
            cursor: pointer;
            font-weight: 600;
        }
        
        /* Footer */
        .site-footer {
            background: var(--dark);
            color: white;
            margin-top: 50px;
            padding: 40px 0;
        }
        
        .footer-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
        }
        
        .footer-section h3 {
            font-size: 18px;
            margin-bottom: 20px;
            color: white;
        }
        
        .footer-links {
            list-style: none;
        }
        
        .footer-links li {
            margin-bottom: 10px;
        }
        
        .footer-links a {
            color: #bbb;
            text-decoration: none;
        }
        
        .footer-links a:hover {
            color: white;
        }
        
        /* Dashboard */
        .dashboard-container {
            max-width: 1400px;
            margin: 30px auto;
            padding: 0 20px;
        }
        
        .dashboard-header {
            background: white;
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .stat-number {
            font-size: 32px;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        /* Admin Panel */
        .admin-panel {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .admin-tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .admin-tab {
            padding: 15px 30px;
            cursor: pointer;
            font-weight: 600;
            white-space: nowrap;
        }
        
        .admin-tab.active {
            border-bottom: 3px solid var(--primary);
            color: var(--primary);
        }
        
        /* Image Upload Preview */
        .image-upload-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .image-preview {
            width: 140px;
            height: 140px;
            border: 2px dashed #ccc;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
        }
        
        .image-preview img, .image-preview video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .remove-image {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(0,0,0,0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }
        
        /* Status badges */
        .status-badge {
            padding: 3px 10px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: bold;
            display: inline-block;
        }
        
        .status-pending {
            background: var(--warning);
            color: white;
        }
        
        .status-active {
            background: var(--accent);
            color: white;
        }
        
        .status-rejected {
            background: var(--danger);
            color: white;
        }
        
        /* Action buttons */
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .action-btn {
            padding: 5px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
        }
        
        .action-btn.approve {
            background: var(--accent);
            color: white;
        }
        
        .action-btn.reject {
            background: var(--danger);
            color: white;
        }
        
        .action-btn.edit {
            background: var(--primary);
            color: white;
        }
        
        .action-btn.delete {
            background: var(--danger);
            color: white;
        }
        
        /* Image upload button */
        .image-upload-btn {
            display: inline-block;
            padding: 10px 20px;
            background: var(--primary);
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            text-align: center;
            margin-top: 10px;
        }
        
        .image-upload-btn:hover {
            background: #154360;
        }
        
        /* Upload progress */
        .upload-progress {
            width: 100%;
            background: #f0f0f0;
            border-radius: 10px;
            margin-top: 10px;
            display: none;
        }
        
        .upload-progress-bar {
            height: 10px;
            background: var(--accent);
            border-radius: 10px;
            width: 0%;
            transition: width 0.3s;
        }
        
        /* Camera button */
        .camera-btn {
            display: inline-block;
            padding: 10px 20px;
            background: var(--secondary);
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            text-align: center;
            margin-top: 10px;
            margin-left: 10px;
        }
        
        /* File type indicator */
        .file-type-badge {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: bold;
        }
        
        /* Media gallery modal */
        .media-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 3000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .media-modal-content {
            width: 90%;
            max-width: 1000px;
            max-height: 90vh;
            background: transparent;
            position: relative;
        }
        
        .media-slider {
            width: 100%;
            height: 70vh;
            position: relative;
            overflow: hidden;
        }
        
        .media-slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.5s;
        }
        
        .media-slide.active {
            opacity: 1;
        }
        
        .media-slide img, .media-slide video {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        .close-media {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 24px;
            cursor: pointer;
            z-index: 10;
        }
        
        .prev-media, .next-media {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0,0,0,0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 24px;
            cursor: pointer;
            z-index: 10;
        }
        
        .prev-media { left: 20px; }
        .next-media { right: 20px; }
        
        .media-thumbnails {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            overflow-x: auto;
            padding: 10px 0;
        }
        
        .media-thumb {
            width: 80px;
            height: 80px;
            border: 2px solid transparent;
            border-radius: 4px;
            overflow: hidden;
            cursor: pointer;
            flex-shrink: 0;
        }
        
        .media-thumb.active {
            border-color: var(--accent);
        }
        
        .media-thumb img, .media-thumb video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        /* Media counter */
        .media-counter {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
        }
        
        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        .page-btn {
            padding: 8px 15px;
            border: 1px solid var(--border);
            background: white;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .page-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .page-btn:hover:not(.active) {
            background: #f8f9fa;
        }
        
        /* Storage stats */
        .storage-stats {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 14px;
        }
        
        .storage-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            margin-top: 5px;
            overflow: hidden;
        }
        
        .storage-used {
            height: 100%;
            background: var(--accent);
            transition: width 0.3s;
        }
        
        /* Video player controls */
        .video-controls {
            position: absolute;
            bottom: 10px;
            left: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .video-play-btn {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
        }
        
        .video-progress {
            flex: 1;
            height: 5px;
            background: rgba(255,255,255,0.3);
            border-radius: 3px;
            position: relative;
            cursor: pointer;
        }
        
        .video-progress-filled {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: var(--accent);
            border-radius: 3px;
        }
        
        /* Batch upload */
        .batch-upload-btn {
            display: inline-block;
            padding: 10px 20px;
            background: var(--tourist);
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            text-align: center;
            margin-top: 10px;
            margin-left: 10px;
        }
        
        /* Responsive */
        @media (max-width: 1200px) {
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
        }
        
        @media (max-width: 992px) {
            .main-container {
                grid-template-columns: 1fr;
            }
            
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            }
        }
        
        @media (max-width: 768px) {
            .nav-container {
                flex-direction: column;
                padding: 10px;
            }
            
            .nav-links {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .post-ad-btn {
                margin: 10px 0 0 0;
            }
            
            .header-container {
                flex-direction: column;
                gap: 15px;
                padding: 15px 20px;
            }
            
            .auth-buttons {
                width: 100%;
                justify-content: center;
            }
            
            .search-box {
                flex-direction: column;
            }
            
            .search-box select {
                max-width: 100% !important;
            }
            
            .dashboard-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .admin-tabs {
                flex-direction: column;
            }
            
            .admin-tab {
                padding: 12px 20px;
                border-bottom: 1px solid var(--border);
            }
            
            .media-slider {
                height: 50vh;
            }
            
            .prev-media, .next-media {
                width: 40px;
                height: 40px;
                font-size: 20px;
            }
        }
        
        @media (max-width: 576px) {
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            }
            
            .image-upload-container {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }
            
            .image-preview {
                width: 100px;
                height: 100px;
            }
            
            .media-slider {
                height: 40vh;
            }
            
            .media-thumb {
                width: 60px;
                height: 60px;
            }
        }
        
        @media (max-width: 480px) {
            .auth-modal-content {
                width: 95%;
                max-height: 85vh;
                margin: 10px;
            }
            
            .auth-form {
                padding: 20px 15px;
            }
            
            .auth-tabs {
                flex-wrap: wrap;
            }
            
            .auth-tab {
                padding: 12px 10px;
                font-size: 14px;
            }
            
            .auth-type-selector {
                flex-direction: column;
                gap: 8px;
            }
            
            .auth-type-btn {
                padding: 10px;
                font-size: 14px;
            }
            
            .form-group {
                margin-bottom: 15px;
            }
            
            .form-control {
                padding: 10px;
                font-size: 16px;
            }
            
            .btn-primary {
                padding: 12px;
            }
            
            .auth-form h3 {
                font-size: 18px;
                margin-bottom: 15px;
            }
        }
        
        /* Verification badge */
        .verified-badge {
            background: var(--accent);
            color: white;
            padding: 3px 10px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: bold;
            display: inline-block;
            margin-left: 10px;
        }
        
        /* No products message */
        .no-products {
            text-align: center;
            padding: 60px 20px;
            background: white;
            border-radius: 8px;
            grid-column: 1 / -1;
        }
        
        /* Featured Products */
        .featured-products {
            margin-bottom: 40px;
        }
        
        .section-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title.tourist {
            color: var(--tourist);
        }
        
        /* Alert */
        .alert {
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        /* Welcome Message */
        .welcome-message {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 40px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 40px;
        }
        
        .welcome-message h2 {
            font-size: 32px;
            margin-bottom: 15px;
        }
        
        .welcome-message p {
            font-size: 18px;
            max-width: 800px;
            margin: 0 auto 25px;
        }
        
        .cta-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        .cta-button {
            padding: 15px 30px;
            background: white;
            color: var(--primary);
            border-radius: 8px;
            text-decoration: none;
            font-weight: bold;
            font-size: 16px;
        }
        
        .cta-button.secondary {
            background: transparent;
            color: white;
            border: 2px solid white;
        }
        
        /* How it works */
        .how-it-works {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin: 40px 0;
        }
        
        .step-card {
            background: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .step-number {
            width: 50px;
            height: 50px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            margin: 0 auto 20px;
        }
        
        .step-card h3 {
            margin-bottom: 15px;
            color: var(--dark);
        }
        
        /* Tourist attractions at bottom */
        .tourist-attractions-bottom {
            margin-top: 60px;
            padding-top: 40px;
            border-top: 2px solid var(--border);
        }
    </style>
</head>
<body>
    <!-- Top Bar -->
    <div class="header-top">
        <div class="header-container">
            <div>
                <i class="fas fa-phone-alt"></i> +263 77 286 3815 | 
                <i class="fas fa-map-marker-alt"></i> Binga, Lake Kariba
            </div>
            <div>
                <i class="fab fa-whatsapp"></i> WhatsApp: +263 77 286 3815
            </div>
        </div>
    </div>
    
    <!-- Main Header -->
    <header class="site-header">
        <div class="header-container">
            <!-- Logo -->
            <a href="#" class="logo">
                <div class="logo-icon">üêü</div>
                <div class="logo-text">
                    <h1>Binga Marketplace</h1>
                    <span>Buy & Sell Fish, Livestock & More</span>
                </div>
            </a>
            
            <!-- Auth Section in top-right corner ONLY -->
            <div class="auth-container">
                <div class="auth-buttons" id="authButtons">
                    <!-- Will be populated by JavaScript -->
                </div>
                
                <!-- User Menu -->
                <div class="user-menu" id="userMenu" style="display: none;">
                    <div class="user-avatar" id="userAvatar">JD</div>
                    <div>
                        <div class="user-name" id="userName">John Doe</div>
                        <button class="auth-btn logout" onclick="logout()">Logout</button>
                    </div>
                </div>
            </div>
        </div>
    </header>
    
    <!-- Navigation -->
    <nav class="main-nav">
        <div class="nav-container">
            <ul class="nav-links">
                <li><a href="#" class="nav-link active" onclick="showSection('home')">Home</a></li>
                <li><a href="#" class="nav-link" onclick="showSection('fish')">Fish</a></li>
                <li><a href="#" class="nav-link" onclick="showSection('livestock')">Livestock</a></li>
                <li><a href="#" class="nav-link" onclick="showSection('agriculture')">Agriculture</a></li>
                <li><a href="#" class="nav-link tourist" onclick="showSection('tourism')">Tourism</a></li>
                <li><a href="#" class="nav-link" onclick="showSection('services')">Services</a></li>
                <li><a href="#" class="nav-link" onclick="showSection('property')">Property</a></li>
                <li><a href="#" class="nav-link" onclick="showSection('vehicles')">Vehicles</a></li>
            </ul>
            
            <a href="#" class="post-ad-btn" onclick="showPostAdForm()">
                <i class="fas fa-plus-circle"></i> Post Free Ad
            </a>
        </div>
    </nav>
    
    <!-- Main Content -->
    <div id="mainContent">
        <!-- Home/Marketplace Section -->
        <div id="homeSection">
            <!-- Welcome Message - REMOVED LOGIN BUTTONS FROM HERE -->
            <div class="welcome-message">
                <h2>Welcome to Binga Marketplace!</h2>
                <p>The first digital marketplace for Binga community. Buy and sell fish, livestock, agricultural products, and services directly with your neighbors.</p>
                
                <div class="cta-buttons">
                    <a href="#" class="cta-button" onclick="showPostAdForm()">
                        <i class="fas fa-plus-circle"></i> Post Your First Ad
                    </a>
                    <button class="cta-button secondary" onclick="showSection('tourism')">
                        <i class="fas fa-camera"></i> Explore Tourist Attractions
                    </button>
                </div>
            </div>
            
            <!-- How It Works -->
            <div>
                <h2 class="section-title">
                    <i class="fas fa-play-circle"></i> How It Works
                </h2>
                
                <div class="how-it-works">
                    <div class="step-card">
                        <div class="step-number">1</div>
                        <h3>Register & Post</h3>
                        <p>Create your free seller account and post your products with photos and videos</p>
                    </div>
                    
                    <div class="step-card">
                        <div class="step-number">2</div>
                        <h3>Upload Media</h3>
                        <p>Upload unlimited photos and videos of your products directly from your device</p>
                    </div>
                    
                    <div class="step-card">
                        <div class="step-number">3</div>
                        <h3>Admin Approval</h3>
                        <p>Our administrator reviews and approves your listing to ensure quality</p>
                    </div>
                    
                    <div class="step-card">
                        <div class="step-number">4</div>
                        <h3>Sell & Earn</h3>
                        <p>Buyers contact you via WhatsApp and you complete the sale in person</p>
                    </div>
                </div>
            </div>
            
            <!-- Search Bar -->
            <div class="search-container">
                <div class="search-box">
                    <input type="text" class="search-input" id="searchInput" placeholder="What are you looking for?">
                    <select class="form-control" id="categorySelect" style="max-width: 200px;">
                        <option value="">All Categories</option>
                        <option value="fish">Fish</option>
                        <option value="goat">Goats</option>
                        <option value="cow">Cattle</option>
                        <option value="poultry">Poultry</option>
                        <option value="agriculture">Agriculture</option>
                        <option value="tourism">Tourism</option>
                    </select>
                    <select class="form-control" id="locationSelect" style="max-width: 200px;">
                        <option value="">All Locations</option>
                        <option value="Siachilaba">Siachilaba</option>
                        <option value="Kariyangwe">Kariyangwe</option>
                        <option value="Binga Centre">Binga Centre</option>
                        <option value="Chete Island">Chete Island</option>
                        <option value="Other">Other Areas</option>
                    </select>
                    <button class="search-btn" onclick="searchProducts()">
                        <i class="fas fa-search"></i> Search
                    </button>
                </div>
            </div>
            
            <!-- Featured Products -->
            <div class="featured-products">
                <h2 class="section-title">
                    <i class="fas fa-fire"></i> Marketplace Listings
                </h2>
                
                <div id="marketplaceMessage" class="no-products" style="display: none;">
                    <div style="font-size: 60px; margin-bottom: 20px;">üè™</div>
                    <h3>Marketplace is Empty</h3>
                    <p>No approved products have been listed yet. Be the first to post!</p>
                    <div style="margin-top: 20px;">
                        <button class="btn btn-primary" onclick="showPostAdForm()" style="margin: 10px;">
                            <i class="fas fa-plus-circle"></i> Post Your First Ad
                        </button>
                    </div>
                </div>
                
                <div class="products-grid" id="featuredProducts">
                    <!-- Approved products will be loaded here -->
                </div>
                
                <!-- Pagination for Featured Products -->
                <div class="pagination" id="featuredPagination" style="display: none;"></div>
            </div>
            
            <div class="main-container">
                <!-- Sidebar -->
                <aside class="sidebar">
                    <div class="sidebar-section">
                        <h3 class="sidebar-title">Categories</h3>
                        <ul class="category-list" id="categoryList">
                            <!-- Categories will be loaded here -->
                        </ul>
                    </div>
                    
                    <div class="sidebar-section">
                        <h3 class="sidebar-title">Locations</h3>
                        <ul class="location-list" id="locationList">
                            <!-- Locations will be loaded here -->
                        </ul>
                    </div>
                    
                    <div class="sidebar-section">
                        <h3 class="sidebar-title">Sell Fast Tips</h3>
                        <ul style="list-style: none; color: #666; font-size: 14px;">
                            <li style="margin-bottom: 10px;">‚úÖ Upload clear photos & videos</li>
                            <li style="margin-bottom: 10px;">‚úÖ Show products from different angles</li>
                            <li style="margin-bottom: 10px;">‚úÖ Take photos in good daylight</li>
                            <li style="margin-bottom: 10px;">‚úÖ Set fair prices</li>
                            <li style="margin-bottom: 10px;">‚úÖ Include WhatsApp number</li>
                            <li>‚úÖ Respond quickly to buyers</li>
                        </ul>
                    </div>
                    
                    <!-- Storage Stats -->
                    <div class="sidebar-section">
                        <h3 class="sidebar-title">Storage Usage</h3>
                        <div class="storage-stats">
                            <div>Media Storage: <span id="storageUsed">0 MB</span> / <span id="storageTotal">5000 MB</span></div>
                            <div class="storage-bar">
                                <div class="storage-used" id="storageBar"></div>
                            </div>
                            <div style="margin-top: 10px; font-size: 12px; color: #666;">
                                <i class="fas fa-info-circle"></i> IndexedDB can store up to 5GB
                            </div>
                        </div>
                    </div>
                </aside>
                
                <!-- Products Grid -->
                <div>
                    <h2 class="section-title">
                        <i class="fas fa-clock"></i> Recent Listings
                    </h2>
                    
                    <div class="products-grid" id="recentProducts">
                        <!-- Recent products will be loaded here -->
                    </div>
                    
                    <div id="recentProductsMessage" class="no-products" style="display: none;">
                        <div style="font-size: 60px; margin-bottom: 20px;">üì¶</div>
                        <h3>No Recent Listings</h3>
                        <p>Check back soon or be the first to post!</p>
                    </div>
                    
                    <!-- Pagination for Recent Products -->
                    <div class="pagination" id="recentPagination" style="display: none;"></div>
                </div>
            </div>
            
            <!-- TOURIST ATTRACTIONS MOVED TO BOTTOM -->
            <div class="tourist-attractions-bottom" id="touristBottomSection">
                <h2 class="section-title tourist">
                    <i class="fas fa-camera"></i> Binga Tourist Attractions
                </h2>
                
                <div id="noAttractionsMessage" class="no-products" style="display: none;">
                    <div style="font-size: 60px; margin-bottom: 20px;">üèûÔ∏è</div>
                    <h3>No Tourist Attractions Listed</h3>
                    <p>Administrators can add Binga's beautiful attractions here</p>
                </div>
                
                <div class="products-grid" id="touristAttractions">
                    <!-- Tourist attractions will be loaded here -->
                </div>
                
                <!-- Pagination for Tourist Attractions -->
                <div class="pagination" id="touristPagination" style="display: none;"></div>
            </div>
        </div>
        
        <!-- Tourism Section -->
        <div id="tourismSection" class="dashboard-container" style="display: none;">
            <div class="dashboard-header">
                <h2><i class="fas fa-camera"></i> Binga Tourist Attractions</h2>
                <p>Discover the beauty of Binga - Lake Kariba, Hot Springs, Beaches & More</p>
            </div>
            
            <div id="tourismContent">
                <!-- Tourism content will be loaded here -->
            </div>
        </div>
        
        <!-- Dashboard Section -->
        <div id="dashboardSection" class="dashboard-container" style="display: none;">
            <div class="dashboard-header">
                <h2>My Dashboard</h2>
                <p>Manage your products and account</p>
            </div>
            
            <div class="dashboard-stats">
                <div class="stat-card">
                    <div class="stat-number" id="myProductsCount">0</div>
                    <div>My Products</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="myViewsCount">0</div>
                    <div>Total Views</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="myPendingCount">0</div>
                    <div>Pending Approval</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="myActiveCount">0</div>
                    <div>Active Listings</div>
                </div>
            </div>
            
            <div class="admin-panel" id="userDashboard">
                <!-- User dashboard content will be loaded here -->
            </div>
        </div>
        
        <!-- Admin Panel Section -->
        <div id="adminSection" class="dashboard-container" style="display: none;">
            <div class="dashboard-header">
                <h2><i class="fas fa-crown"></i> Administrator Control Panel</h2>
                <p>Manage marketplace, approve listings, control tourist attractions</p>
            </div>
            
            <div class="admin-panel">
                <div class="admin-tabs">
                    <div class="admin-tab active" onclick="showAdminTab('pending')">Pending Ads</div>
                    <div class="admin-tab" onclick="showAdminTab('attractions')">Tourist Attractions</div>
                    <div class="admin-tab" onclick="showAdminTab('reported')">Reported Ads</div>
                    <div class="admin-tab" onclick="showAdminTab('users')">Users</div>
                    <div class="admin-tab" onclick="showAdminTab('stats')">Statistics</div>
                    <div class="admin-tab" onclick="showAdminTab('settings')">Settings</div>
                </div>
                
                <div id="adminContent">
                    <!-- Admin content will be loaded here -->
                </div>
            </div>
        </div>
        
        <!-- Post Ad Form -->
        <div id="postAdSection" class="dashboard-container" style="display: none;">
            <div class="dashboard-header">
                <h2>Post Free Advertisement</h2>
                <p>Reach thousands of buyers in Binga</p>
            </div>
            
            <div class="admin-panel">
                <div id="postAdForm">
                    <!-- Post ad form will be loaded here -->
                </div>
            </div>
        </div>
        
        <!-- Add Tourist Attraction Form -->
        <div id="addAttractionSection" class="dashboard-container" style="display: none;">
            <div class="dashboard-header">
                <h2><i class="fas fa-plus-circle"></i> Add Tourist Attraction</h2>
                <p>Showcase Binga's beautiful places to visitors</p>
            </div>
            
            <div class="admin-panel">
                <div id="addAttractionForm">
                    <!-- Add attraction form will be loaded here -->
                </div>
            </div>
        </div>
        
        <!-- Edit Tourist Attraction Form -->
        <div id="editAttractionSection" class="dashboard-container" style="display: none;">
            <div class="dashboard-header">
                <h2><i class="fas fa-edit"></i> Edit Tourist Attraction</h2>
                <p>Update attraction details</p>
            </div>
            
            <div class="admin-panel">
                <div id="editAttractionForm">
                    <!-- Edit attraction form will be loaded here -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Media Gallery Modal -->
    <div class="media-modal" id="mediaModal">
        <button class="close-media" onclick="closeMediaModal()">√ó</button>
        <div class="media-modal-content">
            <div class="media-slider" id="mediaSlider">
                <!-- Media slides will be loaded here -->
            </div>
            <button class="prev-media" onclick="prevMedia()">‚Äπ</button>
            <button class="next-media" onclick="nextMedia()">‚Ä∫</button>
            <div class="media-counter" id="mediaCounter">1 / 1</div>
            <div class="media-thumbnails" id="mediaThumbnails">
                <!-- Media thumbnails will be loaded here -->
            </div>
        </div>
    </div>
    
    <!-- Footer -->
    <footer class="site-footer">
        <div class="footer-container">
            <div class="footer-section">
                <h3>Binga Marketplace</h3>
                <p>The first online marketplace in Binga. Buy and sell fish, livestock, agricultural products, services, and more.</p>
                <p style="margin-top: 15px;">
                    <i class="fas fa-phone"></i> +263 77 286 3815<br>
                    <i class="fas fa-envelope"></i> info@bingamarket.co.zw
                </p>
            </div>
            
            <div class="footer-section">
                <h3>Quick Links</h3>
                <ul class="footer-links">
                    <li><a href="#" onclick="showSection('home')">Home</a></li>
                    <li><a href="#" onclick="showSection('fish')">Fish Market</a></li>
                    <li><a href="#" onclick="showSection('livestock')">Livestock</a></li>
                    <li><a href="#" onclick="showSection('tourism')">Tourist Attractions</a></li>
                    <li><a href="#" onclick="showPostAdForm()">Post Free Ad</a></li>
                </ul>
            </div>
            
            <div class="footer-section">
                <h3>Help & Support</h3>
                <ul class="footer-links">
                    <li><a href="#" onclick="alert('Contact +263 77 286 3815 for all inquiries')">Contact Administrator</a></li>
                    <li><a href="#" onclick="alert('Safety tips coming soon')">Safety Tips</a></li>
                    <li><a href="#" onclick="alert('How to sell on Binga Marketplace')">How to Sell</a></li>
                    <li><a href="#" onclick="alert('Terms & Conditions coming soon')">Terms & Conditions</a></li>
                </ul>
            </div>
            
            <div class="footer-section">
                <h3>Follow Us</h3>
                <div style="display: flex; gap: 15px; margin-top: 15px;">
                    <a href="#" style="color: white; font-size: 24px;"><i class="fab fa-facebook"></i></a>
                    <a href="#" style="color: white; font-size: 24px;"><i class="fab fa-whatsapp"></i></a>
                    <a href="#" style="color: white; font-size: 24px;"><i class="fab fa-twitter"></i></a>
                </div>
                <p style="margin-top: 20px; color: #bbb; font-size: 14px;">
                    ¬© 2024 Binga Marketplace. Administrator Contact: +263 77 286 3815
                </p>
            </div>
        </div>
    </footer>
    
    <!-- Auth Modal -->
    <div class="auth-modal" id="authModal">
        <div class="auth-modal-content">
            <div class="auth-tabs">
                <div class="auth-tab active" onclick="showAuthForm('login')">Login</div>
                <div class="auth-tab" onclick="showAuthForm('register')">Register as Seller</div>
            </div>
            
            <div class="auth-form">
                <div id="loginTypeSelector" style="margin-bottom: 20px;">
                    <div class="auth-type-selector">
                        <button class="auth-type-btn active" onclick="setLoginType('seller')">Seller Login</button>
                        <button class="auth-type-btn" onclick="setLoginType('admin')">Admin Login</button>
                    </div>
                </div>
                
                <div id="loginForm">
                    <h3 id="loginTitle">Login to Seller Account</h3>
                    <div class="form-group">
                        <label class="form-label" id="loginLabel">Username</label>
                        <input type="text" class="form-control" id="loginEmail" placeholder="Enter your username">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-control" id="loginPassword" placeholder="Enter your password">
                    </div>
                    <button class="btn btn-primary" onclick="login()">Login</button>
                    <div class="password-reset">
                        <p style="color: #666; font-size: 14px;">
                            <a href="#" style="color: var(--primary);" onclick="handleForgotPassword()">Forgot Password?</a>
                        </p>
                        <p style="color: #666; font-size: 14px; margin-top: 10px;">
                            Note: For security reasons, you need to register again if you forget your password.
                        </p>
                    </div>
                </div>
                
                <div id="registerForm" style="display: none;">
                    <h3>Create Seller Account</h3>
                    <div class="form-group">
                        <label class="form-label">Full Name*</label>
                        <input type="text" class="form-control" id="registerName" placeholder="Full name" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Phone Number*</label>
                        <input type="tel" class="form-control" id="registerPhone" placeholder="263771234567" required>
                        <small style="color: #666; display: block; margin-top: 5px;">Enter phone number without + sign (e.g., 263771234567)</small>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Username*</label>
                        <input type="text" class="form-control" id="registerUsername" placeholder="Choose a username" required>
                        <small style="color: #666; display: block; margin-top: 5px;">This will be used to login</small>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Password*</label>
                        <input type="password" class="form-control" id="registerPassword" placeholder="Create password" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Confirm Password*</label>
                        <input type="password" class="form-control" id="registerConfirmPassword" placeholder="Confirm password" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Location in Binga*</label>
                        <select class="form-control" id="registerLocation" required>
                            <option value="">Select Location</option>
                            <option>Siachilaba</option>
                            <option>Kariyangwe</option>
                            <option>Binga Centre</option>
                            <option>Chete Island</option>
                            <option>Other</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" onclick="register()">Create Seller Account</button>
                    <p style="text-align: center; margin-top: 15px; color: #666; font-size: 14px;">
                        Note: All accounts must be approved by administrator
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // IndexedDB Database Configuration for Scalable Storage
        const DB_NAME = 'binga_marketplace';
        const DB_VERSION = 7; // Incremented to update structure
        
        // Database schema
        const DB_SCHEMA = {
            users: {
                key: 'id',
                indexes: ['username', 'phone', 'type', 'approved', 'location']
            },
            products: {
                key: 'id',
                indexes: ['sellerId', 'category', 'location', 'status', 'approved', 'createdAt']
            },
            attractions: {
                key: 'id',
                indexes: ['type', 'location', 'status', 'addedBy']
            },
            media: {
                key: 'id',
                indexes: ['entityId', 'entityType', 'mediaType', 'uploadedAt']
            },
            categories: {
                key: 'id'
            },
            locations: {
                key: 'id'
            },
            attractionTypes: {
                key: 'id'
            }
        };
        
        // Database instance
        let db = null;
        let currentUser = null;
        let loginType = 'seller';
        let uploadedMedia = [];
        let isUploading = false;
        let currentMediaIndex = 0;
        let currentMediaItems = [];
        
        // Initialize IndexedDB
        async function initDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, DB_VERSION);
                
                request.onerror = (event) => {
                    console.error('IndexedDB error:', event.target.error);
                    reject(event.target.error);
                };
                
                request.onsuccess = (event) => {
                    db = event.target.result;
                    console.log('IndexedDB initialized successfully');
                    resolve(db);
                };
                
                request.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    const oldVersion = event.oldVersion;
                    
                    // Create object stores if they don't exist
                    if (!db.objectStoreNames.contains('users')) {
                        const usersStore = db.createObjectStore('users', { keyPath: 'id' });
                        usersStore.createIndex('username', 'username', { unique: true });
                        usersStore.createIndex('phone', 'phone', { unique: true });
                        usersStore.createIndex('type', 'type');
                        usersStore.createIndex('approved', 'approved');
                        usersStore.createIndex('location', 'location');
                    }
                    
                    if (!db.objectStoreNames.contains('products')) {
                        const productsStore = db.createObjectStore('products', { keyPath: 'id' });
                        productsStore.createIndex('sellerId', 'sellerId');
                        productsStore.createIndex('category', 'category');
                        productsStore.createIndex('location', 'location');
                        productsStore.createIndex('status', 'status');
                        productsStore.createIndex('approved', 'approved');
                        productsStore.createIndex('createdAt', 'createdAt');
                    }
                    
                    if (!db.objectStoreNames.contains('attractions')) {
                        const attractionsStore = db.createObjectStore('attractions', { keyPath: 'id' });
                        attractionsStore.createIndex('type', 'type');
                        attractionsStore.createIndex('location', 'location');
                        attractionsStore.createIndex('status', 'status');
                        attractionsStore.createIndex('addedBy', 'addedBy');
                    }
                    
                    if (!db.objectStoreNames.contains('media')) {
                        const mediaStore = db.createObjectStore('media', { keyPath: 'id' });
                        mediaStore.createIndex('entityId', 'entityId');
                        mediaStore.createIndex('entityType', 'entityType');
                        mediaStore.createIndex('mediaType', 'mediaType');
                        mediaStore.createIndex('uploadedAt', 'uploadedAt');
                    }
                    
                    if (!db.objectStoreNames.contains('categories')) {
                        db.createObjectStore('categories', { keyPath: 'id' });
                    }
                    
                    if (!db.objectStoreNames.contains('locations')) {
                        db.createObjectStore('locations', { keyPath: 'id' });
                    }
                    
                    if (!db.objectStoreNames.contains('attractionTypes')) {
                        db.createObjectStore('attractionTypes', { keyPath: 'id' });
                    }
                    
                    // Add sample data if new database
                    if (oldVersion < 1) {
                        addSampleData(db);
                    }
                };
            });
        }
        
        // Add sample data to the database
        async function addSampleData(db) {
            const transaction = db.transaction(['users', 'products', 'attractions', 'categories', 'locations', 'attractionTypes'], 'readwrite');
            
            // Sample users - UPDATED ADMIN CREDENTIALS
            const users = [
                {
                    id: 1,
                    username: 'Munkuli#1996',
                    password: 'Wiseman',
                    name: 'Binga Administrator',
                    phone: '263772863815',
                    email: 'admin@bingamarket.co.zw',
                    location: 'Binga Centre',
                    type: 'admin',
                    role: 'superadmin',
                    registered: new Date().toISOString(),
                    products: [],
                    rating: 5.0,
                    approved: true,
                    status: 'active'
                },
                {
                    id: 2,
                    username: 'johnfish',
                    password: 'john123',
                    name: 'John Fishing',
                    phone: '263773456789',
                    email: 'john@email.com',
                    location: 'Siachilaba',
                    type: 'seller',
                    registered: new Date().toISOString(),
                    products: [],
                    rating: 4.5,
                    approved: true,
                    status: 'active'
                },
                {
                    id: 3,
                    username: 'marygoat',
                    password: 'mary123',
                    name: 'Mary Livestock',
                    phone: '263774567890',
                    email: 'mary@email.com',
                    location: 'Kariyangwe',
                    type: 'seller',
                    registered: new Date().toISOString(),
                    products: [],
                    rating: 4.8,
                    approved: true,
                    status: 'active'
                }
            ];
            
            // Sample categories
            const categories = [
                {id: 'fish', name: 'Fish & Seafood', icon: 'üêü'},
                {id: 'goat', name: 'Goats', icon: 'üêê'},
                {id: 'cow', name: 'Cattle', icon: 'üêÑ'},
                {id: 'poultry', name: 'Poultry', icon: 'üêì'},
                {id: 'agriculture', name: 'Agriculture', icon: 'üåæ'},
                {id: 'tourism', name: 'Tourism Services', icon: 'üèûÔ∏è'},
                {id: 'services', name: 'Services', icon: 'üîß'},
                {id: 'property', name: 'Property', icon: 'üè†'},
                {id: 'vehicles', name: 'Vehicles', icon: 'üöó'}
            ];
            
            // Sample locations
            const locations = [
                {id: 'Siachilaba', name: 'Siachilaba'},
                {id: 'Kariyangwe', name: 'Kariyangwe'},
                {id: 'Binga Centre', name: 'Binga Centre'},
                {id: 'Chete Island', name: 'Chete Island'},
                {id: 'Lake Kariba', name: 'Lake Kariba'},
                {id: 'Other', name: 'Other Areas'}
            ];
            
            // Sample attraction types
            const attractionTypes = [
                {id: 'beach', name: 'Beach'},
                {id: 'hotspring', name: 'Hot Spring'},
                {id: 'lake', name: 'Lake View'},
                {id: 'cultural', name: 'Cultural Site'},
                {id: 'wildlife', name: 'Wildlife'},
                {id: 'accommodation', name: 'Accommodation'},
                {id: 'tour', name: 'Tour Service'}
            ];
            
            // Sample tourist attractions
            const attractions = [
                {
                    id: 1,
                    name: 'Lake Kariba Shore',
                    description: 'Beautiful lakeside views and fishing spots with stunning sunsets',
                    type: 'lake',
                    typeName: 'Lake View',
                    location: 'Lake Kariba',
                    whatsappLink: 'https://wa.me/263772863815?text=Hi! I want to visit Lake Kariba',
                    status: 'active',
                    addedBy: 1,
                    createdAt: new Date().toISOString()
                },
                {
                    id: 2,
                    name: 'Binga Hot Springs',
                    description: 'Natural hot springs with therapeutic properties',
                    type: 'hotspring',
                    typeName: 'Hot Spring',
                    location: 'Binga Centre',
                    whatsappLink: 'https://wa.me/263772863815?text=Hi! I want to visit Binga Hot Springs',
                    status: 'active',
                    addedBy: 1,
                    createdAt: new Date().toISOString()
                }
            ];
            
            // Sample products
            const products = [
                {
                    id: 1,
                    title: 'Fresh Kapenta - 20kg',
                    description: 'Freshly caught kapenta from Lake Kariba. Good for business or family consumption.',
                    category: 'fish',
                    price: 80,
                    location: 'Siachilaba',
                    sellerId: 2,
                    sellerName: 'John Fishing',
                    sellerPhone: '263773456789',
                    whatsappLink: 'https://wa.me/263773456789?text=Hi! I saw your Fresh Kapenta - 20kg on Binga Marketplace',
                    status: 'active',
                    approved: true,
                    featured: true,
                    views: 45,
                    createdAt: new Date().toISOString()
                },
                {
                    id: 2,
                    title: 'Local Goats - 3 Available',
                    description: 'Healthy local goats, 6-8 months old. Perfect for ceremonies or breeding.',
                    category: 'goat',
                    price: 60,
                    location: 'Kariyangwe',
                    sellerId: 3,
                    sellerName: 'Mary Livestock',
                    sellerPhone: '263774567890',
                    whatsappLink: 'https://wa.me/263774567890?text=Hi! I saw your Local Goats - 3 Available on Binga Marketplace',
                    status: 'active',
                    approved: true,
                    featured: true,
                    views: 32,
                    createdAt: new Date().toISOString()
                }
            ];
            
            // Add users
            users.forEach(user => {
                transaction.objectStore('users').add(user);
            });
            
            // Add categories
            categories.forEach(category => {
                transaction.objectStore('categories').add(category);
            });
            
            // Add locations
            locations.forEach(location => {
                transaction.objectStore('locations').add(location);
            });
            
            // Add attraction types
            attractionTypes.forEach(type => {
                transaction.objectStore('attractionTypes').add(type);
            });
            
            // Add attractions
            attractions.forEach(attraction => {
                transaction.objectStore('attractions').add(attraction);
            });
            
            // Add products
            products.forEach(product => {
                transaction.objectStore('products').add(product);
            });
            
            await transaction.complete;
            console.log('Sample data added to IndexedDB');
        }
        
        // Database operations
        const BINGA_MARKETPLACE_DB = {
            // User operations
            users: {
                async getAll() {
                    const transaction = db.transaction(['users'], 'readonly');
                    const store = transaction.objectStore('users');
                    return new Promise((resolve, reject) => {
                        const request = store.getAll();
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async get(id) {
                    const transaction = db.transaction(['users'], 'readonly');
                    const store = transaction.objectStore('users');
                    return new Promise((resolve, reject) => {
                        const request = store.get(id);
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async add(user) {
                    const transaction = db.transaction(['users'], 'readwrite');
                    const store = transaction.objectStore('users');
                    return new Promise((resolve, reject) => {
                        const request = store.add(user);
                        request.onsuccess = () => resolve(user);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async update(id, updates) {
                    const user = await this.get(id);
                    if (user) {
                        const updatedUser = {...user, ...updates};
                        const transaction = db.transaction(['users'], 'readwrite');
                        const store = transaction.objectStore('users');
                        return new Promise((resolve, reject) => {
                            const request = store.put(updatedUser);
                            request.onsuccess = () => resolve(updatedUser);
                            request.onerror = () => reject(request.error);
                        });
                    }
                    return null;
                },
                
                async delete(id) {
                    const transaction = db.transaction(['users'], 'readwrite');
                    const store = transaction.objectStore('users');
                    return new Promise((resolve, reject) => {
                        const request = store.delete(id);
                        request.onsuccess = () => resolve(true);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async findByUsername(username) {
                    const transaction = db.transaction(['users'], 'readonly');
                    const store = transaction.objectStore('users');
                    const index = store.index('username');
                    return new Promise((resolve, reject) => {
                        const request = index.get(username);
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async getSellers() {
                    const users = await this.getAll();
                    return users.filter(u => u.type === 'seller');
                },
                
                async getAdmins() {
                    const users = await this.getAll();
                    return users.filter(u => u.type === 'admin');
                }
            },
            
            // Product operations
            products: {
                async getAll() {
                    const transaction = db.transaction(['products'], 'readonly');
                    const store = transaction.objectStore('products');
                    return new Promise((resolve, reject) => {
                        const request = store.getAll();
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async get(id) {
                    const transaction = db.transaction(['products'], 'readonly');
                    const store = transaction.objectStore('products');
                    return new Promise((resolve, reject) => {
                        const request = store.get(id);
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async add(product) {
                    const transaction = db.transaction(['products'], 'readwrite');
                    const store = transaction.objectStore('products');
                    return new Promise((resolve, reject) => {
                        const request = store.add(product);
                        request.onsuccess = () => resolve(product);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async update(id, updates) {
                    const product = await this.get(id);
                    if (product) {
                        const updatedProduct = {...product, ...updates};
                        const transaction = db.transaction(['products'], 'readwrite');
                        const store = transaction.objectStore('products');
                        return new Promise((resolve, reject) => {
                            const request = store.put(updatedProduct);
                            request.onsuccess = () => resolve(updatedProduct);
                            request.onerror = () => reject(request.error);
                        });
                    }
                    return null;
                },
                
                async delete(id) {
                    // First, delete associated media
                    await BINGA_MARKETPLACE_DB.media.deleteByEntity(id, 'product');
                    
                    // Then delete the product
                    const transaction = db.transaction(['products'], 'readwrite');
                    const store = transaction.objectStore('products');
                    return new Promise((resolve, reject) => {
                        const request = store.delete(id);
                        request.onsuccess = () => resolve(true);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async getActive(limit = null, offset = 0) {
                    const products = await this.getAll();
                    const activeProducts = products.filter(p => p.status === 'active' && p.approved);
                    
                    if (limit) {
                        return activeProducts.slice(offset, offset + limit);
                    }
                    return activeProducts;
                },
                
                async getPending() {
                    const products = await this.getAll();
                    return products.filter(p => !p.approved || p.status === 'pending');
                },
                
                async getByCategory(category, limit = null, offset = 0) {
                    const products = await this.getAll();
                    const filtered = products.filter(p => p.category === category && p.status === 'active' && p.approved);
                    
                    if (limit) {
                        return filtered.slice(offset, offset + limit);
                    }
                    return filtered;
                },
                
                async getBySeller(sellerId) {
                    const products = await this.getAll();
                    return products.filter(p => p.sellerId === sellerId);
                },
                
                async count() {
                    const products = await this.getAll();
                    return products.length;
                },
                
                async countActive() {
                    const products = await this.getAll();
                    return products.filter(p => p.status === 'active' && p.approved).length;
                },
                
                async search(query, category = null, location = null, limit = 20, offset = 0) {
                    const products = await this.getAll();
                    let filtered = products.filter(p => p.status === 'active' && p.approved);
                    
                    if (query) {
                        const q = query.toLowerCase();
                        filtered = filtered.filter(p => 
                            p.title.toLowerCase().includes(q) || 
                            p.description.toLowerCase().includes(q)
                        );
                    }
                    
                    if (category) {
                        filtered = filtered.filter(p => p.category === category);
                    }
                    
                    if (location) {
                        filtered = filtered.filter(p => p.location === location);
                    }
                    
                    return filtered.slice(offset, offset + limit);
                }
            },
            
            // Tourist Attraction operations
            attractions: {
                async getAll() {
                    const transaction = db.transaction(['attractions'], 'readonly');
                    const store = transaction.objectStore('attractions');
                    return new Promise((resolve, reject) => {
                        const request = store.getAll();
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async get(id) {
                    const transaction = db.transaction(['attractions'], 'readonly');
                    const store = transaction.objectStore('attractions');
                    return new Promise((resolve, reject) => {
                        const request = store.get(id);
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async add(attraction) {
                    const transaction = db.transaction(['attractions'], 'readwrite');
                    const store = transaction.objectStore('attractions');
                    return new Promise((resolve, reject) => {
                        const request = store.add(attraction);
                        request.onsuccess = () => resolve(attraction);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async update(id, updates) {
                    const attraction = await this.get(id);
                    if (attraction) {
                        const updatedAttraction = {...attraction, ...updates};
                        const transaction = db.transaction(['attractions'], 'readwrite');
                        const store = transaction.objectStore('attractions');
                        return new Promise((resolve, reject) => {
                            const request = store.put(updatedAttraction);
                            request.onsuccess = () => resolve(updatedAttraction);
                            request.onerror = () => reject(request.error);
                        });
                    }
                    return null;
                },
                
                async delete(id) {
                    // Delete associated media
                    await BINGA_MARKETPLACE_DB.media.deleteByEntity(id, 'attraction');
                    
                    // Delete attraction
                    const transaction = db.transaction(['attractions'], 'readwrite');
                    const store = transaction.objectStore('attractions');
                    return new Promise((resolve, reject) => {
                        const request = store.delete(id);
                        request.onsuccess = () => resolve(true);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async getActive(limit = null, offset = 0) {
                    const attractions = await this.getAll();
                    const active = attractions.filter(a => a.status === 'active');
                    
                    if (limit) {
                        return active.slice(offset, offset + limit);
                    }
                    return active;
                },
                
                async count() {
                    const attractions = await this.getAll();
                    return attractions.length;
                }
            },
            
            // Media operations
            media: {
                async getAll() {
                    const transaction = db.transaction(['media'], 'readonly');
                    const store = transaction.objectStore('media');
                    return new Promise((resolve, reject) => {
                        const request = store.getAll();
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async get(id) {
                    const transaction = db.transaction(['media'], 'readonly');
                    const store = transaction.objectStore('media');
                    return new Promise((resolve, reject) => {
                        const request = store.get(id);
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async add(mediaItem) {
                    const transaction = db.transaction(['media'], 'readwrite');
                    const store = transaction.objectStore('media');
                    return new Promise((resolve, reject) => {
                        const request = store.add(mediaItem);
                        request.onsuccess = () => resolve(mediaItem);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async update(id, updates) {
                    const mediaItem = await this.get(id);
                    if (mediaItem) {
                        const updatedMedia = {...mediaItem, ...updates};
                        const transaction = db.transaction(['media'], 'readwrite');
                        const store = transaction.objectStore('media');
                        return new Promise((resolve, reject) => {
                            const request = store.put(updatedMedia);
                            request.onsuccess = () => resolve(updatedMedia);
                            request.onerror = () => reject(request.error);
                        });
                    }
                    return null;
                },
                
                async delete(id) {
                    const transaction = db.transaction(['media'], 'readwrite');
                    const store = transaction.objectStore('media');
                    return new Promise((resolve, reject) => {
                        const request = store.delete(id);
                        request.onsuccess = () => resolve(true);
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async getByEntity(entityId, entityType, limit = null, offset = 0) {
                    const transaction = db.transaction(['media'], 'readonly');
                    const store = transaction.objectStore('media');
                    const index = store.index('entityId');
                    
                    return new Promise((resolve, reject) => {
                        const request = index.getAll(entityId);
                        request.onsuccess = () => {
                            let media = request.result.filter(m => m.entityType === entityType);
                            media.sort((a, b) => new Date(b.uploadedAt) - new Date(a.uploadedAt));
                            
                            if (limit) {
                                media = media.slice(offset, offset + limit);
                            }
                            resolve(media);
                        };
                        request.onerror = () => reject(request.error);
                    });
                },
                
                async deleteByEntity(entityId, entityType) {
                    const mediaItems = await this.getByEntity(entityId, entityType);
                    const transaction = db.transaction(['media'], 'readwrite');
                    const store = transaction.objectStore('media');
                    
                    return Promise.all(
                        mediaItems.map(item => 
                            new Promise((resolve, reject) => {
                                const request = store.delete(item.id);
                                request.onsuccess = () => resolve(true);
                                request.onerror = () => reject(request.error);
                            })
                        )
                    );
                },
                
                async count() {
                    const media = await this.getAll();
                    return media.length;
                },
                
                async countByEntity(entityId, entityType) {
                    const media = await this.getByEntity(entityId, entityType);
                    return media.length;
                },
                
                async getStorageStats() {
                    const media = await this.getAll();
                    let totalSize = 0;
                    
                    media.forEach(item => {
                        totalSize += item.size || 0;
                    });
                    
                    return {
                        count: media.length,
                        totalSize: totalSize,
                        formattedSize: formatBytes(totalSize)
                    };
                }
            },
            
            // Categories operations
            categories: {
                async getAll() {
                    const transaction = db.transaction(['categories'], 'readonly');
                    const store = transaction.objectStore('categories');
                    return new Promise((resolve, reject) => {
                        const request = store.getAll();
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                }
            },
            
            // Locations operations
            locations: {
                async getAll() {
                    const transaction = db.transaction(['locations'], 'readonly');
                    const store = transaction.objectStore('locations');
                    return new Promise((resolve, reject) => {
                        const request = store.getAll();
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                }
            },
            
            // Attraction Types operations
            attractionTypes: {
                async getAll() {
                    const transaction = db.transaction(['attractionTypes'], 'readonly');
                    const store = transaction.objectStore('attractionTypes');
                    return new Promise((resolve, reject) => {
                        const request = store.getAll();
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                }
            }
        };
        
        // Utility function to format bytes
        function formatBytes(bytes, decimals = 2) {
            if (bytes === 0) return '0 Bytes';
            
            const k = 1024;
            const dm = decimals < 0 ? 0 : decimals;
            const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
            
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            
            return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
        }
        
        // Initialize the application
        async function initApp() {
            try {
                // Initialize IndexedDB
                await initDB();
                
                // Check if user is already logged in
                const savedUser = localStorage.getItem('binga_current_user');
                if (savedUser) {
                    try {
                        currentUser = JSON.parse(savedUser);
                        // Verify user still exists in database
                        const userExists = await BINGA_MARKETPLACE_DB.users.get(currentUser.id);
                        if (userExists) {
                            currentUser = userExists;
                            localStorage.setItem('binga_current_user', JSON.stringify(currentUser));
                            updateAuthUI();
                        } else {
                            localStorage.removeItem('binga_current_user');
                            currentUser = null;
                            showAuthButtons();
                        }
                    } catch (e) {
                        localStorage.removeItem('binga_current_user');
                        currentUser = null;
                        showAuthButtons();
                    }
                } else {
                    showAuthButtons();
                }
                
                // Load initial data
                await loadInitialData();
                
                // Update storage stats
                await updateStorageStats();
                
                console.log('Application initialized successfully');
            } catch (error) {
                console.error('Error initializing app:', error);
                showAlert('Error initializing application. Please refresh the page.', 'error');
            }
        }
        
        // Load initial data
        async function loadInitialData() {
            await loadMarketplace(1, 12);
            await loadTouristAttractions(1, 6);
            await loadCategories();
            await loadLocations();
            setActiveNav('home');
        }
        
        // Update storage statistics
        async function updateStorageStats() {
            try {
                const stats = await BINGA_MARKETPLACE_DB.media.getStorageStats();
                const usedMB = (stats.totalSize / (1024 * 1024)).toFixed(2);
                const totalMB = 5000; // 5GB limit for IndexedDB
                const percentage = Math.min((usedMB / totalMB) * 100, 100);
                
                document.getElementById('storageUsed').textContent = `${usedMB} MB`;
                document.getElementById('storageTotal').textContent = `${totalMB} MB`;
                document.getElementById('storageBar').style.width = `${percentage}%`;
            } catch (error) {
                console.error('Error updating storage stats:', error);
            }
        }
        
        // Show auth buttons (only in top-right corner)
        function showAuthButtons() {
            document.getElementById('authButtons').innerHTML = `
                <button class="auth-btn login" onclick="openAuthModal('login', 'seller')">Seller Login</button>
                <button class="auth-btn register" onclick="openAuthModal('register')">Register as Seller</button>
            `;
            document.getElementById('userMenu').style.display = 'none';
            document.getElementById('authButtons').style.display = 'flex';
        }
        
        // Update auth UI after login
        function updateAuthUI() {
            if (currentUser) {
                document.getElementById('authButtons').style.display = 'none';
                document.getElementById('userMenu').style.display = 'flex';
                
                document.getElementById('userName').textContent = currentUser.name;
                document.getElementById('userAvatar').textContent = 
                    currentUser.name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
                
                if (document.getElementById('dashboardSection').style.display !== 'none') {
                    loadUserDashboard();
                }
            } else {
                showAuthButtons();
            }
        }
        
        // Open auth modal
        function openAuthModal(form = 'login', type = 'seller') {
            loginType = type;
            const modal = document.getElementById('authModal');
            modal.style.display = 'flex';
            showAuthForm(form);
            setLoginType(type);
        }
        
        // Close auth modal
        function closeAuthModal() {
            document.getElementById('authModal').style.display = 'none';
        }
        
        // Show login or register form
        function showAuthForm(form) {
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            const tabs = document.querySelectorAll('.auth-tab');
            
            if (form === 'login') {
                loginForm.style.display = 'block';
                registerForm.style.display = 'none';
                tabs[0].classList.add('active');
                tabs[1].classList.remove('active');
                document.getElementById('loginTypeSelector').style.display = 'block';
            } else {
                loginForm.style.display = 'none';
                registerForm.style.display = 'block';
                tabs[0].classList.remove('active');
                tabs[1].classList.add('active');
                document.getElementById('loginTypeSelector').style.display = 'none';
            }
        }
        
        // Set login type
        function setLoginType(type) {
            loginType = type;
            const buttons = document.querySelectorAll('.auth-type-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            
            if (type === 'seller') {
                buttons[0].classList.add('active');
                document.getElementById('loginTitle').textContent = 'Login to Seller Account';
                document.getElementById('loginLabel').textContent = 'Username';
                document.getElementById('loginEmail').placeholder = 'Enter your username';
            } else {
                buttons[1].classList.add('active');
                document.getElementById('loginTitle').textContent = 'Admin Login';
                document.getElementById('loginLabel').textContent = 'Admin Username';
                document.getElementById('loginEmail').placeholder = 'Enter admin username';
            }
        }
        
        // Login function
        async function login() {
            const username = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            if (!username || !password) {
                alert('Please enter username and password');
                return;
            }
            
            try {
                const users = await BINGA_MARKETPLACE_DB.users.getAll();
                let user = null;
                
                if (loginType === 'admin') {
                    // UPDATED: Admin login with new credentials
                    user = users.find(u => 
                        u.username === username && 
                        u.password === password &&
                        u.type === 'admin'
                    );
                    
                    if (!user) {
                        // Try with the old admin credentials as fallback
                        if (username === 'admin' && password === 'admin123') {
                            user = users.find(u => u.username === 'admin' && u.type === 'admin');
                        }
                    }
                } else {
                    user = users.find(u => 
                        u.username === username && 
                        u.password === password &&
                        u.type === 'seller'
                    );
                    
                    if (user && !user.approved) {
                        alert('Your seller account is pending approval. Contact administrator at +263 77 286 3815');
                        return;
                    }
                }
                
                if (user) {
                    currentUser = user;
                    localStorage.setItem('binga_current_user', JSON.stringify(user));
                    updateAuthUI();
                    closeAuthModal();
                    
                    document.getElementById('loginEmail').value = '';
                    document.getElementById('loginPassword').value = '';
                    
                    showAlert(`Login successful! Welcome ${user.name}`, 'success');
                    
                    if (user.type === 'seller' && user.justRegistered) {
                        setTimeout(() => {
                            showPostAdForm();
                            BINGA_MARKETPLACE_DB.users.update(user.id, { justRegistered: false });
                        }, 1000);
                    }
                    else if (user.type === 'admin') {
                        setTimeout(() => showSection('admin'), 500);
                    } else {
                        setTimeout(() => showSection('dashboard'), 500);
                    }
                } else {
                    if (loginType === 'admin') {
                        alert('Invalid admin credentials. Username: Munkuli#1996, Password: Wiseman');
                    } else {
                        alert('Invalid credentials. Please check your username and password.');
                    }
                }
            } catch (error) {
                console.error('Login error:', error);
                alert('Error during login. Please try again.');
            }
        }
        
        // Register function
        async function register() {
            const name = document.getElementById('registerName').value.trim();
            const phone = document.getElementById('registerPhone').value.replace(/\D/g, '');
            const username = document.getElementById('registerUsername').value.trim();
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            const location = document.getElementById('registerLocation').value;
            
            if (!name || !phone || !username || !password || !confirmPassword || !location) {
                alert('Please fill all required fields');
                return;
            }
            
            if (password !== confirmPassword) {
                alert('Passwords do not match');
                return;
            }
            
            if (phone.length < 9) {
                alert('Please enter a valid phone number');
                return;
            }
            
            try {
                const users = await BINGA_MARKETPLACE_DB.users.getAll();
                
                if (users.find(u => u.username === username)) {
                    alert('Username already taken. Please choose another one.');
                    return;
                }
                
                if (users.find(u => u.phone === phone)) {
                    alert('Phone number already registered');
                    return;
                }
                
                const newUser = {
                    id: Date.now(),
                    username: username,
                    password: password,
                    name: name,
                    phone: phone,
                    email: '',
                    location: location,
                    type: 'seller',
                    justRegistered: true,
                    registered: new Date().toISOString(),
                    products: [],
                    rating: 0,
                    approved: true, // Auto-approve for demo
                    status: 'active'
                };
                
                await BINGA_MARKETPLACE_DB.users.add(newUser);
                
                showAlert('Registration successful! You can now login with your username and password.', 'success');
                
                document.getElementById('registerName').value = '';
                document.getElementById('registerPhone').value = '';
                document.getElementById('registerUsername').value = '';
                document.getElementById('registerPassword').value = '';
                document.getElementById('registerConfirmPassword').value = '';
                document.getElementById('registerLocation').value = '';
                
                showAuthForm('login');
                setLoginType('seller');
                document.getElementById('loginEmail').value = username;
            } catch (error) {
                console.error('Registration error:', error);
                alert('Error during registration. Please try again.');
            }
        }
        
        // Logout function
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                currentUser = null;
                localStorage.removeItem('binga_current_user');
                showAuthButtons();
                showSection('home');
                showAlert('Logged out successfully', 'success');
            }
        }
        
        // Load marketplace products with pagination
        async function loadMarketplace(page = 1, limit = 12) {
            try {
                const offset = (page - 1) * limit;
                const products = await BINGA_MARKETPLACE_DB.products.getActive(limit, offset);
                const totalProducts = await BINGA_MARKETPLACE_DB.products.countActive();
                const totalPages = Math.ceil(totalProducts / limit);
                
                const featuredContainer = document.getElementById('featuredProducts');
                const message = document.getElementById('marketplaceMessage');
                const recentContainer = document.getElementById('recentProducts');
                const recentMessage = document.getElementById('recentProductsMessage');
                const recentProducts = await BINGA_MARKETPLACE_DB.products.getActive(limit, 0);
                
                if (products.length === 0) {
                    message.style.display = 'block';
                    featuredContainer.style.display = 'none';
                    recentMessage.style.display = 'block';
                    recentContainer.style.display = 'none';
                    document.getElementById('featuredPagination').style.display = 'none';
                    document.getElementById('recentPagination').style.display = 'none';
                    return;
                }
                
                message.style.display = 'none';
                recentMessage.style.display = 'none';
                
                // Display featured products
                featuredContainer.style.display = 'grid';
                featuredContainer.innerHTML = await Promise.all(
                    products.map(product => renderProductCard(product))
                );
                
                // Display recent products
                recentContainer.style.display = 'grid';
                recentContainer.innerHTML = await Promise.all(
                    recentProducts.map(product => renderProductCard(product))
                );
                
                // Add pagination if needed
                if (totalPages > 1) {
                    renderPagination('featuredPagination', page, totalPages, loadMarketplace);
                    document.getElementById('featuredPagination').style.display = 'flex';
                } else {
                    document.getElementById('featuredPagination').style.display = 'none';
                }
                
                // Add pagination for recent products if needed
                if (totalProducts > limit) {
                    renderPagination('recentPagination', 1, Math.ceil(totalProducts / limit), (page) => {
                        loadRecentProducts(page, limit);
                    });
                    document.getElementById('recentPagination').style.display = 'flex';
                } else {
                    document.getElementById('recentPagination').style.display = 'none';
                }
            } catch (error) {
                console.error('Error loading marketplace:', error);
            }
        }
        
        // Load recent products with pagination
        async function loadRecentProducts(page = 1, limit = 12) {
            try {
                const offset = (page - 1) * limit;
                const products = await BINGA_MARKETPLACE_DB.products.getActive(limit, offset);
                const recentContainer = document.getElementById('recentProducts');
                
                if (products.length > 0) {
                    recentContainer.innerHTML = await Promise.all(
                        products.map(product => renderProductCard(product))
                    );
                }
            } catch (error) {
                console.error('Error loading recent products:', error);
            }
        }
        
        // Load tourist attractions with pagination (NOW AT BOTTOM)
        async function loadTouristAttractions(page = 1, limit = 6) {
            try {
                const offset = (page - 1) * limit;
                const attractions = await BINGA_MARKETPLACE_DB.attractions.getActive(limit, offset);
                const totalAttractions = await BINGA_MARKETPLACE_DB.attractions.count();
                const totalPages = Math.ceil(totalAttractions / limit);
                
                const container = document.getElementById('touristAttractions');
                const message = document.getElementById('noAttractionsMessage');
                
                if (attractions.length === 0) {
                    container.style.display = 'none';
                    message.style.display = 'block';
                    document.getElementById('touristPagination').style.display = 'none';
                    return;
                }
                
                container.style.display = 'grid';
                message.style.display = 'none';
                container.innerHTML = await Promise.all(
                    attractions.map(attraction => renderAttractionCard(attraction))
                );
                
                // Add pagination if needed
                if (totalPages > 1) {
                    renderPagination('touristPagination', page, totalPages, loadTouristAttractions);
                    document.getElementById('touristPagination').style.display = 'flex';
                } else {
                    document.getElementById('touristPagination').style.display = 'none';
                }
            } catch (error) {
                console.error('Error loading tourist attractions:', error);
            }
        }
        
        // Render product card
        async function renderProductCard(product) {
            const categoryIcons = {
                'fish': 'üêü',
                'goat': 'üêê',
                'cow': 'üêÑ',
                'poultry': 'üêì',
                'agriculture': 'üåæ',
                'tourism': 'üèûÔ∏è',
                'services': 'üîß',
                'property': 'üè†',
                'vehicles': 'üöó'
            };
            
            const icon = categoryIcons[product.category] || 'üì¶';
            
            // Get media for this product
            const media = await BINGA_MARKETPLACE_DB.media.getByEntity(product.id, 'product', 1, 0);
            const hasMedia = media && media.length > 0;
            const mediaCount = await BINGA_MARKETPLACE_DB.media.countByEntity(product.id, 'product');
            
            let mediaElement = `<div style="font-size: 48px;">${icon}</div>`;
            
            if (hasMedia) {
                const firstMedia = media[0];
                if (firstMedia.mediaType === 'image') {
                    mediaElement = `<img src="${firstMedia.dataUrl}" alt="${product.title}" onclick="openMediaGallery(${product.id}, 'product')">`;
                } else if (firstMedia.mediaType === 'video') {
                    mediaElement = `
                        <video onclick="openMediaGallery(${product.id}, 'product')">
                            <source src="${firstMedia.dataUrl}" type="${firstMedia.mimeType}">
                        </video>
                        <div class="file-type-badge">VIDEO</div>
                    `;
                }
            }
            
            return `
                <div class="product-card">
                    <div class="product-image">
                        ${mediaElement}
                        <div class="product-price">$${product.price}</div>
                        ${mediaCount > 0 ? 
                            `<div style="position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.7); color: white; padding: 3px 8px; border-radius: 10px; font-size: 12px;">
                                <i class="fas fa-camera"></i> ${mediaCount}
                            </div>` : ''
                        }
                    </div>
                    <div class="product-details">
                        <h3 class="product-title">
                            ${product.title}
                            ${product.approved ? '<span class="verified-badge">‚úì Approved</span>' : ''}
                        </h3>
                        <p class="product-meta">${product.description.substring(0, 60)}...</p>
                        <div class="product-location">
                            <i class="fas fa-map-marker-alt"></i> ${product.location}
                        </div>
                        <a href="${product.whatsappLink}" target="_blank" class="whatsapp-btn">
                            <i class="fab fa-whatsapp"></i> Contact Seller
                        </a>
                    </div>
                </div>
            `;
        }
        
        // Render tourist attraction card
        async function renderAttractionCard(attraction) {
            const attractionIcons = {
                'beach': 'üèñÔ∏è',
                'hotspring': '‚ô®Ô∏è',
                'lake': 'üåä',
                'cultural': 'üèõÔ∏è',
                'wildlife': 'üêò',
                'accommodation': 'üè®',
                'tour': 'üö£'
            };
            
            const icon = attractionIcons[attraction.type] || 'üèûÔ∏è';
            
            // Get media for this attraction
            const media = await BINGA_MARKETPLACE_DB.media.getByEntity(attraction.id, 'attraction', 1, 0);
            const hasMedia = media && media.length > 0;
            const mediaCount = await BINGA_MARKETPLACE_DB.media.countByEntity(attraction.id, 'attraction');
            
            let mediaElement = `<div style="font-size: 48px;">${icon}</div>`;
            
            if (hasMedia) {
                const firstMedia = media[0];
                if (firstMedia.mediaType === 'image') {
                    mediaElement = `<img src="${firstMedia.dataUrl}" alt="${attraction.name}" onclick="openMediaGallery(${attraction.id}, 'attraction')">`;
                } else if (firstMedia.mediaType === 'video') {
                    mediaElement = `
                        <video onclick="openMediaGallery(${attraction.id}, 'attraction')">
                            <source src="${firstMedia.dataUrl}" type="${firstMedia.mimeType}">
                        </video>
                        <div class="file-type-badge">VIDEO</div>
                    `;
                }
            }
            
            return `
                <div class="attraction-card">
                    <div class="attraction-image">
                        ${mediaElement}
                        <div class="attraction-type">${attraction.typeName || attraction.type}</div>
                        ${mediaCount > 0 ? 
                            `<div style="position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.7); color: white; padding: 3px 8px; border-radius: 10px; font-size: 12px;">
                                <i class="fas fa-camera"></i> ${mediaCount}
                            </div>` : ''
                        }
                    </div>
                    <div class="product-details">
                        <h3 class="product-title">
                            ${attraction.name}
                            <span class="verified-badge" style="background: var(--tourist);">üèûÔ∏è Tourist</span>
                        </h3>
                        <p class="product-meta">${attraction.description.substring(0, 80)}...</p>
                        <div class="product-location">
                            <i class="fas fa-map-marker-alt"></i> ${attraction.location}
                        </div>
                        <div style="margin-top: 10px;">
                            <a href="${attraction.whatsappLink}" target="_blank" class="whatsapp-btn" style="background: var(--tourist);">
                                <i class="fab fa-whatsapp"></i> Book on WhatsApp
                            </a>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Open media gallery
        async function openMediaGallery(entityId, entityType) {
            currentMediaItems = await BINGA_MARKETPLACE_DB.media.getByEntity(entityId, entityType);
            
            if (currentMediaItems.length === 0) return;
            
            currentMediaIndex = 0;
            const modal = document.getElementById('mediaModal');
            const slider = document.getElementById('mediaSlider');
            const thumbnails = document.getElementById('mediaThumbnails');
            
            // Clear existing content
            slider.innerHTML = '';
            thumbnails.innerHTML = '';
            
            // Create media slides
            currentMediaItems.forEach((media, index) => {
                const slide = document.createElement('div');
                slide.className = `media-slide ${index === 0 ? 'active' : ''}`;
                
                if (media.mediaType === 'image') {
                    slide.innerHTML = `<img src="${media.dataUrl}" alt="Media ${index + 1}">`;
                } else if (media.mediaType === 'video') {
                    slide.innerHTML = `
                        <video controls autoplay>
                            <source src="${media.dataUrl}" type="${media.mimeType}">
                        </video>
                    `;
                }
                
                slider.appendChild(slide);
                
                // Create thumbnail
                const thumb = document.createElement('div');
                thumb.className = `media-thumb ${index === 0 ? 'active' : ''}`;
                thumb.onclick = () => showMedia(index);
                
                if (media.mediaType === 'image') {
                    thumb.innerHTML = `<img src="${media.dataUrl}" alt="Thumbnail ${index + 1}">`;
                } else if (media.mediaType === 'video') {
                    thumb.innerHTML = `
                        <video>
                            <source src="${media.dataUrl}" type="${media.mimeType}">
                        </video>
                        <div style="position: absolute; bottom: 5px; right: 5px; background: rgba(0,0,0,0.7); color: white; padding: 2px 5px; border-radius: 3px; font-size: 10px;">
                            <i class="fas fa-play"></i>
                        </div>
                    `;
                }
                
                thumbnails.appendChild(thumb);
            });
            
            // Update counter
            updateMediaCounter();
            
            // Show modal
            modal.style.display = 'flex';
        }
        
        // Show specific media in gallery
        function showMedia(index) {
            const slides = document.querySelectorAll('.media-slide');
            const thumbs = document.querySelectorAll('.media-thumb');
            
            slides.forEach(slide => slide.classList.remove('active'));
            thumbs.forEach(thumb => thumb.classList.remove('active'));
            
            slides[index].classList.add('active');
            thumbs[index].classList.add('active');
            currentMediaIndex = index;
            
            updateMediaCounter();
        }
        
        // Next media in gallery
        function nextMedia() {
            if (currentMediaItems.length === 0) return;
            
            currentMediaIndex = (currentMediaIndex + 1) % currentMediaItems.length;
            showMedia(currentMediaIndex);
        }
        
        // Previous media in gallery
        function prevMedia() {
            if (currentMediaItems.length === 0) return;
            
            currentMediaIndex = (currentMediaIndex - 1 + currentMediaItems.length) % currentMediaItems.length;
            showMedia(currentMediaIndex);
        }
        
        // Update media counter
        function updateMediaCounter() {
            document.getElementById('mediaCounter').textContent = 
                `${currentMediaIndex + 1} / ${currentMediaItems.length}`;
        }
        
        // Close media gallery
        function closeMediaModal() {
            document.getElementById('mediaModal').style.display = 'none';
            currentMediaItems = [];
            currentMediaIndex = 0;
        }
        
        // Load categories with counts
        async function loadCategories() {
            try {
                const categories = await BINGA_MARKETPLACE_DB.categories.getAll();
                const activeProducts = await BINGA_MARKETPLACE_DB.products.getActive();
                
                const container = document.getElementById('categoryList');
                container.innerHTML = categories.map(cat => {
                    const count = activeProducts.filter(p => p.category === cat.id).length;
                    return `
                        <li class="category-item">
                            <a href="#" onclick="showCategory('${cat.id}')">
                                ${cat.icon} ${cat.name}
                                <span class="category-count">${count}</span>
                            </a>
                        </li>
                    `;
                }).join('');
            } catch (error) {
                console.error('Error loading categories:', error);
            }
        }
        
        // Load locations with counts
        async function loadLocations() {
            try {
                const locations = await BINGA_MARKETPLACE_DB.locations.getAll();
                const activeProducts = await BINGA_MARKETPLACE_DB.products.getActive();
                
                const container = document.getElementById('locationList');
                container.innerHTML = locations.map(loc => {
                    const count = activeProducts.filter(p => p.location === loc.id).length;
                    return `
                        <li class="location-item">
                            <a href="#" onclick="showLocation('${loc.id}')">
                                ${loc.name}
                                <span class="location-count">${count}</span>
                            </a>
                        </li>
                    `;
                }).join('');
            } catch (error) {
                console.error('Error loading locations:', error);
            }
        }
        
        // Show section
        function showSection(section) {
            // Hide all sections
            document.getElementById('homeSection').style.display = 'none';
            document.getElementById('tourismSection').style.display = 'none';
            document.getElementById('dashboardSection').style.display = 'none';
            document.getElementById('adminSection').style.display = 'none';
            document.getElementById('postAdSection').style.display = 'none';
            document.getElementById('addAttractionSection').style.display = 'none';
            document.getElementById('editAttractionSection').style.display = 'none';
            
            // Show selected section
            if (section === 'home') {
                document.getElementById('homeSection').style.display = 'block';
                loadMarketplace(1, 12);
                loadTouristAttractions(1, 6);
            } else if (section === 'tourism') {
                document.getElementById('tourismSection').style.display = 'block';
                loadTourismContent();
            } else if (section === 'dashboard') {
                if (!currentUser || currentUser.type !== 'seller') {
                    openAuthModal('login', 'seller');
                    return;
                }
                document.getElementById('dashboardSection').style.display = 'block';
                loadUserDashboard();
            } else if (section === 'admin') {
                if (!currentUser || currentUser.type !== 'admin') {
                    openAuthModal('login', 'admin');
                    return;
                }
                document.getElementById('adminSection').style.display = 'block';
                showAdminTab('pending');
            } else {
                document.getElementById('homeSection').style.display = 'block';
                filterProductsByCategory(section);
            }
            
            setActiveNav(section);
        }
        
        // Set active navigation
        function setActiveNav(section) {
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            const navLinks = document.querySelectorAll('.nav-link');
            for (let link of navLinks) {
                if (link.textContent.toLowerCase().includes(section.toLowerCase()) || 
                    (section === 'home' && link.classList.contains('active'))) {
                    link.classList.add('active');
                    break;
                }
            }
            
            if (section === 'tourism') {
                document.querySelector('.nav-link.tourist').classList.add('active');
            }
        }
        
        // Filter products by category
        async function filterProductsByCategory(category) {
            try {
                const products = await BINGA_MARKETPLACE_DB.products.getByCategory(category, 50, 0);
                const container = document.getElementById('recentProducts');
                const message = document.getElementById('recentProductsMessage');
                
                const categoryNames = {
                    'fish': 'Fish & Seafood',
                    'goat': 'Goats',
                    'cow': 'Cattle',
                    'poultry': 'Poultry',
                    'agriculture': 'Agricultural Products',
                    'tourism': 'Tourism Services',
                    'services': 'Services',
                    'property': 'Property',
                    'vehicles': 'Vehicles'
                };
                
                if (products.length > 0) {
                    message.style.display = 'none';
                    container.style.display = 'grid';
                    container.innerHTML = await Promise.all(
                        products.map(product => renderProductCard(product))
                    );
                    
                    document.querySelector('#homeSection .section-title').innerHTML = `
                        <i class="fas fa-tag"></i> ${categoryNames[category] || category}
                    `;
                } else {
                    container.style.display = 'none';
                    message.style.display = 'block';
                    message.innerHTML = `
                        <div style="font-size: 60px; margin-bottom: 20px;">üè∑Ô∏è</div>
                        <h3>No products in ${categoryNames[category] || category} category</h3>
                        <p>Be the first to post in this category!</p>
                        ${currentUser && currentUser.type === 'seller' ? 
                            `<button class="btn btn-primary" onclick="showPostAdForm()" style="margin-top: 15px;">
                                <i class="fas fa-plus-circle"></i> Post an Ad
                            </button>` : 
                            `<button class="btn btn-primary" onclick="openAuthModal('login', 'seller')" style="margin-top: 15px;">
                                <i class="fas fa-sign-in-alt"></i> Login as Seller
                            </button>`
                        }
                    `;
                }
            } catch (error) {
                console.error('Error filtering products:', error);
            }
        }
        
        // Show category
        function showCategory(categoryId) {
            showSection('home');
            filterProductsByCategory(categoryId);
            setActiveNav(categoryId);
        }
        
        // Show location
        async function showLocation(locationId) {
            try {
                const products = await BINGA_MARKETPLACE_DB.products.search('', null, locationId, 50, 0);
                const container = document.getElementById('recentProducts');
                const message = document.getElementById('recentProductsMessage');
                
                if (products.length > 0) {
                    message.style.display = 'none';
                    container.style.display = 'grid';
                    container.innerHTML = await Promise.all(
                        products.map(product => renderProductCard(product))
                    );
                    
                    document.querySelector('#homeSection .section-title').innerHTML = `
                        <i class="fas fa-map-marker-alt"></i> Products in ${locationId}
                    `;
                } else {
                    container.style.display = 'none';
                    message.style.display = 'block';
                    message.innerHTML = `
                        <div style="font-size: 60px; margin-bottom: 20px;">üìç</div>
                        <h3>No products in ${locationId}</h3>
                        <p>Be the first to post in this location!</p>
                    `;
                }
            } catch (error) {
                console.error('Error showing location:', error);
            }
        }
        
        // Search products
        async function searchProducts() {
            const query = document.getElementById('searchInput').value;
            const category = document.getElementById('categorySelect').value;
            const location = document.getElementById('locationSelect').value;
            
            try {
                const products = await BINGA_MARKETPLACE_DB.products.search(query, category || null, location || null, 50, 0);
                const container = document.getElementById('recentProducts');
                const message = document.getElementById('recentProductsMessage');
                
                if (products.length > 0) {
                    message.style.display = 'none';
                    container.style.display = 'grid';
                    container.innerHTML = await Promise.all(
                        products.map(product => renderProductCard(product))
                    );
                    
                    let title = 'Search Results';
                    if (query || category || location) {
                        title = `${products.length} Product(s) Found`;
                    }
                    document.querySelector('#homeSection .section-title').innerHTML = `
                        <i class="fas fa-search"></i> ${title}
                    `;
                } else {
                    container.style.display = 'none';
                    message.style.display = 'block';
                    message.innerHTML = `
                        <div style="font-size: 60px; margin-bottom: 20px;">üîç</div>
                        <h3>No products found</h3>
                        <p>Try different search terms or filters</p>
                    `;
                }
            } catch (error) {
                console.error('Error searching products:', error);
            }
        }
        
        // Show post ad form
        function showPostAdForm() {
            if (!currentUser || currentUser.type !== 'seller') {
                openAuthModal('login', 'seller');
                return;
            }
            
            uploadedMedia = [];
            
            document.getElementById('homeSection').style.display = 'none';
            document.getElementById('tourismSection').style.display = 'none';
            document.getElementById('dashboardSection').style.display = 'none';
            document.getElementById('adminSection').style.display = 'none';
            document.getElementById('addAttractionSection').style.display = 'none';
            document.getElementById('editAttractionSection').style.display = 'none';
            
            document.getElementById('postAdSection').style.display = 'block';
            
            document.getElementById('postAdForm').innerHTML = `
                <form id="adForm">
                    <div class="form-group">
                        <label class="form-label">Ad Title*</label>
                        <input type="text" class="form-control" id="adTitle" placeholder="e.g., Fresh Kapenta - 20kg">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Category*</label>
                        <select class="form-control" id="adCategory">
                            <option value="">Select Category</option>
                            <option value="fish">Fish & Seafood</option>
                            <option value="goat">Goats</option>
                            <option value="cow">Cattle</option>
                            <option value="poultry">Poultry</option>
                            <option value="agriculture">Agriculture</option>
                            <option value="services">Services</option>
                            <option value="property">Property</option>
                            <option value="vehicles">Vehicles</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Price (USD)*</label>
                        <input type="number" class="form-control" id="adPrice" placeholder="e.g., 80">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Location in Binga*</label>
                        <select class="form-control" id="adLocation">
                            <option value="">Select Location</option>
                            <option>Siachilaba</option>
                            <option>Kariyangwe</option>
                            <option>Binga Centre</option>
                            <option>Chete Island</option>
                            <option>Lake Kariba</option>
                            <option>Other</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Description*</label>
                        <textarea class="form-control" id="adDescription" rows="4" placeholder="Describe your product or service..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Contact Phone*</label>
                        <input type="tel" class="form-control" id="adPhone" value="${currentUser.phone}">
                        <small>Buyers will contact you on this number via WhatsApp</small>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Upload Photos & Videos</label>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 10px;">
                            <p><strong>Tips:</strong></p>
                            <ul style="margin-left: 20px; color: #666;">
                                <li>Upload unlimited photos and videos</li>
                                <li>Take photos in good daylight</li>
                                <li>Show product from different angles</li>
                                <li>Videos help buyers see product details</li>
                                <li>Files are automatically compressed</li>
                            </ul>
                        </div>
                        
                        <div style="margin-top: 15px;">
                            <label for="mediaUpload" class="image-upload-btn">
                                <i class="fas fa-upload"></i> Upload Photos & Videos
                            </label>
                            <input type="file" id="mediaUpload" accept="image/*,video/*" multiple onchange="handleMediaUpload(event)" style="display: none;">
                            
                            <button type="button" class="batch-upload-btn" onclick="document.getElementById('mediaUpload').click()">
                                <i class="fas fa-folder-open"></i> Batch Upload
                            </button>
                            
                            ${navigator.mediaDevices && navigator.mediaDevices.getUserMedia ? 
                                `<button type="button" class="camera-btn" onclick="openCamera()">
                                    <i class="fas fa-camera"></i> Take Photo/Video
                                </button>` : ''
                            }
                        </div>
                        
                        <div class="upload-progress" id="uploadProgress">
                            <div class="upload-progress-bar" id="uploadProgressBar"></div>
                        </div>
                        
                        <div class="image-upload-container" id="mediaPreviewContainer">
                            <!-- Media previews will appear here -->
                        </div>
                        
                        <div id="uploadStatus" style="margin-top: 10px; font-size: 14px; color: #666;"></div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Note to Administrator</label>
                        <textarea class="form-control" id="adNote" rows="2" placeholder="Any special notes for admin review..."></textarea>
                    </div>
                    
                    <button type="button" class="btn btn-primary" onclick="submitAd()" style="margin-top: 20px;">
                        <i class="fas fa-paper-plane"></i> Submit for Approval
                    </button>
                    
                    <button type="button" class="btn" onclick="showSection('dashboard')" style="margin-top: 20px; margin-left: 10px; background: #f0f0f0;">
                        Cancel
                    </button>
                    
                    <p style="margin-top: 20px; color: #666; font-size: 14px;">
                        <i class="fas fa-info-circle"></i> Note: All ads require administrator approval before appearing on marketplace.
                        Contact +263 77 286 3815 for faster approval.
                    </p>
                </form>
            `;
        }
        
        // Handle media upload
        async function handleMediaUpload(event) {
            const files = Array.from(event.target.files);
            if (files.length === 0) return;
            
            isUploading = true;
            const progressBar = document.getElementById('uploadProgress');
            const progressFill = document.getElementById('uploadProgressBar');
            const status = document.getElementById('uploadStatus');
            
            progressBar.style.display = 'block';
            status.textContent = `Processing ${files.length} file(s)...`;
            
            let processedCount = 0;
            
            for (const file of files) {
                await processMediaFile(file);
                processedCount++;
                
                progressFill.style.width = `${(processedCount / files.length) * 100}%`;
                status.textContent = `Processed ${processedCount} of ${files.length} files...`;
            }
            
            setTimeout(() => {
                progressBar.style.display = 'none';
                progressFill.style.width = '0%';
                status.textContent = `Uploaded ${files.length} file(s) successfully!`;
                isUploading = false;
                updateStorageStats();
            }, 500);
        }
        
        // Process media file
        async function processMediaFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                
                reader.onload = async function(e) {
                    try {
                        const isImage = file.type.startsWith('image/');
                        const isVideo = file.type.startsWith('video/');
                        
                        if (!isImage && !isVideo) {
                            alert(`File type ${file.type} not supported. Please upload images or videos only.`);
                            resolve();
                            return;
                        }
                        
                        // Compress image if it's an image
                        let dataUrl = e.target.result;
                        let size = file.size;
                        
                        if (isImage) {
                            dataUrl = await compressImage(dataUrl, file.type);
                            size = Math.floor(dataUrl.length * 0.75); // Approximate size
                        }
                        
                        const mediaItem = {
                            id: Date.now() + Math.random(),
                            entityId: null, // Will be set when product/attraction is created
                            entityType: 'product', // Default, can be changed for attractions
                            mediaType: isImage ? 'image' : 'video',
                            mimeType: file.type,
                            dataUrl: dataUrl,
                            size: size,
                            filename: file.name,
                            uploadedAt: new Date().toISOString(),
                            uploadedBy: currentUser ? currentUser.id : null
                        };
                        
                        uploadedMedia.push(mediaItem);
                        updateMediaPreviews();
                        resolve();
                    } catch (error) {
                        console.error('Error processing media:', error);
                        alert(`Error processing ${file.name}. Please try again.`);
                        resolve();
                    }
                };
                
                reader.onerror = () => {
                    alert(`Error reading ${file.name}. Please try again.`);
                    resolve();
                };
                
                reader.readAsDataURL(file);
            });
        }
        
        // Compress image
        async function compressImage(dataUrl, mimeType, quality = 0.7, maxWidth = 1200) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    let width = img.width;
                    let height = img.height;
                    
                    if (width > maxWidth) {
                        height = (height * maxWidth) / width;
                        width = maxWidth;
                    }
                    
                    canvas.width = width;
                    canvas.height = height;
                    
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    const compressedDataUrl = canvas.toDataURL(mimeType, quality);
                    resolve(compressedDataUrl);
                };
                
                img.onerror = reject;
                img.src = dataUrl;
            });
        }
        
        // Update media previews
        function updateMediaPreviews() {
            const container = document.getElementById('mediaPreviewContainer');
            container.innerHTML = '';
            
            uploadedMedia.forEach((media, index) => {
                const previewDiv = document.createElement('div');
                previewDiv.className = 'image-preview';
                
                if (media.mediaType === 'image') {
                    previewDiv.innerHTML = `<img src="${media.dataUrl}" alt="Preview ${index + 1}">`;
                } else if (media.mediaType === 'video') {
                    previewDiv.innerHTML = `
                        <video>
                            <source src="${media.dataUrl}" type="${media.mimeType}">
                        </video>
                        <div style="position: absolute; bottom: 5px; left: 5px; background: rgba(0,0,0,0.7); color: white; padding: 2px 5px; border-radius: 3px; font-size: 10px;">
                            <i class="fas fa-play"></i> Video
                        </div>
                    `;
                }
                
                const removeBtn = document.createElement('button');
                removeBtn.className = 'remove-image';
                removeBtn.innerHTML = '√ó';
                removeBtn.onclick = function() {
                    uploadedMedia.splice(index, 1);
                    updateMediaPreviews();
                    updateStorageStats();
                };
                
                previewDiv.appendChild(removeBtn);
                container.appendChild(previewDiv);
            });
            
            // Add placeholder for adding more media
            if (uploadedMedia.length < 100) { // Reasonable limit
                const placeholder = document.createElement('div');
                placeholder.className = 'image-preview';
                placeholder.style.display = 'flex';
                placeholder.style.flexDirection = 'column';
                placeholder.style.alignItems = 'center';
                placeholder.style.justifyContent = 'center';
                placeholder.style.cursor = 'pointer';
                placeholder.innerHTML = `
                    <i class="fas fa-plus" style="font-size: 24px; color: #999; margin-bottom: 5px;"></i>
                    <div style="font-size: 12px; color: #999; text-align: center;">Add More<br>(${uploadedMedia.length} uploaded)</div>
                `;
                placeholder.onclick = function() {
                    document.getElementById('mediaUpload').click();
                };
                container.appendChild(placeholder);
            }
        }
        
        // Submit ad
        async function submitAd() {
            const title = document.getElementById('adTitle').value.trim();
            const category = document.getElementById('adCategory').value;
            const price = document.getElementById('adPrice').value;
            const location = document.getElementById('adLocation').value;
            const description = document.getElementById('adDescription').value.trim();
            const phone = document.getElementById('adPhone').value.replace(/\D/g, '');
            const note = document.getElementById('adNote').value.trim();
            
            if (!title || !category || !price || !location || !description || !phone) {
                alert('Please fill all required fields');
                return;
            }
            
            if (phone.length < 9) {
                alert('Please enter a valid phone number');
                return;
            }
            
            if (uploadedMedia.length === 0 && !confirm('You haven\'t uploaded any photos or videos. Media helps sell products faster. Continue without media?')) {
                return;
            }
            
            const whatsappLink = `https://wa.me/${phone}?text=Hi! I saw your ${encodeURIComponent(title)} on Binga Marketplace`;
            
            const product = {
                id: Date.now(),
                title: title,
                description: description + (note ? `\n\nNote: ${note}` : ''),
                category: category,
                price: parseFloat(price),
                location: location,
                sellerId: currentUser.id,
                sellerName: currentUser.name,
                sellerPhone: phone,
                whatsappLink: whatsappLink,
                status: 'pending',
                approved: false,
                featured: false,
                views: 0,
                createdAt: new Date().toISOString(),
                adminContact: '263772863815',
                adminNote: note || ''
            };
            
            try {
                // Save product
                await BINGA_MARKETPLACE_DB.products.add(product);
                
                // Save media
                if (uploadedMedia.length > 0) {
                    for (const media of uploadedMedia) {
                        media.entityId = product.id;
                        await BINGA_MARKETPLACE_DB.media.add(media);
                    }
                }
                
                // Update user
                const user = await BINGA_MARKETPLACE_DB.users.get(currentUser.id);
                if (user) {
                    user.products = [...(user.products || []), product.id];
                    await BINGA_MARKETPLACE_DB.users.update(user.id, user);
                    currentUser = user;
                    localStorage.setItem('binga_current_user', JSON.stringify(currentUser));
                }
                
                showAlert('Ad submitted for approval! Administrator will review it shortly. Contact +263 77 286 3815 for faster approval.', 'success');
                
                // Clear form
                document.getElementById('adTitle').value = '';
                document.getElementById('adCategory').value = '';
                document.getElementById('adPrice').value = '';
                document.getElementById('adLocation').value = '';
                document.getElementById('adDescription').value = '';
                document.getElementById('adNote').value = '';
                uploadedMedia = [];
                
                // Go to dashboard
                showSection('dashboard');
                updateStorageStats();
            } catch (error) {
                console.error('Error submitting ad:', error);
                alert('Error submitting ad. Please try again.');
            }
        }
        
        // Load user dashboard
        async function loadUserDashboard() {
            if (!currentUser) return;
            
            try {
                const myProducts = await BINGA_MARKETPLACE_DB.products.getBySeller(currentUser.id);
                const pendingProducts = myProducts.filter(p => !p.approved || p.status === 'pending');
                const activeProducts = myProducts.filter(p => p.status === 'active' && p.approved);
                const totalViews = myProducts.reduce((sum, p) => sum + (p.views || 0), 0);
                
                document.getElementById('myProductsCount').textContent = myProducts.length;
                document.getElementById('myViewsCount').textContent = totalViews;
                document.getElementById('myPendingCount').textContent = pendingProducts.length;
                document.getElementById('myActiveCount').textContent = activeProducts.length;
                
                const container = document.getElementById('userDashboard');
                container.innerHTML = `
                    <div style="margin-bottom: 30px;">
                        <button class="btn btn-primary" onclick="showPostAdForm()">
                            <i class="fas fa-plus-circle"></i> Post New Ad
                        </button>
                    </div>
                    
                    <h3>My Products (${myProducts.length})</h3>
                    ${myProducts.length > 0 ? 
                        `<div class="products-grid" style="margin-top: 20px;">
                            ${await Promise.all(myProducts.map(async p => {
                                const media = await BINGA_MARKETPLACE_DB.media.getByEntity(p.id, 'product', 1, 0);
                                const mediaCount = await BINGA_MARKETPLACE_DB.media.countByEntity(p.id, 'product');
                                const icon = p.category === 'fish' ? 'üêü' : p.category === 'goat' ? 'üêê' : 'üì¶';
                                
                                let mediaElement = `<div style="font-size: 48px;">${icon}</div>`;
                                
                                if (media.length > 0) {
                                    const firstMedia = media[0];
                                    if (firstMedia.mediaType === 'image') {
                                        mediaElement = `<img src="${firstMedia.dataUrl}" alt="${p.title}" onclick="openMediaGallery(${p.id}, 'product')">`;
                                    } else if (firstMedia.mediaType === 'video') {
                                        mediaElement = `
                                            <video onclick="openMediaGallery(${p.id}, 'product')">
                                                <source src="${firstMedia.dataUrl}" type="${firstMedia.mimeType}">
                                            </video>
                                            <div class="file-type-badge">VIDEO</div>
                                        `;
                                    }
                                }
                                
                                return `
                                    <div class="product-card">
                                        <div class="product-image">
                                            ${mediaElement}
                                            <div class="product-price">$${p.price}</div>
                                            ${mediaCount > 0 ? 
                                                `<div style="position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.7); color: white; padding: 3px 8px; border-radius: 10px; font-size: 12px;">
                                                    <i class="fas fa-camera"></i> ${mediaCount}
                                                </div>` : ''
                                            }
                                        </div>
                                        <div class="product-details">
                                            <h3 class="product-title">${p.title}</h3>
                                            <p class="product-meta">Status: <span class="status-badge ${!p.approved ? 'status-pending' : p.status === 'active' ? 'status-active' : 'status-rejected'}">
                                                ${!p.approved ? 'Pending Approval' : p.status === 'active' ? 'Active' : 'Rejected'}
                                            </span></p>
                                            <p class="product-meta">Views: ${p.views || 0}</p>
                                            <div class="product-location">
                                                <i class="fas fa-map-marker-alt"></i> ${p.location}
                                            </div>
                                            <div class="action-buttons">
                                                ${!p.approved ? 
                                                    `<button class="action-btn" style="background: #f0f0f0;" onclick="alert('Ad pending admin approval. Contact +263 77 286 3815')">
                                                        <i class="fas fa-clock"></i> Awaiting Approval
                                                    </button>` : ''
                                                }
                                                <button class="action-btn delete" onclick="deleteAd(${p.id})">
                                                    <i class="fas fa-trash"></i> Delete
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                `;
                            })).join('')}
                        </div>` :
                        `<div class="no-products" style="padding: 30px;">
                            <h3>You haven't posted any ads yet</h3>
                            <p>Start selling by posting your first ad</p>
                            <button class="btn btn-primary" onclick="showPostAdForm()" style="margin-top: 15px;">
                                <i class="fas fa-plus-circle"></i> Post Your First Ad
                            </button>
                        </div>`
                    }
                    
                    <div style="margin-top: 40px; background: #f8f9fa; padding: 20px; border-radius: 8px;">
                        <h4><i class="fas fa-info-circle"></i> Important Information</h4>
                        <ul style="margin-top: 10px; color: #666;">
                            <li>All ads require administrator approval</li>
                            <li>Contact +263 77 286 3815 for faster approval</li>
                            <li>Approved ads appear on homepage immediately</li>
                            <li>Upload photos and videos to increase sales</li>
                            <li>Products with media sell 5x faster!</li>
                        </ul>
                    </div>
                `;
            } catch (error) {
                console.error('Error loading user dashboard:', error);
            }
        }
        
        // Delete ad
        async function deleteAd(productId) {
            if (confirm('Are you sure you want to delete this ad? This cannot be undone.')) {
                try {
                    await BINGA_MARKETPLACE_DB.products.delete(productId);
                    
                    if (currentUser && currentUser.products) {
                        const index = currentUser.products.indexOf(productId);
                        if (index > -1) {
                            currentUser.products.splice(index, 1);
                            localStorage.setItem('binga_current_user', JSON.stringify(currentUser));
                        }
                    }
                    
                    showAlert('Ad deleted successfully', 'success');
                    loadUserDashboard();
                    loadMarketplace();
                    loadCategories();
                    loadLocations();
                    updateStorageStats();
                } catch (error) {
                    console.error('Error deleting ad:', error);
                    alert('Error deleting ad. Please try again.');
                }
            }
        }
        
        // Render pagination
        function renderPagination(containerId, currentPage, totalPages, callback) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            if (totalPages <= 1) return;
            
            // Previous button
            if (currentPage > 1) {
                const prevBtn = document.createElement('button');
                prevBtn.className = 'page-btn';
                prevBtn.innerHTML = '‚Äπ';
                prevBtn.onclick = () => callback(currentPage - 1);
                container.appendChild(prevBtn);
            }
            
            // Page numbers
            const maxPages = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxPages / 2));
            let endPage = Math.min(totalPages, startPage + maxPages - 1);
            
            if (endPage - startPage + 1 < maxPages) {
                startPage = Math.max(1, endPage - maxPages + 1);
            }
            
            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = `page-btn ${i === currentPage ? 'active' : ''}`;
                pageBtn.textContent = i;
                pageBtn.onclick = () => callback(i);
                container.appendChild(pageBtn);
            }
            
            // Next button
            if (currentPage < totalPages) {
                const nextBtn = document.createElement('button');
                nextBtn.className = 'page-btn';
                nextBtn.innerHTML = '‚Ä∫';
                nextBtn.onclick = () => callback(currentPage + 1);
                container.appendChild(nextBtn);
            }
        }
        
        // Show alert
        function showAlert(message, type) {
            const existingAlerts = document.querySelectorAll('.alert');
            existingAlerts.forEach(alert => alert.remove());
            
            const alertEl = document.createElement('div');
            alertEl.className = `alert alert-${type}`;
            alertEl.innerHTML = `
                ${message}
                <button onclick="this.parentElement.remove()" style="float: right; background: none; border: none; font-size: 20px; cursor: pointer;">√ó</button>
            `;
            
            const mainContent = document.getElementById('mainContent');
            mainContent.insertBefore(alertEl, mainContent.firstChild);
            
            setTimeout(() => {
                if (alertEl.parentElement) {
                    alertEl.remove();
                }
            }, 5000);
        }
        
        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('authModal');
            if (event.target === modal) {
                closeAuthModal();
            }
            
            const mediaModal = document.getElementById('mediaModal');
            if (event.target === mediaModal) {
                closeMediaModal();
            }
        };
        
        // Initialize app when page loads
        window.onload = initApp;
        
        // Admin functions
        async function showAdminTab(tab) {
            const tabs = document.querySelectorAll('.admin-tab');
            tabs.forEach(t => t.classList.remove('active'));
            document.querySelector(`.admin-tab[onclick="showAdminTab('${tab}')"]`).classList.add('active');
            
            const container = document.getElementById('adminContent');
            
            switch(tab) {
                case 'pending':
                    await loadPendingAds();
                    break;
                case 'attractions':
                    await loadAdminAttractions();
                    break;
                case 'reported':
                    container.innerHTML = `<h3>Reported Ads</h3><p>No reported ads at this time.</p>`;
                    break;
                case 'users':
                    await loadAdminUsers();
                    break;
                case 'stats':
                    await loadAdminStats();
                    break;
                case 'settings':
                    container.innerHTML = `<h3>Settings</h3><p>Admin settings coming soon.</p>`;
                    break;
            }
        }
        
        async function loadPendingAds() {
            try {
                const pendingProducts = await BINGA_MARKETPLACE_DB.products.getPending();
                const container = document.getElementById('adminContent');
                
                if (pendingProducts.length === 0) {
                    container.innerHTML = `<h3>Pending Ads</h3><p>No pending ads for approval.</p>`;
                    return;
                }
                
                container.innerHTML = `
                    <h3>Pending Ads (${pendingProducts.length})</h3>
                    <p>Review and approve or reject marketplace listings</p>
                    <div class="products-grid" style="margin-top: 20px;">
                        ${await Promise.all(pendingProducts.map(async p => {
                            const media = await BINGA_MARKETPLACE_DB.media.getByEntity(p.id, 'product', 1, 0);
                            const icon = p.category === 'fish' ? 'üêü' : p.category === 'goat' ? 'üêê' : 'üì¶';
                            
                            let mediaElement = `<div style="font-size: 48px;">${icon}</div>`;
                            
                            if (media.length > 0) {
                                const firstMedia = media[0];
                                if (firstMedia.mediaType === 'image') {
                                    mediaElement = `<img src="${firstMedia.dataUrl}" alt="${p.title}">`;
                                }
                            }
                            
                            return `
                                <div class="product-card">
                                    <div class="product-image">
                                        ${mediaElement}
                                        <div class="product-price">$${p.price}</div>
                                    </div>
                                    <div class="product-details">
                                        <h3 class="product-title">${p.title}</h3>
                                        <p class="product-meta">${p.description.substring(0, 60)}...</p>
                                        <p class="product-meta">Seller: ${p.sellerName} (${p.sellerPhone})</p>
                                        <div class="product-location">
                                            <i class="fas fa-map-marker-alt"></i> ${p.location}
                                        </div>
                                        <div class="action-buttons">
                                            <button class="action-btn approve" onclick="approveAd(${p.id})">
                                                <i class="fas fa-check"></i> Approve
                                            </button>
                                            <button class="action-btn reject" onclick="rejectAd(${p.id})">
                                                <i class="fas fa-times"></i> Reject
                                            </button>
                                            <button class="action-btn edit" onclick="viewAdDetails(${p.id})">
                                                <i class="fas fa-eye"></i> View
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `;
                        })).join('')}
                    </div>
                `;
            } catch (error) {
                console.error('Error loading pending ads:', error);
            }
        }
        
        async function approveAd(productId) {
            if (confirm('Approve this ad?')) {
                try {
                    await BINGA_MARKETPLACE_DB.products.update(productId, {
                        approved: true,
                        status: 'active'
                    });
                    showAlert('Ad approved successfully!', 'success');
                    loadPendingAds();
                    loadMarketplace();
                } catch (error) {
                    console.error('Error approving ad:', error);
                    alert('Error approving ad');
                }
            }
        }
        
        async function rejectAd(productId) {
            const reason = prompt('Enter rejection reason:');
            if (reason) {
                try {
                    await BINGA_MARKETPLACE_DB.products.update(productId, {
                        approved: false,
                        status: 'rejected',
                        rejectionReason: reason
                    });
                    showAlert('Ad rejected successfully!', 'success');
                    loadPendingAds();
                } catch (error) {
                    console.error('Error rejecting ad:', error);
                    alert('Error rejecting ad');
                }
            }
        }
        
        async function loadAdminAttractions() {
            try {
                const attractions = await BINGA_MARKETPLACE_DB.attractions.getAll();
                const container = document.getElementById('adminContent');
                
                container.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3>Tourist Attractions (${attractions.length})</h3>
                        <button class="btn btn-primary" onclick="showAddAttractionForm()">
                            <i class="fas fa-plus"></i> Add Attraction
                        </button>
                    </div>
                    <p>Manage Binga tourist attractions displayed at the bottom of homepage</p>
                    
                    ${attractions.length > 0 ? 
                        `<div class="products-grid" style="margin-top: 20px;">
                            ${await Promise.all(attractions.map(async a => {
                                const media = await BINGA_MARKETPLACE_DB.media.getByEntity(a.id, 'attraction', 1, 0);
                                const icon = a.type === 'lake' ? 'üåä' : a.type === 'hotspring' ? '‚ô®Ô∏è' : 'üèûÔ∏è';
                                
                                let mediaElement = `<div style="font-size: 48px;">${icon}</div>`;
                                
                                if (media.length > 0) {
                                    const firstMedia = media[0];
                                    if (firstMedia.mediaType === 'image') {
                                        mediaElement = `<img src="${firstMedia.dataUrl}" alt="${a.name}">`;
                                    }
                                }
                                
                                return `
                                    <div class="attraction-card">
                                        <div class="attraction-image">
                                            ${mediaElement}
                                            <div class="attraction-type">${a.typeName || a.type}</div>
                                        </div>
                                        <div class="product-details">
                                            <h3 class="product-title">${a.name}</h3>
                                            <p class="product-meta">${a.description.substring(0, 60)}...</p>
                                            <div class="product-location">
                                                <i class="fas fa-map-marker-alt"></i> ${a.location}
                                            </div>
                                            <div class="action-buttons">
                                                <button class="action-btn edit" onclick="editAttraction(${a.id})">
                                                    <i class="fas fa-edit"></i> Edit
                                                </button>
                                                <button class="action-btn delete" onclick="deleteAttraction(${a.id})">
                                                    <i class="fas fa-trash"></i> Delete
                                                </button>
                                                ${a.status !== 'active' ? 
                                                    `<button class="action-btn approve" onclick="activateAttraction(${a.id})">
                                                        <i class="fas fa-check"></i> Activate
                                                    </button>` : ''
                                                }
                                            </div>
                                        </div>
                                    </div>
                                `;
                            })).join('')}
                        </div>` :
                        `<div class="no-products" style="padding: 30px; margin-top: 20px;">
                            <h3>No Tourist Attractions</h3>
                            <p>Add Binga's beautiful attractions to showcase at the bottom of homepage</p>
                            <button class="btn btn-primary" onclick="showAddAttractionForm()" style="margin-top: 15px;">
                                <i class="fas fa-plus-circle"></i> Add First Attraction
                            </button>
                        </div>`
                    }
                `;
            } catch (error) {
                console.error('Error loading attractions:', error);
            }
        }
        
        function showAddAttractionForm() {
            document.getElementById('adminSection').style.display = 'none';
            document.getElementById('addAttractionSection').style.display = 'block';
            
            uploadedMedia = [];
            
            document.getElementById('addAttractionForm').innerHTML = `
                <form id="attractionForm">
                    <div class="form-group">
                        <label class="form-label">Attraction Name*</label>
                        <input type="text" class="form-control" id="attractionName" placeholder="e.g., Lake Kariba Shore">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Type*</label>
                        <select class="form-control" id="attractionType">
                            <option value="">Select Type</option>
                            <option value="beach">Beach</option>
                            <option value="hotspring">Hot Spring</option>
                            <option value="lake">Lake View</option>
                            <option value="cultural">Cultural Site</option>
                            <option value="wildlife">Wildlife</option>
                            <option value="accommodation">Accommodation</option>
                            <option value="tour">Tour Service</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Location*</label>
                        <select class="form-control" id="attractionLocation">
                            <option value="">Select Location</option>
                            <option>Siachilaba</option>
                            <option>Kariyangwe</option>
                            <option>Binga Centre</option>
                            <option>Chete Island</option>
                            <option>Lake Kariba</option>
                            <option>Other</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Description*</label>
                        <textarea class="form-control" id="attractionDescription" rows="4" placeholder="Describe this attraction..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">WhatsApp Contact Link*</label>
                        <input type="text" class="form-control" id="attractionWhatsApp" value="https://wa.me/263772863815?text=Hi! I want to visit ">
                        <small>Visitors will use this link to book or get more information</small>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Upload Photos & Videos</label>
                        <div style="margin-top: 15px;">
                            <label for="attractionMediaUpload" class="image-upload-btn">
                                <i class="fas fa-upload"></i> Upload Photos & Videos
                            </label>
                            <input type="file" id="attractionMediaUpload" accept="image/*,video/*" multiple onchange="handleAttractionMediaUpload(event)" style="display: none;">
                        </div>
                        
                        <div class="image-upload-container" id="attractionMediaPreviewContainer">
                            <!-- Media previews will appear here -->
                        </div>
                    </div>
                    
                    <button type="button" class="btn btn-primary" onclick="submitAttraction()" style="margin-top: 20px;">
                        <i class="fas fa-paper-plane"></i> Add Attraction
                    </button>
                    
                    <button type="button" class="btn" onclick="showSection('admin')" style="margin-top: 20px; margin-left: 10px; background: #f0f0f0;">
                        Cancel
                    </button>
                </form>
            `;
        }
        
        function handleAttractionMediaUpload(event) {
            const files = Array.from(event.target.files);
            files.forEach(file => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const isImage = file.type.startsWith('image/');
                    const isVideo = file.type.startsWith('video/');
                    
                    if (!isImage && !isVideo) {
                        alert(`File type ${file.type} not supported`);
                        return;
                    }
                    
                    const mediaItem = {
                        id: Date.now() + Math.random(),
                        entityId: null,
                        entityType: 'attraction',
                        mediaType: isImage ? 'image' : 'video',
                        mimeType: file.type,
                        dataUrl: e.target.result,
                        filename: file.name,
                        uploadedAt: new Date().toISOString(),
                        uploadedBy: currentUser.id
                    };
                    
                    uploadedMedia.push(mediaItem);
                    updateAttractionMediaPreviews();
                };
                reader.readAsDataURL(file);
            });
        }
        
        function updateAttractionMediaPreviews() {
            const container = document.getElementById('attractionMediaPreviewContainer');
            container.innerHTML = '';
            
            uploadedMedia.forEach((media, index) => {
                const previewDiv = document.createElement('div');
                previewDiv.className = 'image-preview';
                
                if (media.mediaType === 'image') {
                    previewDiv.innerHTML = `<img src="${media.dataUrl}" alt="Preview ${index + 1}">`;
                } else if (media.mediaType === 'video') {
                    previewDiv.innerHTML = `
                        <video>
                            <source src="${media.dataUrl}" type="${media.mimeType}">
                        </video>
                        <div style="position: absolute; bottom: 5px; left: 5px; background: rgba(0,0,0,0.7); color: white; padding: 2px 5px; border-radius: 3px; font-size: 10px;">
                            <i class="fas fa-play"></i> Video
                        </div>
                    `;
                }
                
                const removeBtn = document.createElement('button');
                removeBtn.className = 'remove-image';
                removeBtn.innerHTML = '√ó';
                removeBtn.onclick = function() {
                    uploadedMedia.splice(index, 1);
                    updateAttractionMediaPreviews();
                };
                
                previewDiv.appendChild(removeBtn);
                container.appendChild(previewDiv);
            });
        }
        
        async function submitAttraction() {
            const name = document.getElementById('attractionName').value.trim();
            const type = document.getElementById('attractionType').value;
            const location = document.getElementById('attractionLocation').value;
            const description = document.getElementById('attractionDescription').value.trim();
            const whatsapp = document.getElementById('attractionWhatsApp').value.trim();
            
            if (!name || !type || !location || !description || !whatsapp) {
                alert('Please fill all required fields');
                return;
            }
            
            const typeNames = {
                'beach': 'Beach',
                'hotspring': 'Hot Spring',
                'lake': 'Lake View',
                'cultural': 'Cultural Site',
                'wildlife': 'Wildlife',
                'accommodation': 'Accommodation',
                'tour': 'Tour Service'
            };
            
            const attraction = {
                id: Date.now(),
                name: name,
                description: description,
                type: type,
                typeName: typeNames[type] || type,
                location: location,
                whatsappLink: whatsapp,
                status: 'active',
                addedBy: currentUser.id,
                createdAt: new Date().toISOString()
            };
            
            try {
                await BINGA_MARKETPLACE_DB.attractions.add(attraction);
                
                // Save media
                if (uploadedMedia.length > 0) {
                    for (const media of uploadedMedia) {
                        media.entityId = attraction.id;
                        await BINGA_MARKETPLACE_DB.media.add(media);
                    }
                }
                
                showAlert('Tourist attraction added successfully!', 'success');
                
                // Clear form
                document.getElementById('attractionName').value = '';
                document.getElementById('attractionType').value = '';
                document.getElementById('attractionLocation').value = '';
                document.getElementById('attractionDescription').value = '';
                uploadedMedia = [];
                
                // Go back to admin panel
                showSection('admin');
                loadTouristAttractions();
                updateStorageStats();
            } catch (error) {
                console.error('Error adding attraction:', error);
                alert('Error adding attraction');
            }
        }
        
        async function deleteAttraction(id) {
            if (confirm('Delete this tourist attraction?')) {
                try {
                    await BINGA_MARKETPLACE_DB.attractions.delete(id);
                    showAlert('Attraction deleted!', 'success');
                    loadAdminAttractions();
                    loadTouristAttractions();
                } catch (error) {
                    console.error('Error deleting attraction:', error);
                    alert('Error deleting attraction');
                }
            }
        }
        
        async function activateAttraction(id) {
            try {
                await BINGA_MARKETPLACE_DB.attractions.update(id, { status: 'active' });
                showAlert('Attraction activated!', 'success');
                loadAdminAttractions();
                loadTouristAttractions();
            } catch (error) {
                console.error('Error activating attraction:', error);
                alert('Error activating attraction');
            }
        }
        
        async function loadAdminUsers() {
            try {
                const users = await BINGA_MARKETPLACE_DB.users.getSellers();
                const container = document.getElementById('adminContent');
                
                container.innerHTML = `
                    <h3>Seller Accounts (${users.length})</h3>
                    <p>Manage seller accounts and approvals</p>
                    
                    <div style="overflow-x: auto; margin-top: 20px;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="background: #f8f9fa;">
                                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid var(--border);">Name</th>
                                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid var(--border);">Phone</th>
                                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid var(--border);">Location</th>
                                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid var(--border);">Status</th>
                                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid var(--border);">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${users.map(user => `
                                    <tr>
                                        <td style="padding: 12px; border-bottom: 1px solid var(--border);">${user.name}</td>
                                        <td style="padding: 12px; border-bottom: 1px solid var(--border);">${user.phone}</td>
                                        <td style="padding: 12px; border-bottom: 1px solid var(--border);">${user.location}</td>
                                        <td style="padding: 12px; border-bottom: 1px solid var(--border);">
                                            <span class="status-badge ${user.approved ? 'status-active' : 'status-pending'}">
                                                ${user.approved ? 'Approved' : 'Pending'}
                                            </span>
                                        </td>
                                        <td style="padding: 12px; border-bottom: 1px solid var(--border);">
                                            ${!user.approved ? 
                                                `<button class="action-btn approve" onclick="approveUser(${user.id})" style="padding: 5px 10px; font-size: 12px;">
                                                    Approve
                                                </button>` : 
                                                `<button class="action-btn delete" onclick="deleteUser(${user.id})" style="padding: 5px 10px; font-size: 12px;">
                                                    Delete
                                                </button>`
                                            }
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            } catch (error) {
                console.error('Error loading users:', error);
            }
        }
        
        async function approveUser(userId) {
            if (confirm('Approve this seller account?')) {
                try {
                    await BINGA_MARKETPLACE_DB.users.update(userId, { approved: true });
                    showAlert('Seller account approved!', 'success');
                    loadAdminUsers();
                } catch (error) {
                    console.error('Error approving user:', error);
                    alert('Error approving user');
                }
            }
        }
        
        async function deleteUser(userId) {
            if (confirm('Delete this seller account? All their ads will also be deleted.')) {
                try {
                    // Get user's products first
                    const userProducts = await BINGA_MARKETPLACE_DB.products.getBySeller(userId);
                    
                    // Delete all user's products and media
                    for (const product of userProducts) {
                        await BINGA_MARKETPLACE_DB.products.delete(product.id);
                    }
                    
                    // Delete the user
                    await BINGA_MARKETPLACE_DB.users.delete(userId);
                    
                    showAlert('Seller account deleted!', 'success');
                    loadAdminUsers();
                    loadMarketplace();
                } catch (error) {
                    console.error('Error deleting user:', error);
                    alert('Error deleting user');
                }
            }
        }
        
        async function loadAdminStats() {
            try {
                const totalProducts = await BINGA_MARKETPLACE_DB.products.count();
                const activeProducts = await BINGA_MARKETPLACE_DB.products.countActive();
                const pendingProducts = (await BINGA_MARKETPLACE_DB.products.getPending()).length;
                const totalAttractions = await BINGA_MARKETPLACE_DB.attractions.count();
                const totalUsers = (await BINGA_MARKETPLACE_DB.users.getSellers()).length;
                
                const container = document.getElementById('adminContent');
                container.innerHTML = `
                    <h3>Marketplace Statistics</h3>
                    <p>Overview of marketplace activity</p>
                    
                    <div class="dashboard-stats" style="margin-top: 30px;">
                        <div class="stat-card">
                            <div class="stat-number">${totalProducts}</div>
                            <div>Total Products</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${activeProducts}</div>
                            <div>Active Listings</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${pendingProducts}</div>
                            <div>Pending Approval</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${totalAttractions}</div>
                            <div>Tourist Attractions</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${totalUsers}</div>
                            <div>Seller Accounts</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 40px; background: #f8f9fa; padding: 20px; border-radius: 8px;">
                        <h4><i class="fas fa-chart-line"></i> Quick Actions</h4>
                        <div style="display: flex; gap: 15px; margin-top: 15px; flex-wrap: wrap;">
                            <button class="btn btn-primary" onclick="showAdminTab('pending')">
                                <i class="fas fa-check-circle"></i> Review Pending Ads
                            </button>
                            <button class="btn" style="background: var(--tourist); color: white;" onclick="showAdminTab('attractions')">
                                <i class="fas fa-camera"></i> Manage Attractions
                            </button>
                            <button class="btn" style="background: var(--primary); color: white;" onclick="showAdminTab('users')">
                                <i class="fas fa-users"></i> Manage Sellers
                            </button>
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }
        
        async function loadTourismContent() {
            const container = document.getElementById('tourismContent');
            const attractions = await BINGA_MARKETPLACE_DB.attractions.getActive(50, 0);
            
            if (attractions.length === 0) {
                container.innerHTML = `
                    <div class="no-products" style="padding: 60px 20px;">
                        <div style="font-size: 60px; margin-bottom: 20px;">üèûÔ∏è</div>
                        <h3>No Tourist Attractions Listed</h3>
                        <p>Administrators can add Binga's beautiful attractions here</p>
                        ${currentUser && currentUser.type === 'admin' ? 
                            `<button class="btn btn-primary" onclick="showAdminTab('attractions')" style="margin-top: 15px;">
                                <i class="fas fa-plus-circle"></i> Add Attractions
                            </button>` : ''
                        }
                    </div>
                `;
                return;
            }
            
            container.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3>Discover Binga's Beauty</h3>
                    ${currentUser && currentUser.type === 'admin' ? 
                        `<button class="btn btn-primary" onclick="showAdminTab('attractions')">
                            <i class="fas fa-edit"></i> Manage Attractions
                        </button>` : ''
                    }
                </div>
                <p>Explore the natural beauty and cultural heritage of Binga district</p>
                
                <div class="products-grid" style="margin-top: 30px;">
                    ${await Promise.all(attractions.map(attraction => renderAttractionCard(attraction)))}
                </div>
                
                <div style="margin-top: 40px; background: linear-gradient(135deg, var(--tourist), #6c3483); color: white; padding: 30px; border-radius: 12px;">
                    <h3><i class="fas fa-info-circle"></i> Tourism Information</h3>
                    <p style="margin-top: 15px;">Binga is home to some of Zimbabwe's most beautiful natural attractions. From the shores of Lake Kariba to natural hot springs, there's something for every visitor.</p>
                    <div style="display: flex; gap: 20px; margin-top: 20px; flex-wrap: wrap;">
                        <div style="flex: 1; min-width: 200px;">
                            <h4><i class="fas fa-phone"></i> Contact for Tours</h4>
                            <p>+263 77 286 3815</p>
                        </div>
                        <div style="flex: 1; min-width: 200px;">
                            <h4><i class="fas fa-map-marker-alt"></i> Best Time to Visit</h4>
                            <p>May to October (Dry season)</p>
                        </div>
                        <div style="flex: 1; min-width: 200px;">
                            <h4><i class="fas fa-sun"></i> Climate</h4>
                            <p>Hot and dry, cooler near the lake</p>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Forgot password handler
        function handleForgotPassword() {
            alert('For security reasons, if you forget your password, you need to register again with a new account. Contact administrator at +263 77 286 3815 for assistance.');
        }
    </script>
</body>
</html>
